<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>C.N.K.Y OS | KERNEL v6.1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=JetBrains+Mono:wght@300;500&family=Rajdhani:wght@400;600;700&display=swap');
        :root { 
            --heart: #ff2e6f; 
            --love: #ff6b9d; 
            --bg: #1a0b1f; 
            --alert: #ff2e6f; 
            --gold: #ffd700; 
            --success: #4ade80; 
            --text: #ffebf2;
        }
        body { background: var(--bg); color: var(--text); font-family: 'JetBrains Mono', monospace; overflow: hidden; height: 100vh; }
        
        /* KALP TEMASI STILLERI */
        .heart-pulse {
            animation: heartPulse 1.5s infinite;
        }
        @keyframes heartPulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; }
        }
        
        .love-gradient {
            background: linear-gradient(135deg, #ff2e6f, #ff6b9d, #ff9ec5);
        }
        
        .glass-love {
            background: rgba(255, 46, 111, 0.1);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 107, 157, 0.3);
            border-radius: 15px;
        }
        
        .btn-love {
            background: linear-gradient(135deg, #ff2e6f, #ff6b9d);
            border: none;
            color: white;
            padding: 14px 24px;
            border-radius: 12px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: all 0.3s;
            cursor: pointer;
        }
        .btn-love:hover {
            background: linear-gradient(135deg, #ff6b9d, #ff2e6f);
            box-shadow: 0 0 30px rgba(255, 46, 111, 0.5);
            transform: translateY(-3px);
        }
        
        .input-love {
            background: rgba(255, 107, 157, 0.1);
            border: 1px solid rgba(255, 107, 157, 0.3);
            color: white;
            padding: 14px 18px;
            border-radius: 12px;
            outline: none;
            transition: all 0.3s;
        }
        .input-love:focus {
            border-color: var(--heart);
            box-shadow: 0 0 20px rgba(255, 46, 111, 0.3);
            background: rgba(255, 107, 157, 0.2);
        }
        
        /* MOBILE STILLERI - GELİŞTİRİLMİŞ */
        @media (max-width: 768px) {
            body { overflow-y: auto; height: auto; min-height: 100vh; }
            
            .lock-container { transform: scale(0.9); width: 100%; padding: 0 20px; margin-top: -30px; }
            .lock-logo-container { margin-bottom: 30px !important; }
            .lock-logo-container, .lock-logo-inner { width: 120px !important; height: 120px !important; }
            .lock-logo-inner { width: 100px !important; height: 100px !important; }
            
            .lock-time { font-size: 3rem !important; letter-spacing: 5px !important; }
            .lock-date { font-size: 0.8rem !important; letter-spacing: 4px !important; margin-top: 10px !important; }
            
            .login-box { width: 100% !important; max-width: 380px; padding: 1.5rem !important; margin-bottom: 30px; }
            
            .orbit-system { transform: translate(-50%, -50%) scale(0.7); }
            .orbit-ring-1 { width: 300px; height: 300px; }
            .orbit-ring-2 { width: 400px; height: 400px; }
            .orbit-ring-3 { width: 600px; height: 600px; }
            .orbit-ring-4 { width: 600px; height: 600px; }
            
            #desktop { overflow-y: auto; }
            
            .glass-love, .glass-dark { backdrop-filter: blur(20px) !important; }
            
            .absolute.top-0 { position: fixed !important; height: 60px !important; padding: 0 15px !important; }
            #main-desktop-clock { font-size: 1.5rem !important; letter-spacing: 2px !important; display: none; }
            
            .token-display { padding: 6px 12px !important; font-size: 0.8rem !important; }
            .token-value { font-size: 0.8rem !important; }
            
            .absolute.top-20 { top: 70px !important; flex-direction: column !important; padding: 15px !important; }
            .absolute.top-20 > div { width: 100% !important; margin-bottom: 20px; }
            
            .panel-card { padding: 15px !important; }
            
            /* MOBILE - TASKBAR KALDIRILDI */
            .absolute.bottom-6 { 
                display: none !important; 
            }
            
            /* Hızlı erişime profil ve çıkış butonları eklendi - DÜZELTİLDİ */
            .mobile-quick-access {
                display: flex !important;
                flex-direction: column;
                gap: 10px;
                margin-top: 15px;
                padding-top: 15px;
                border-top: 1px solid rgba(255, 46, 111, 0.2);
            }
            
            .window { 
                position: fixed !important; 
                width: 95vw !important; 
                max-width: 400px !important;
                height: 70vh !important;
                max-height: 600px !important;
                left: 50% !important;
                top: 50% !important;
                transform: translate(-50%, -50%) scale(0.95) !important;
            }
            
            .window.active { transform: translate(-50%, -50%) scale(1) !important; }
            
            #chat-area, #global-chat-area, #performer-chat-area { max-height: 40vh !important; min-height: 200px; }
            
            input, textarea { font-size: 16px !important; }
            
            .developer-signature { 
                bottom: 10px !important; 
                left: 10px !important;
                font-size: 9px !important;
            }
            
            .ark-container { transform: translate(-50%, -50%) scale(0.5); }
            
            /* MOBILE - Aktif Kullanıcı Listesi Genişletme */
            #active-user-list, #active-performer-list {
                max-height: 250px !important;
                min-height: 200px;
            }
            
            .user-card, .performer-card {
                padding: 10px !important;
                min-height: 60px;
            }
            
            .user-avatar, .performer-avatar {
                width: 40px !important;
                height: 40px !important;
            }
            
            .user-name {
                font-size: 12px !important;
            }
            
            /* TRANSITION OVERLAY MOBILE */
            #transition-overlay { padding: 20px; }
            #transition-overlay .text-lg { font-size: 1rem !important; }
            
            /* MOBILE MESAJ PANELİ DÜZELTMESİ */
            .msg-container { max-width: 90% !important; }
            .msg-bubble { padding: 12px 16px !important; font-size: 14px !important; }
            .msg-sender { font-size: 10px !important; }
            .msg-time { font-size: 10px !important; }
            
            /* ŞİKAYET TALEBİ MOBILE DÜZELTMESİ */
            .complaint-warning-box {
                padding: 12px !important;
                margin-bottom: 15px !important;
            }
            
            /* BİLGİ KUTUSU MOBILE DÜZELTMESİ */
            .bank-info-box {
                padding: 12px !important;
            }
        }
        
        @media (max-width: 480px) {
            .lock-time { font-size: 2.5rem !important; }
            .lock-date { font-size: 0.7rem !important; }
            
            .auth-tab { font-size: 8px !important; padding: 6px 0 !important; }
            
            .login-input { padding: 14px 16px !important; }
            
            .absolute.top-0 .flex.items-center.gap-6 { gap: 10px !important; }
            .stat-box { padding: 6px 8px !important; font-size: 9px !important; }
            
            /* Aktif Kullanıcı Listesi - Küçük Mobil */
            #active-user-list, #active-performer-list {
                max-height: 300px !important;
            }
            
            /* TRANSITION OVERLAY SMALL MOBILE */
            #transition-overlay { padding: 15px; }
            #transition-overlay .text-lg { font-size: 0.9rem !important; }
            #transition-overlay .w-24 { width: 70px !important; height: 70px !important; }
        }
        
        /* GELİŞMİŞ TRANSITION OVERLAY STİLLERİ */
        #transition-overlay, #global-loader-overlay { 
            position: fixed; 
            inset: 0; 
            background: rgba(26, 11, 31, 0.98); 
            z-index: 9999; 
            display: none; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            transition: opacity 0.5s ease; 
            opacity: 0; 
        }
        
        #transition-overlay {
            background: radial-gradient(circle at center, #2a112f 0%, #1a0b1f 70%);
        }
        
        #transition-text {
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(180deg, #ff2e6f 0%, #ff6b9d 50%, #ff9ec5 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 0 15px rgba(255, 46, 111, 0.5));
        }
        
        .transition-heart {
            position: absolute;
            color: var(--heart);
            font-size: 20px;
            animation: transition-heart-float 3s ease-in-out infinite;
            opacity: 0.5;
        }
        
        @keyframes transition-heart-float {
            0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.3; }
            50% { transform: translateY(-20px) rotate(180deg); opacity: 0.8; }
        }
        
        /* ARK REAKTORU - KALP TEMASI */
        .ark-container { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 700px; height: 700px; z-index: -1; }
        .ark-reactor { width: 100%; height: 100%; border-radius: 50%; border: 8px solid rgba(255, 46, 111, 0.1); box-shadow: 0 0 100px rgba(255, 46, 111, 0.2), inset 0 0 100px rgba(255, 107, 157, 0.1); position: relative; animation: pulse-glow 4s infinite; }
        .ark-inner { position: absolute; top: 15%; left: 15%; width: 70%; height: 70%; border: 2px dashed var(--heart); border-radius: 50%; opacity: 0.2; animation: spin 30s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes pulse-glow { 0%, 100% { opacity: 0.2; transform: scale(1); } 50% { opacity: 0.5; transform: scale(1.05); } }

        /* YENI KILIT EKRANI TASARIMI - KALP TEMASI */
        .lock-bg {
            background: 
                radial-gradient(ellipse at 50% 0%, rgba(255, 46, 111, 0.3) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(255, 107, 157, 0.2) 0%, transparent 40%),
                radial-gradient(ellipse at 20% 80%, rgba(255, 158, 197, 0.15) 0%, transparent 40%),
                linear-gradient(180deg, #1a0b1f 0%, #2a112f 50%, #1a0b1f 100%);
        }

        .lock-container { position: relative; z-index: 10; }

        /* Gelismis Halka Animasyonlari */
        .orbit-system {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1;
        }
        .orbit-ring {
            position: absolute;
            border: 1px solid rgba(255, 46, 111, 0.15);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .orbit-ring-1 { width: 400px; height: 400px; animation: orbit-spin 25s linear infinite; }
        .orbit-ring-2 { width: 500px; height: 500px; animation: orbit-spin 35s linear infinite reverse; border-style: dashed; border-color: rgba(255, 107, 157, 0.12); }
        .orbit-ring-3 { width: 600px; height: 600px; animation: orbit-spin 45s linear infinite; border-color: rgba(255, 158, 197, 0.08); }
        .orbit-ring-4 { width: 700px; height: 700px; animation: orbit-spin 55s linear infinite reverse; border-style: dotted; border-color: rgba(255, 46, 111, 0.05); }
        @keyframes orbit-spin { 100% { transform: translate(-50%, -50%) rotate(360deg); } }

        /* Orbit Kalpleri */
        .orbit-heart {
            position: absolute;
            width: 12px;
            height: 12px;
            color: var(--heart);
            font-size: 12px;
            text-shadow: 0 0 10px var(--heart), 0 0 20px var(--heart);
        }
        .orbit-ring-1 .orbit-heart { top: 0; left: 50%; transform: translateX(-50%); }
        .orbit-ring-2 .orbit-heart { top: 50%; right: 0; transform: translateY(-50%); }
        .orbit-ring-3 .orbit-heart { bottom: 0; left: 50%; transform: translateX(-50%); }

        /* Merkez Logo */
        .lock-logo-container {
            position: relative;
            width: 160px;
            height: 160px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .lock-logo-ring {
            position: absolute;
            inset: 0;
            border: 2px solid rgba(255, 46, 111, 0.4);
            border-radius: 50%;
            animation: logo-pulse 3s ease-in-out infinite;
        }
        .lock-logo-ring::before {
            content: '';
            position: absolute;
            inset: -10px;
            border: 1px solid rgba(255, 107, 157, 0.2);
            border-radius: 50%;
        }
        .lock-logo-ring::after {
            content: '';
            position: absolute;
            inset: -20px;
            border: 1px dashed rgba(255, 158, 197, 0.15);
            border-radius: 50%;
            animation: spin 20s linear infinite reverse;
        }
        @keyframes logo-pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 20px rgba(255, 46, 111, 0.3); }
            50% { transform: scale(1.05); box-shadow: 0 0 40px rgba(255, 46, 111, 0.5); }
        }

        .lock-logo-inner {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(255, 46, 111, 0.2), rgba(255, 107, 157, 0.25));
            border: 3px solid var(--heart);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 50px rgba(255, 46, 111, 0.4), inset 0 0 40px rgba(255, 107, 157, 0.15);
            position: relative;
            overflow: hidden;
        }
        .lock-logo-inner::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(transparent, rgba(255, 46, 111, 0.15), transparent);
            animation: scan-rotate 4s linear infinite;
        }
        @keyframes scan-rotate { 100% { transform: rotate(360deg); } }

        /* Saat Tasarimi */
        .lock-time { 
            font-family: 'Orbitron', sans-serif; 
            font-weight: 900; 
            background: linear-gradient(180deg, #ff2e6f 0%, #ff6b9d 50%, #ff9ec5 100%); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            background-clip: text; 
            filter: drop-shadow(0 0 30px rgba(255, 46, 111, 0.6)); 
            letter-spacing: 10px;
            position: relative;
        }
        .lock-time::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--heart), transparent);
        }

        .lock-date { font-family: 'Rajdhani', sans-serif; color: rgba(255, 107, 157, 0.6); letter-spacing: 8px; }

        /* Login Kutusu */
        .login-box { 
            background: linear-gradient(135deg, rgba(40, 10, 30, 0.95), rgba(60, 15, 40, 0.98)); 
            backdrop-filter: blur(40px); 
            border: 1px solid rgba(255, 46, 111, 0.3); 
            border-radius: 24px; 
            position: relative; 
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), 0 0 100px rgba(255, 46, 111, 0.2);
        }
        .login-box::before { 
            content: ''; 
            position: absolute; 
            top: 0; 
            left: 0; 
            right: 0; 
            height: 2px; 
            background: linear-gradient(90deg, transparent, var(--heart), transparent); 
            animation: scan-line 3s linear infinite; 
        }
        .login-box::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 46, 111, 0.4), transparent);
        }
        @keyframes scan-line { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }

        .login-input { 
            background: rgba(255, 107, 157, 0.1) !important; 
            border: 1px solid rgba(255, 46, 111, 0.2) !important; 
            color: white !important; 
            padding: 16px 20px; 
            border-radius: 14px; 
            outline: none; 
            transition: all 0.3s ease; 
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
        }
        .login-input:focus { 
            border-color: var(--heart) !important; 
            box-shadow: 0 0 25px rgba(255, 46, 111, 0.3), inset 0 0 20px rgba(255, 46, 111, 0.1); 
            background: rgba(255, 107, 157, 0.2) !important;
        }
        .login-input::placeholder { color: rgba(255, 107, 157, 0.4); }

        .login-btn { 
            background: linear-gradient(135deg, rgba(255, 46, 111, 0.2), rgba(255, 107, 157, 0.25)); 
            border: 2px solid var(--heart); 
            color: white; 
            padding: 18px; 
            border-radius: 14px; 
            font-family: 'Orbitron', sans-serif; 
            font-weight: 700; 
            font-size: 13px;
            letter-spacing: 5px; 
            transition: all 0.4s ease; 
            position: relative; 
            overflow: hidden;
            cursor: pointer;
        }
        .login-btn::before { 
            content: ''; 
            position: absolute; 
            inset: 0; 
            background: linear-gradient(90deg, transparent, rgba(255, 46, 111, 0.4), transparent); 
            transform: translateX(-100%); 
            transition: transform 0.6s ease; 
        }
        .login-btn:hover::before { transform: translateX(100%); }
        .login-btn:hover { 
            background: var(--heart); 
            color: white; 
            box-shadow: 0 0 40px rgba(255, 46, 111, 0.6), 0 0 80px rgba(255, 46, 111, 0.3); 
            transform: translateY(-2px);
        }

        /* Kayıt Ol Butonu - DÜZELTİLDİ */
        .register-btn {
            background: linear-gradient(135deg, rgba(74, 222, 128, 0.3), rgba(40, 167, 69, 0.3));
            border: 2px solid var(--success);
            color: white;
            padding: 18px;
            border-radius: 14px;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 13px;
            letter-spacing: 5px;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            width: 100%;
        }
        
        .register-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, transparent, rgba(74, 222, 128, 0.4), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s ease;
        }
        
        .register-btn:hover::before {
            transform: translateX(100%);
        }
        
        .register-btn:hover {
            background: var(--success);
            color: white;
            box-shadow: 0 0 40px rgba(74, 222, 128, 0.6), 0 0 80px rgba(74, 222, 128, 0.3);
            transform: translateY(-2px);
        }

        /* Kose Dekorasyonlari */
        .corner-decor { position: absolute; width: 40px; height: 40px; border-color: var(--heart); opacity: 0.6; }
        .corner-decor.tl { top: -1px; left: -1px; border-top: 2px solid; border-left: 2px solid; border-radius: 8px 0 0 0; }
        .corner-decor.tr { top: -1px; right: -1px; border-top: 2px solid; border-right: 2px solid; border-radius: 0 8px 0 0; }
        .corner-decor.bl { bottom: -1px; left: -1px; border-bottom: 2px solid; border-left: 2px solid; border-radius: 0 0 0 8px; }
        .corner-decor.br { bottom: -1px; right: -1px; border-bottom: 2px solid; border-right: 2px solid; border-radius: 0 0 8px 0; }

        /* Parcaciklar - Kalpler */
        .particle { position: absolute; width: 12px; height: 12px; color: var(--heart); font-size: 12px; animation: float 15s infinite; opacity: 0.4; }
        @keyframes float { 
            0%, 100% { transform: translateY(0) translateX(0) rotate(0deg); opacity: 0; } 
            10% { opacity: 0.6; } 
            90% { opacity: 0.6; } 
            100% { transform: translateY(-100vh) translateX(30px) rotate(360deg); opacity: 0; } 
        }

        /* Developer Imzasi */
        .developer-signature {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 1001;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            color: rgba(255, 107, 157, 0.5);
            letter-spacing: 2px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        .developer-signature:hover {
            color: var(--heart);
            text-shadow: 0 0 20px rgba(255, 46, 111, 0.5);
        }
        .developer-signature i {
            font-size: 14px;
        }

        /* BILDIRIM SISTEMI */
        .notification-toast {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 10000;
            transform: translateX(400px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .notification-toast.show { 
            transform: translateX(0); 
            opacity: 1;
        }

        .notification-glow { animation: notify-pulse 0.5s infinite alternate !important; }
        @keyframes notify-pulse { 
            0% { box-shadow: 0 0 5px rgba(255, 46, 111, 0.4); } 
            50% { box-shadow: 0 0 25px rgba(255, 46, 111, 0.8), 0 0 40px rgba(255, 46, 111, 0.4); } 
            100% { box-shadow: 0 0 10px rgba(255, 46, 111, 0.5); } 
        }
        
        /* Yanip sonen kalp */
        .blink-heart {
            width: 12px;
            height: 12px;
            color: #ff2e6f;
            font-size: 12px;
            animation: blink-heart-anim 0.6s infinite;
            text-shadow: 0 0 10px #ff2e6f, 0 0 20px #ff2e6f;
        }
        @keyframes blink-heart-anim {
            0%, 100% { opacity: 1; transform: scale(1); text-shadow: 0 0 10px #ff2e6f, 0 0 20px #ff2e6f; }
            50% { opacity: 0.3; transform: scale(0.8); text-shadow: 0 0 5px #ff2e6f; }
        }

        /* TOKEN GOSTERGE */
        .token-display {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 165, 0, 0.1));
            border: 1px solid rgba(255, 215, 0, 0.4);
            border-radius: 10px;
            padding: 8px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            animation: token-glow 3s ease-in-out infinite;
        }
        @keyframes token-glow {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }
            50% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
        }
        .token-icon {
            color: var(--gold);
            font-size: 14px;
            animation: coin-spin 4s linear infinite;
        }
        @keyframes coin-spin {
            0%, 100% { transform: rotateY(0deg); }
            50% { transform: rotateY(180deg); }
        }
        .token-value {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 14px;
            color: var(--gold);
        }

        /* Yetersiz Token Uyarisi */
        .insufficient-token {
            animation: shake 0.5s ease-in-out;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* Auth Tab Stilleri */
        .auth-tab {
            color: rgba(255, 107, 157, 0.5);
            background: transparent;
        }
        .auth-tab:hover {
            color: rgba(255, 107, 157, 0.8);
        }
        .auth-tab.active {
            background: linear-gradient(135deg, rgba(255, 46, 111, 0.3), rgba(255, 107, 157, 0.3));
            color: #ffebf2;
            box-shadow: 0 0 15px rgba(255, 46, 111, 0.3);
        }

        /* Token Paket Secimi */
        .token-package-option {
            display: block;
            cursor: pointer;
        }
        .token-package-option input {
            display: none;
        }
        .token-package-option .package-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: rgba(255, 107, 157, 0.1);
            border: 1px solid rgba(255, 46, 111, 0.2);
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        .token-package-option:hover .package-content {
            border-color: rgba(255, 46, 111, 0.4);
            background: rgba(255, 46, 111, 0.15);
        }
        .token-package-option input:checked + .package-content {
            border-color: rgba(255, 46, 111, 0.7);
            background: rgba(255, 46, 111, 0.2);
            box-shadow: 0 0 20px rgba(255, 46, 111, 0.3);
        }

        /* GENEL TASARIM */
        .glass { background: rgba(40, 15, 35, 0.92); backdrop-filter: blur(30px); border: 1px solid rgba(255, 46, 111, 0.3); border-radius: 15px; }
        .glass-dark { background: rgba(30, 10, 25, 0.95); backdrop-filter: blur(30px); border: 1px solid rgba(255, 46, 111, 0.25); border-radius: 15px; }
        
        .window { position: absolute; display: none; flex-direction: column; transform: scale(0.95); opacity: 0; transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 20; }
        .window.active { display: flex; transform: scale(1); opacity: 1; }
        
        /* PENCERE KONUMLARI */
        #win-global { top: 50%; left: 50%; transform: translate(-50%, -50%); width: 450px; height: 480px; max-height: 85vh; }
        #win-global.active { transform: translate(-50%, -50%) scale(1); }
        #win-chat { top: 50%; left: 50%; transform: translate(-50%, -50%); width: 420px; height: 520px; max-height: 85vh; }
        #win-chat.active { transform: translate(-50%, -50%) scale(1); }
        #win-admin { top: 50%; left: 50%; transform: translate(-50%, -50%); width: 540px; height: 680px; max-height: 92vh; }
        #win-admin.active { transform: translate(-50%, -50%) scale(1); }
        #win-token { top: 50%; left: 50%; transform: translate(-50%, -50%); width: 480px; max-height: 90vh; overflow-y: auto; }
        #win-token.active { transform: translate(-50%, -50%) scale(1); }
        #win-profile { top: 50%; left: 50%; transform: translate(-50%, -50%); width: 400px; }
        #win-profile.active { transform: translate(-50%, -50%) scale(1); }
        #win-performer-chat { top: 50%; left: 50%; transform: translate(-50%, -50%); width: 420px; height: 520px; max-height: 85vh; }
        #win-performer-chat.active { transform: translate(-50%, -50%) scale(1); }
        #win-files { top: 50%; left: 50%; transform: translate(-50%, -50%); width: 450px; height: 420px; max-height: 85vh; }
        #win-files.active { transform: translate(-50%, -50%) scale(1); }
        #win-note-editor { top: 50%; left: 50%; transform: translate(-50%, -50%); width: 400px; height: 400px; max-height: 85vh; }
        #win-note-editor.active { transform: translate(-50%, -50%) scale(1); }
        #win-complaint { top: 50%; left: 50%; transform: translate(-50%, -50%); width: 450px; height: 500px; max-height: 85vh; }
        #win-complaint.active { transform: translate(-50%, -50%) scale(1); }
        #win-complaint-admin { top: 50%; left: 50%; transform: translate(-50%, -50%); width: 550px; height: 600px; max-height: 85vh; }
        #win-complaint-admin.active { transform: translate(-50%, -50%) scale(1); }
        #win-siralama { top: 50%; left: 50%; transform: translate(-50%, -50%); width: 450px; height: 500px; max-height: 85vh; }
        #win-siralama.active { transform: translate(-50%, -50%) scale(1); }
        #win-bilgi { top: 50%; left: 50%; transform: translate(-50%, -50%); width: 450px; height: 450px; max-height: 85vh; }
        #win-bilgi.active { transform: translate(-50%, -50%) scale(1); }
        #win-token-price-admin { top: 50%; left: 50%; transform: translate(-50%, -50%); width: 500px; height: 500px; max-height: 85vh; }
        #win-token-price-admin.active { transform: translate(-50%, -50%) scale(1); }

        .window-header { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; border-bottom: 1px solid rgba(255, 46, 111, 0.15); }
        .window-header-title { display: flex; align-items: center; gap: 12px; }
        .window-header-icon { width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 14px; }
        .window-close { width: 32px; height: 32px; border-radius: 8px; background: rgba(255, 46, 111, 0.15); border: 1px solid rgba(255, 46, 111, 0.4); color: rgba(255, 46, 111, 0.8); display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s; }
        .window-close:hover { background: rgba(255, 46, 111, 0.4); color: white; }

        /* MESAJ STILLERI */
        .msg-container { display: flex; flex-direction: column; max-width: 80%; }
        .msg-container.me { align-items: flex-end; margin-left: auto; }
        .msg-container.them { align-items: flex-start; margin-right: auto; }
        .msg-bubble { padding: 10px 14px; border-radius: 12px; font-size: 12px; word-wrap: break-word; }
        .msg-bubble.me { background: linear-gradient(135deg, rgba(255, 46, 111, 0.3), rgba(255, 107, 157, 0.25)); border: 1px solid rgba(255, 46, 111, 0.4); color: white; }
        .msg-bubble.them { background: rgba(60, 25, 45, 0.8); border: 1px solid rgba(255, 107, 157, 0.3); color: white; }
        .msg-bubble.token-transfer { background: linear-gradient(135deg, rgba(255, 215, 0, 0.25), rgba(255, 165, 0, 0.2)) !important; border: 1px solid rgba(255, 215, 0, 0.5) !important; }
        .msg-sender { font-size: 9px; color: rgba(255, 107, 157, 0.6); margin-bottom: 3px; text-transform: uppercase; letter-spacing: 1px; display: flex; align-items: center; gap: 6px; }
        .msg-sender-avatar { width: 16px; height: 16px; border-radius: 4px; object-fit: cover; }
        .msg-time { font-size: 9px; color: rgba(255, 235, 242, 0.4); margin-top: 3px; }

        /* KULLANICI KARTI */
        .user-card {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            background: rgba(255, 46, 111, 0.08);
            border: 1px solid rgba(255, 46, 111, 0.15);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        .user-card:hover { background: rgba(255, 46, 111, 0.15); border-color: var(--heart); }
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            background: rgba(255, 46, 111, 0.15);
            border: 2px solid rgba(255, 46, 111, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            color: var(--heart);
            overflow: hidden;
        }
        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }
        .user-info { flex: 1; }
        .user-name { font-size: 11px; font-weight: bold; color: white; text-transform: uppercase; letter-spacing: 1px; display: flex; align-items: center; gap: 6px; }
        .user-status { font-size: 9px; color: rgba(74, 222, 128, 0.7); margin-top: 2px; }
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            min-width: 18px;
            height: 18px;
            background: var(--heart);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            color: white;
            animation: badge-pulse 1s infinite;
        }
        @keyframes badge-pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }

        /* Engelle Butonu */
        .block-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 20px;
            height: 20px;
            background: rgba(220, 53, 69, 0.2);
            border: 1px solid rgba(220, 53, 69, 0.4);
            border-radius: 4px;
            color: #dc3545;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 5;
        }
        
        .block-btn:hover {
            background: #dc3545;
            color: white;
        }
        
        .block-btn.blocked {
            background: #dc3545;
            color: white;
        }
        
        .user-card.blocked {
            opacity: 0.5;
            filter: grayscale(0.7);
        }
        
        .user-card.blocked::after {
            content: "ENGELLENDİ";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(220, 53, 69, 0.8);
            color: white;
            font-size: 9px;
            padding: 2px 6px;
            border-radius: 4px;
            z-index: 2;
        }

        /* SOVCU KARTI */
        .performer-card {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: linear-gradient(135deg, rgba(255, 46, 111, 0.15), rgba(255, 107, 157, 0.1));
            border: 1px solid rgba(255, 46, 111, 0.4);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .performer-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(180deg, #ff2e6f, #ff6b9d);
            opacity: 0.8;
        }
        .performer-card:hover {
            background: rgba(255, 46, 111, 0.2);
            border-color: #ff2e6f;
            transform: translateX(5px);
        }
        .performer-avatar {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            background: linear-gradient(135deg, rgba(255, 46, 111, 0.4), rgba(255, 107, 157, 0.4));
            border: 2px solid #ff2e6f;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: white;
            position: relative;
            overflow: hidden;
        }
        .performer-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }
        .performer-avatar::after {
            content: '❤️';
            position: absolute;
            bottom: -4px;
            right: -4px;
            font-size: 8px;
            animation: performer-pulse 2s infinite;
        }
        
        /* Mavi Tik Guvenilir Isareti */
        .verified-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            background: linear-gradient(135deg, #007bff, #00bfff);
            border-radius: 50%;
            position: relative;
            animation: verified-pulse 2s ease-in-out infinite;
            box-shadow: 0 0 10px rgba(0, 123, 255, 0.6);
        }
        .verified-badge::before {
            content: '✓';
            font-size: 10px;
            color: white;
            font-weight: bold;
        }
        .verified-badge::after {
            content: '';
            position: absolute;
            inset: -3px;
            border-radius: 50%;
            border: 2px solid rgba(0, 123, 255, 0.5);
            animation: verified-ring 2s ease-in-out infinite;
        }
        @keyframes verified-pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 10px rgba(0, 123, 255, 0.6); }
            50% { transform: scale(1.1); box-shadow: 0 0 20px rgba(0, 123, 255, 0.9), 0 0 30px rgba(0, 123, 255, 0.5); }
        }
        @keyframes verified-ring {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.5; }
        }

        @keyframes performer-pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.8; }
        }

        /* DOSYA SISTEMI */
        .file-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            background: rgba(255, 46, 111, 0.05);
            border: 1px solid rgba(255, 46, 111, 0.15);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .file-item:hover {
            background: rgba(255, 46, 111, 0.15);
            border-color: var(--heart);
            transform: translateX(5px);
        }
        .file-icon {
            width: 42px;
            height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            font-size: 18px;
        }
        .file-icon.txt { background: rgba(255, 46, 111, 0.25); color: white; }
        .file-icon.add { background: rgba(74, 222, 128, 0.15); color: var(--success); border: 2px dashed var(--success); }

        .file-password-overlay {
            position: absolute;
            inset: 0;
            background: rgba(26, 11, 31, 0.98);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 15px;
            z-index: 10;
        }

        /* PANEL */
        .panel-card {
            background: linear-gradient(135deg, rgba(255, 46, 111, 0.1), rgba(255, 107, 157, 0.08));
            border: 1px solid rgba(255, 46, 111, 0.2);
            border-radius: 16px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }
        .panel-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--heart), transparent);
        }

        .stat-box {
            background: rgba(255, 46, 111, 0.1);
            border: 1px solid rgba(255, 46, 111, 0.2);
            border-radius: 10px;
            padding: 12px 16px;
        }

        input { background: rgba(255, 107, 157, 0.1) !important; border: 1px solid rgba(255, 46, 111, 0.3) !important; color: white !important; padding: 12px 16px; border-radius: 10px; outline: none; transition: all 0.3s; font-family: 'JetBrains Mono', monospace; }
        input:focus { border-color: var(--heart) !important; box-shadow: 0 0 15px rgba(255, 46, 111, 0.3); }
        
        textarea { background: rgba(255, 107, 157, 0.1) !important; border: 1px solid rgba(255, 46, 111, 0.3) !important; color: white !important; padding: 16px; border-radius: 10px; outline: none; resize: none; font-family: 'JetBrains Mono', monospace; }
        textarea:focus { border-color: var(--heart) !important; }

        .btn-primary {
            background: linear-gradient(135deg, rgba(255, 46, 111, 0.3), rgba(255, 107, 157, 0.3));
            border: 1px solid var(--heart);
            color: white;
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-size: 11px;
            transition: all 0.3s;
            cursor: pointer;
        }
        .btn-primary:hover {
            background: var(--heart);
            color: white;
            box-shadow: 0 0 20px rgba(255, 46, 111, 0.5);
        }
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: rgba(255, 46, 111, 0.1); border-radius: 3px; }
        ::-webkit-scrollbar-thumb { background: rgba(255, 46, 111, 0.4); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255, 46, 111, 0.6); }

        /* MERKEZ ANIMASYON KALPLERI */
        .center-heart {
            position: absolute;
            width: 6px;
            height: 6px;
            color: var(--heart);
            font-size: 6px;
            animation: heart-twinkle 2s infinite;
            text-shadow: 0 0 10px var(--heart);
        }
        .center-heart:nth-child(odd) { animation-delay: 0.5s; animation-duration: 1.5s; }
        .center-heart:nth-child(even) { animation-delay: 1s; animation-duration: 2.5s; }
        @keyframes heart-twinkle {
            0%, 100% { opacity: 0.2; transform: scale(0.5); }
            50% { opacity: 1; transform: scale(1.5); text-shadow: 0 0 20px var(--heart), 0 0 40px var(--heart); }
        }
        
        /* Radial Gradient Desteji */
        .bg-gradient-radial { background: radial-gradient(circle, var(--tw-gradient-from), var(--tw-gradient-to)); }

        /* VIDEO CALL MODAL */
        .video-call-modal {
            position: fixed;
            inset: 0;
            background: rgba(26, 11, 31, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10001;
            backdrop-filter: blur(10px);
        }
        .video-call-modal.show {
            display: flex;
        }
        .video-call-content {
            position: relative;
            padding: 40px 60px;
            background: linear-gradient(135deg, rgba(255, 46, 111, 0.15), rgba(255, 107, 157, 0.15));
            border: 2px solid rgba(255, 46, 111, 0.6);
            border-radius: 24px;
            text-align: center;
            animation: modal-appear 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes modal-appear {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .video-icon-container {
            width: 100px;
            height: 100px;
            margin: 0 auto 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(255, 46, 111, 0.3), rgba(255, 107, 157, 0.3));
            border: 3px solid #ff2e6f;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse-video 2s infinite;
        }
        @keyframes pulse-video {
            0%, 100% { transform: scale(1); box-shadow: 0 0 20px rgba(255, 46, 111, 0.4); }
            50% { transform: scale(1.1); box-shadow: 0 0 40px rgba(255, 46, 111, 0.8), 0 0 60px rgba(255, 46, 111, 0.4); }
        }
        .video-icon-container i {
            font-size: 40px;
            color: #ff2e6f;
            animation: shake-icon 0.5s ease-in-out infinite alternate;
        }
        @keyframes shake-icon {
            0% { transform: rotate(-5deg); }
            100% { transform: rotate(5deg); }
        }

        /* Profile Photo Upload */
        .profile-photo-container {
            position: relative;
            width: 96px;
            height: 96px;
            margin: 0 auto;
        }
        .profile-photo {
            width: 96px;
            height: 96px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid rgba(255, 46, 111, 0.6);
        }
        .profile-photo-upload {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff2e6f, #ff6b9d);
            border: 2px solid var(--bg);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        .profile-photo-upload:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255, 46, 111, 0.6);
        }
        .profile-photo-upload input {
            display: none;
        }
        
        /* Profil Yukleme Spinner */
        .upload-spinner {
            display: none;
            position: absolute;
            inset: 0;
            background: rgba(26, 11, 31, 0.8);
            border-radius: 50%;
            align-items: center;
            justify-content: center;
        }
        .upload-spinner.active {
            display: flex;
        }
        .upload-spinner i {
            animation: spin 1s linear infinite;
        }

        /* Kopyala Butonu */
        .copy-btn {
            padding: 4px 10px;
            background: rgba(255, 46, 111, 0.15);
            border: 1px solid rgba(255, 46, 111, 0.4);
            border-radius: 6px;
            color: var(--heart);
            font-size: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .copy-btn:hover {
            background: var(--heart);
            color: white;
        }
        .copy-btn.copied {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        /* Banka Bilgi Kutusu */
        .bank-info-box {
            background: rgba(255, 46, 111, 0.1);
            border: 1px solid rgba(255, 46, 111, 0.3);
            border-radius: 12px;
            padding: 16px;
        }
        .bank-info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 46, 111, 0.15);
        }
        .bank-info-row:last-child {
            border-bottom: none;
        }
        
        /* SIKAYET STILLERI */
        .complaint-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            min-width: 20px;
            height: 20px;
            background: #ff2e6f;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            color: white;
            animation: badge-pulse 1s infinite;
            z-index: 10;
        }
        
        .complaint-item {
            background: rgba(255, 46, 111, 0.08);
            border: 1px solid rgba(255, 46, 111, 0.2);
            border-radius: 12px;
            padding: 14px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }
        
        .complaint-item:hover {
            background: rgba(255, 46, 111, 0.12);
            border-color: rgba(255, 46, 111, 0.4);
        }
        
        .complaint-status {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 6px;
            font-size: 9px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .complaint-status.pending {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
            border: 1px solid rgba(255, 193, 7, 0.4);
        }
        
        .complaint-status.solved {
            background: rgba(40, 167, 69, 0.2);
            color: #28a745;
            border: 1px solid rgba(40, 167, 69, 0.4);
        }
        
        .complaint-status.reviewing {
            background: rgba(0, 123, 255, 0.2);
            color: #007bff;
            border: 1px solid rgba(0, 123, 255, 0.4);
        }
        
        .complaint-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }
        
        /* Şikayet Uyarı Kutusu - DÜZELTİLDİ */
        .complaint-warning-box {
            background: rgba(255, 46, 111, 0.1) !important;
            border: 1px solid rgba(255, 46, 111, 0.3) !important;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }
        
        /* Sıralama Kartları */
        .ranking-card {
            background: linear-gradient(135deg, rgba(255, 46, 111, 0.1), rgba(255, 107, 157, 0.08));
            border: 1px solid rgba(255, 46, 111, 0.2);
            border-radius: 12px;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
            transition: all 0.3s;
        }
        
        .ranking-card:hover {
            background: rgba(255, 46, 111, 0.15);
            border-color: rgba(255, 46, 111, 0.4);
        }
        
        .ranking-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }
        
        .ranking-1 {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #8b6b00;
        }
        
        .ranking-2 {
            background: linear-gradient(135deg, #c0c0c0, #e0e0e0);
            color: #5a5a5a;
        }
        
        .ranking-3 {
            background: linear-gradient(135deg, #cd7f32, #e39e5a);
            color: #5c3a00;
        }
        
        .ranking-other {
            background: rgba(255, 46, 111, 0.1);
            color: rgba(255, 107, 157, 0.7);
        }
        
        /* Şikayet Gönder Butonu Düzeltmesi */
        #win-complaint .py-3 {
            padding-top: 0.75rem !important;
            padding-bottom: 0.75rem !important;
            display: block !important;
            visibility: visible !important;
        }
        
        /* ÇEVRİMDIŞI TAKİP */
        .online-status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 4px;
        }
        
        .online-status-indicator.online {
            background-color: #4ade80;
            animation: pulse-online 2s infinite;
        }
        
        .online-status-indicator.afk {
            background-color: #fbbf24;
            animation: pulse-afk 2s infinite;
        }
        
        .online-status-indicator.offline {
            background-color: #ef4444;
        }
        
        @keyframes pulse-online {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes pulse-afk {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        /* BİLDİRİM SİSTEMİ GÜNCELLEMESİ */
        .unread-message-indicator {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 18px;
            height: 18px;
            background: linear-gradient(135deg, #ff2e6f, #ff6b9d);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            color: white;
            animation: indicator-pulse 1s infinite;
            z-index: 10;
            box-shadow: 0 0 10px rgba(255, 46, 111, 0.7);
        }
        
        @keyframes indicator-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .has-unread-messages {
            border-color: rgba(255, 46, 111, 0.6) !important;
            box-shadow: 0 0 15px rgba(255, 46, 111, 0.3) !important;
        }
        
        /* DOSYA VE FOTOĞRAF PAYLAŞIMI STİLLERİ */
        .file-attachment-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: rgba(0, 123, 255, 0.15);
            border: 1px solid rgba(0, 123, 255, 0.3);
            color: #007bff;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-attachment-btn:hover {
            background: rgba(0, 123, 255, 0.3);
            border-color: #007bff;
            transform: scale(1.05);
        }
        
        .file-attachment-modal {
            position: fixed;
            inset: 0;
            background: rgba(26, 11, 31, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10002;
            backdrop-filter: blur(10px);
        }
        
        .file-attachment-modal.show {
            display: flex;
        }
        
        .file-attachment-content {
            width: 90%;
            max-width: 400px;
            background: linear-gradient(135deg, rgba(255, 46, 111, 0.15), rgba(255, 107, 157, 0.15));
            border: 2px solid rgba(255, 46, 111, 0.6);
            border-radius: 20px;
            padding: 30px;
            position: relative;
            animation: modal-appear 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .file-attachment-preview {
            width: 100%;
            max-height: 200px;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
            display: none;
        }
        
        .file-attachment-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .file-attachment-preview.active {
            display: block;
        }
        
        .file-attachment-info {
            background: rgba(255, 46, 111, 0.1);
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .file-attachment-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .file-attachment-actions button {
            flex: 1;
            padding: 10px;
            border-radius: 10px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 12px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .file-attachment-send {
            background: linear-gradient(135deg, #ff2e6f, #ff6b9d);
            border: none;
            color: white;
        }
        
        .file-attachment-send:hover {
            background: linear-gradient(135deg, #ff6b9d, #ff2e6f);
            box-shadow: 0 0 20px rgba(255, 46, 111, 0.5);
        }
        
        .file-attachment-cancel {
            background: rgba(255, 46, 111, 0.1);
            border: 1px solid rgba(255, 46, 111, 0.4);
            color: rgba(255, 46, 111, 0.8);
        }
        
        .file-attachment-cancel:hover {
            background: rgba(255, 46, 111, 0.2);
            color: white;
        }
        
        /* DOSYA MESAJI STİLLERİ */
        .msg-file {
            max-width: 250px;
            border-radius: 12px;
            overflow: hidden;
            margin-top: 5px;
            border: 1px solid rgba(255, 46, 111, 0.3);
        }
        
        .msg-file img {
            width: 100%;
            height: auto;
            display: block;
        }
        
        .msg-file-info {
            background: rgba(0, 0, 0, 0.5);
            padding: 8px;
            font-size: 10px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .msg-file-download {
            color: #4ade80;
            cursor: pointer;
            font-size: 12px;
        }
        
        .msg-file-download:hover {
            color: white;
        }
    </style>
</head>
<body>

    <audio id="os-audio" loop><source src="jarvis.mp3" type="audio/mpeg"></audio>
    
    <!-- CYBER CLICK SES EFEKTI -->
    <script>
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playCyberClick() {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.type = 'sine';
            osc.frequency.setValueAtTime(1200, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(400, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.15, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.15);
            osc.start(audioCtx.currentTime);
            osc.stop(audioCtx.currentTime + 0.15);
        }
        
        document.addEventListener('click', (e) => {
            if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
                if (audioCtx.state === 'suspended') audioCtx.resume();
                playCyberClick();
            }
        });
    </script>
    
    <div class="ark-container"><div class="ark-reactor"><div class="ark-inner"></div></div></div>

    <!-- DOSYA EKLEME MODALI -->
    <div id="file-attachment-modal" class="file-attachment-modal">
        <div class="file-attachment-content">
            <button onclick="closeFileAttachmentModal()" class="absolute top-4 right-4 w-10 h-10 rounded-full bg-heart/30 border border-heart/50 flex items-center justify-center text-heart hover:bg-heart hover:text-white transition-all">
                <i class="fas fa-times"></i>
            </button>
            <div class="text-center mb-4">
                <div class="w-16 h-16 rounded-full bg-heart/20 border border-heart/40 flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-paperclip text-2xl text-heart"></i>
                </div>
                <h3 class="text-xl font-bold text-white mb-1">Dosya veya Fotoğraf Ekle</h3>
                <p class="text-sm text-heart/60">Dosya veya fotoğraf seçin</p>
            </div>
            
            <div id="file-attachment-preview" class="file-attachment-preview">
                <!-- Önizleme buraya gelecek -->
            </div>
            
            <div id="file-attachment-info" class="file-attachment-info hidden">
                <p id="file-name"></p>
                <p id="file-size" class="text-xs"></p>
            </div>
            
            <div class="flex flex-col items-center gap-4">
                <label class="w-full py-4 border-2 border-dashed border-heart/40 rounded-xl text-center cursor-pointer hover:border-heart/70 transition-colors">
                    <i class="fas fa-cloud-upload-alt text-3xl text-heart/60 mb-2"></i>
                    <p class="text-sm text-white">Dosya veya fotoğraf seçmek için tıklayın</p>
                    <p class="text-xs text-heart/40 mt-1">PNG, JPG, GIF veya PDF (Max 5MB)</p>
                    <input type="file" id="file-attachment-input" accept="image/*,.pdf,.txt,.doc,.docx" class="hidden" onchange="handleFileSelect(event)">
                </label>
                
                <div class="file-attachment-actions w-full">
                    <button onclick="sendFileAttachment()" id="file-send-btn" class="file-attachment-send" disabled>
                        <i class="fas fa-paper-plane mr-2"></i>Gönder
                    </button>
                    <button onclick="closeFileAttachmentModal()" class="file-attachment-cancel">
                        <i class="fas fa-times mr-2"></i>İptal
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- BILDIRIM TOAST -->
    <div id="notification-toast" class="notification-toast">
        <div class="glass-dark p-4 flex items-center gap-4 min-w-[320px] border-l-4 border-heart">
            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-heart/30 to-love/30 border border-heart/50 flex items-center justify-center animate-pulse">
                <i class="fas fa-heart text-heart text-lg"></i>
            </div>
            <div class="flex-1">
                <p class="text-[10px] text-heart uppercase tracking-widest mb-1 flex items-center gap-2">
                    <span class="w-2 h-2 bg-heart rounded-full animate-ping"></span>
                    Yeni Mesaj
                </p>
                <p id="toast-sender" class="text-white font-bold text-sm"></p>
                <p id="toast-preview" class="text-xs text-white/50 mt-1 truncate max-w-[200px]"></p>
            </div>
            <button onclick="closeToast()" class="text-white/30 hover:text-white transition-colors"><i class="fas fa-times"></i></button>
        </div>
    </div>

    <!-- VIDEO CALL MODAL -->
    <div id="video-call-modal" class="video-call-modal">
        <div class="video-call-content">
            <button onclick="closeVideoCallModal()" class="absolute top-4 right-4 w-10 h-10 rounded-full bg-heart/30 border border-heart/50 flex items-center justify-center text-heart hover:bg-heart hover:text-white transition-all">
                <i class="fas fa-times"></i>
            </button>
            <div class="video-icon-container">
                <i class="fas fa-heart"></i>
            </div>
            <h3 class="text-2xl font-bold text-heart mb-3 tracking-wider">Görüntülü Arama</h3>
            <p class="text-white/70 mb-4">Henüz şov satın almadınız!</p>
            <p class="text-sm text-heart/60 mb-6">Görüntülü arama özelliği için<br>bir şov paketi satın almanız gerekmektedir.</p>
            <button onclick="closeVideoCallModal()" class="px-8 py-3 love-gradient text-white font-bold text-sm uppercase tracking-wider rounded-xl transition-all hover:opacity-90">
                Anladım
            </button>
        </div>
    </div>

    <!-- TRANSITION OVERLAY -->
    <div id="transition-overlay">
        <div class="w-24 h-24 border-4 border-heart/30 border-t-heart rounded-full animate-spin mb-6"></div>
        <p id="transition-text" class="text-lg text-heart tracking-[0.3em] uppercase animate-pulse"></p>
    </div>

    <!-- KILIT EKRANI -->
    <div id="lock-screen" class="lock-bg h-screen w-screen flex items-center justify-center relative overflow-hidden">
        <div id="particles" class="absolute inset-0 pointer-events-none"></div>
        
        <div class="orbit-system">
            <div class="orbit-ring orbit-ring-1"><div class="orbit-heart"><i class="fas fa-heart"></i></div></div>
            <div class="orbit-ring orbit-ring-2"><div class="orbit-heart"><i class="fas fa-heart"></i></div></div>
            <div class="orbit-ring orbit-ring-3"><div class="orbit-heart"><i class="fas fa-heart"></i></div></div>
            <div class="orbit-ring orbit-ring-4"></div>
        </div>

        <div class="lock-container flex flex-col items-center">
            <!-- Logo -->
            <div class="lock-logo-container mb-10">
                <div class="lock-logo-ring"></div>
                <div class="lock-logo-inner">
                    <span class="text-4xl font-black tracking-widest" style="font-family: 'Orbitron', sans-serif; background: linear-gradient(180deg, #ff2e6f, #ff6b9d); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">❤️</span>
                </div>
            </div>

            <!-- Saat ve Tarih -->
            <div class="text-center mb-12">
                <h1 id="lock-clock" class="lock-time text-7xl mb-4">00:00:00</h1>
                <p id="lock-date" class="lock-date text-base mt-6 uppercase"></p>
            </div>

            <!-- Login Kutusu -->
            <div class="login-box w-[380px] p-8 relative">
                <div class="corner-decor tl"></div>
                <div class="corner-decor tr"></div>
                <div class="corner-decor bl"></div>
                <div class="corner-decor br"></div>

                <!-- Tab Seçenekleri -->
                <div class="flex gap-2 mb-6">
                    <button id="tab-login" onclick="showAuthTab('login')" class="auth-tab active flex-1 py-2 rounded-lg text-[10px] uppercase tracking-widest transition-all">
                        <i class="fas fa-sign-in-alt mr-1"></i>Giriş
                    </button>
                    <button id="tab-register" onclick="showAuthTab('register')" class="auth-tab flex-1 py-2 rounded-lg text-[10px] uppercase tracking-widest transition-all">
                        <i class="fas fa-user-plus mr-1"></i>Kayıt
                    </button>
                    <button id="tab-performer" onclick="showAuthTab('performer')" class="auth-tab flex-1 py-2 rounded-lg text-[10px] uppercase tracking-widest transition-all">
                        <i class="fas fa-heart mr-1"></i>Şovcu
                    </button>
                </div>

                <!-- Giriş Formu -->
                <div id="login-form" class="space-y-4">
                    <div class="text-center mb-4">
                        <div class="inline-flex items-center justify-center w-12 h-12 rounded-xl bg-gradient-to-br from-heart/30 to-love/30 border border-heart/40 mb-2">
                            <i class="fas fa-heart text-xl text-heart"></i>
                        </div>
                        <p class="text-[10px] text-heart/70 uppercase tracking-widest">Sistem Girişi</p>
                    </div>
                    <div class="relative group">
                        <i class="fas fa-user absolute left-4 top-1/2 -translate-y-1/2 text-heart/40 group-focus-within:text-heart transition-colors"></i>
                        <input type="text" id="login-user" placeholder="OPERATÖR KODU" class="w-full login-input text-center uppercase tracking-widest">
                    </div>
                    <div class="relative group">
                        <i class="fas fa-lock absolute left-4 top-1/2 -translate-y-1/2 text-heart/40 group-focus-within:text-heart transition-colors"></i>
                        <input type="password" id="login-pass" placeholder="ŞİFRE" class="w-full login-input text-center tracking-widest" onkeypress="if(event.key==='Enter') handleLogin()">
                    </div>
                    <button onclick="handleLogin()" class="w-full login-btn flex items-center justify-center gap-3">
                        <i class="fas fa-heart"></i>
                        <span>Giriş Yap</span>
                    </button>
                </div>

                <!-- Kayıt Formu -->
                <div id="register-form" class="space-y-4 hidden">
                    <div class="text-center mb-2">
                        <div class="inline-flex items-center justify-center w-12 h-12 rounded-xl bg-gradient-to-br from-success/30 to-green-600/30 border border-success/40 mb-2">
                            <i class="fas fa-user-plus text-xl text-success"></i>
                        </div>
                        <p class="text-[10px] text-success/70 uppercase tracking-widest">Yeni Hesap Oluştur</p>
                    </div>
                    <div class="relative group">
                        <i class="fas fa-user absolute left-4 top-1/2 -translate-y-1/2 text-heart/40 group-focus-within:text-heart transition-colors"></i>
                        <input type="text" id="reg-user" placeholder="KULLANICI ADI" class="w-full login-input text-center uppercase tracking-widest">
                    </div>
                    <div class="relative group">
                        <i class="fas fa-id-card absolute left-4 top-1/2 -translate-y-1/2 text-heart/40 group-focus-within:text-heart transition-colors"></i>
                        <input type="text" id="reg-fullname" placeholder="İSİM SOYİSİM" class="w-full login-input text-center tracking-widest">
                    </div>
                    <div class="relative group">
                        <i class="fas fa-lock absolute left-4 top-1/2 -translate-y-1/2 text-heart/40 group-focus-within:text-heart transition-colors"></i>
                        <input type="password" id="reg-pass" placeholder="ŞİFRE" class="w-full login-input text-center tracking-widest">
                    </div>
                    <!-- DÜZELTİLDİ: Kayıt Ol Butonu Tasarımı -->
                    <button onclick="handleRegister()" class="register-btn flex items-center justify-center gap-3">
                        <i class="fas fa-user-plus"></i>
                        <span>Kayıt Ol ve Giriş Yap</span>
                    </button>
                    <div class="bg-success/10 border border-success/20 rounded-lg p-2">
                        <p class="text-[9px] text-success/70 text-center">
                            <i class="fas fa-check-circle mr-1"></i>
                            Kaydınız anında aktif olacaktır. 200 Token hediye!
                        </p>
                    </div>
                </div>

                <!-- Şovcu Giriş Formu -->
                <div id="performer-form" class="space-y-4 hidden">
                    <div class="text-center mb-2">
                        <div class="inline-flex items-center justify-center w-12 h-12 rounded-xl bg-gradient-to-br from-heart/30 to-love/30 border border-heart/40 mb-2">
                            <i class="fas fa-heart text-xl text-heart"></i>
                        </div>
                        <p class="text-[10px] text-heart/70 uppercase tracking-widest">Şovcu Girişi</p>
                    </div>
                    <div class="relative group">
                        <i class="fas fa-heart absolute left-4 top-1/2 -translate-y-1/2 text-heart/40 group-focus-within:text-heart transition-colors"></i>
                        <input type="text" id="performer-user" placeholder="ŞOVCU KODU" class="w-full login-input text-center uppercase tracking-widest">
                    </div>
                    <div class="relative group">
                        <i class="fas fa-key absolute left-4 top-1/2 -translate-y-1/2 text-heart/40 group-focus-within:text-heart transition-colors"></i>
                        <input type="password" id="performer-pass" placeholder="ŞİFRE" class="w-full login-input text-center tracking-widest">
                    </div>
                    <button onclick="handlePerformerLogin()" class="w-full login-btn flex items-center justify-center gap-3">
                        <i class="fas fa-heart"></i>
                        <span>Şovcu Girişi</span>
                    </button>
                    <div class="bg-heart/10 border border-heart/20 rounded-lg p-2">
                        <p class="text-[9px] text-heart/70 text-center">
                            <i class="fas fa-info-circle mr-1"></i>
                            Şovcu hesapları sadece admin tarafından oluşturulur.
                        </p>
                    </div>
                </div>

                <!-- Alt Durum -->
                <div class="flex items-center justify-center gap-6 mt-6 pt-4 border-t border-heart/10">
                    <div class="flex items-center gap-2 text-[9px] text-heart/40 uppercase tracking-wider">
                        <div class="w-1.5 h-1.5 bg-success rounded-full animate-pulse"></div>
                        <span>Bağlı</span>
                    </div>
                    <div class="flex items-center gap-2 text-[9px] text-heart/40 uppercase tracking-wider">
                        <div class="w-1.5 h-1.5 bg-heart rounded-full"></div>
                        <span>Şifreli</span>
                    </div>
                    <div class="flex items-center gap-2 text-[9px] text-heart/40 uppercase tracking-wider">
                        <div class="w-1.5 h-1.5 bg-love rounded-full animate-pulse"></div>
                        <span>Aktif</span>
                    </div>
                </div>

                <!-- Alt Dekorasyon -->
                <div class="absolute -bottom-px left-1/2 -translate-x-1/2 w-16 h-1 bg-gradient-to-r from-transparent via-heart/50 to-transparent rounded-full"></div>
            </div>
        </div>

        <!-- Developer Imzasi -->
        <div class="developer-signature">
            <i class="fab fa-instagram"></i>
            <span>@cankayadeveloper</span>
        </div>
    </div>

    <!-- DESKTOP -->
    <div id="desktop" class="hidden h-screen w-screen relative overflow-hidden">
        <div class="absolute inset-0 opacity-5" style="background-image: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"50\" height=\"50\"><path d=\"M25,15 Q30,10 35,15 Q40,20 25,25 Q20,20 25,15 Z\" fill=\"none\" stroke=\"%23ff2e6f\" stroke-width=\"0.5\"/></svg>');"></div>

        <!-- Üst Bar -->
        <div class="absolute top-0 left-0 right-0 h-16 glass-dark border-b border-heart/20 flex items-center justify-between px-6 z-50">
            <div class="flex items-center gap-4">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-heart/30 to-love/30 border border-heart/50 flex items-center justify-center">
                    <i class="fas fa-heart text-heart"></i>
                </div>
                <div>
                    <h1 class="text-sm font-bold text-white tracking-widest">C.N.K.Y OS</h1>
                    <p class="text-[9px] text-heart/50 uppercase">Kernel v6.1</p>
                </div>
            </div>

            <div id="main-desktop-clock" class="text-3xl font-bold text-heart tracking-[0.3em]" style="font-family: 'Orbitron', sans-serif;">00:00:00</div>

            <div class="flex items-center gap-6">
                <!-- TOKEN YÜKLE BUTONU -->
                <button onclick="toggleWin('win-token')" class="flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-success/20 to-green-600/20 border border-success/30 rounded-lg hover:border-success/50 hover:bg-success/20 transition-all group">
                    <i class="fas fa-plus-circle text-success group-hover:scale-110 transition-transform"></i>
                    <span class="text-[10px] text-success uppercase tracking-wider font-bold">Token Yükle</span>
                </button>

                <!-- TOKEN GÖSTERGE -->
                <div class="token-display">
                    <i class="fas fa-heart token-icon"></i>
                    <span id="user-token-display" class="token-value">0</span>
                    <span class="text-[9px] text-yellow-500/50 uppercase">Token</span>
                </div>
                
                <div class="flex items-center gap-2 text-[10px]">
                    <div class="w-2 h-2 rounded-full bg-success animate-pulse"></div>
                    <span id="top-user-label" class="text-heart/70 uppercase tracking-wider">Birim: ---</span>
                </div>
                <div class="flex items-center gap-4 text-heart/50">
                    <div class="stat-box flex items-center gap-2 py-1 px-3">
                        <i class="fas fa-microchip text-[10px]"></i>
                        <span id="cpu-val" class="text-[10px] font-bold">--%</span>
                    </div>
                    <div class="stat-box flex items-center gap-2 py-1 px-3">
                        <i class="fas fa-heartbeat text-[10px]"></i>
                        <span id="gpu-val" class="text-[10px] font-bold">--C</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ana Içerik -->
        <div class="absolute top-20 bottom-24 left-6 right-6 flex gap-6">
            <!-- Sol Panel - Aktif Kullanıcılar -->
            <div class="w-72 flex flex-col gap-4">
                <div class="panel-card flex-1 flex flex-col">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-lg bg-success/20 flex items-center justify-center">
                                <i class="fas fa-signal text-success text-sm"></i>
                            </div>
                            <div>
                                <h3 class="text-xs font-bold text-white uppercase tracking-wider">Aktif Birimler</h3>
                                <p id="online-count" class="text-[9px] text-success">0 çevrimiçi</p>
                            </div>
                        </div>
                    </div>
                    <div id="active-user-list" class="flex-1 overflow-y-auto space-y-2 pr-2"></div>
                </div>

                <!-- Aktif Şovcular Paneli -->
                <div class="panel-card flex-1 flex flex-col" style="border-color: rgba(255, 46, 111, 0.4);">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-lg bg-heart/20 flex items-center justify-center">
                                <i class="fas fa-heart text-heart text-sm"></i>
                            </div>
                            <div>
                                <h3 class="text-xs font-bold text-heart uppercase tracking-wider">Aktif Şovcular</h3>
                                <p id="performer-online-count" class="text-[9px] text-heart">0 çevrimiçi</p>
                            </div>
                        </div>
                    </div>
                    <div id="active-performer-list" class="flex-1 overflow-y-auto space-y-2 pr-2"></div>
                </div>
            </div>

            <!-- Orta - Boş Alan -->
            <div class="flex-1 relative">
                <div id="center-animation" class="absolute inset-0 overflow-hidden pointer-events-none">
                    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2">
                        <div class="w-[400px] h-[400px] border border-heart/10 rounded-full animate-[spin_30s_linear_infinite]"></div>
                    </div>
                    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2">
                        <div class="w-[300px] h-[300px] border border-heart/15 rounded-full animate-[spin_20s_linear_infinite_reverse]" style="border-style: dashed;"></div>
                    </div>
                    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2">
                        <div class="w-[200px] h-[200px] border-2 border-heart/20 rounded-full animate-[spin_15s_linear_infinite]"></div>
                    </div>
                    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[150px] h-[150px] bg-gradient-radial from-heart/10 to-transparent rounded-full animate-pulse"></div>
                    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[80px] h-[80px] bg-heart/5 rounded-full blur-xl animate-ping" style="animation-duration: 3s;"></div>
                    <div class="center-heart" style="top: 20%; left: 30%;">❤️</div>
                    <div class="center-heart" style="top: 70%; left: 25%;">❤️</div>
                    <div class="center-heart" style="top: 40%; left: 70%;">❤️</div>
                    <div class="center-heart" style="top: 80%; left: 65%;">❤️</div>
                    <div class="center-heart" style="top: 15%; left: 60%;">❤️</div>
                    <div class="center-heart" style="top: 55%; left: 15%;">❤️</div>
                </div>
            </div>

            <!-- Sağ Panel -->
            <div class="w-64 flex flex-col gap-4">
                <div class="panel-card">
                    <h3 class="text-xs font-bold text-white uppercase tracking-wider mb-4">Hızlı Erişim</h3>
                    <div class="space-y-2">
                        <button onclick="openGlobalChat()" class="w-full flex items-center gap-3 p-3 rounded-lg bg-heart/5 border border-heart/10 hover:border-heart/50 hover:bg-heart/10 transition-all text-left">
                            <i class="fas fa-globe text-heart"></i>
                            <span class="text-xs text-white/70">Global Terminal</span>
                        </button>
                        <button onclick="openFileManager()" class="w-full flex items-center gap-3 p-3 rounded-lg bg-yellow-500/5 border border-yellow-500/10 hover:border-yellow-500/50 hover:bg-yellow-500/10 transition-all text-left">
                            <i class="fas fa-folder text-yellow-400"></i>
                            <span class="text-xs text-white/70">Dosya Sistemi</span>
                        </button>
                        <!-- SIRALAMA BUTONU -->
                        <button onclick="openRankingWindow()" class="w-full flex items-center gap-3 p-3 rounded-lg bg-blue-500/5 border border-blue-500/10 hover:border-blue-500/50 hover:bg-blue-500/10 transition-all text-left">
                            <i class="fas fa-trophy text-blue-400"></i>
                            <span class="text-xs text-white/70">Sıralamalar</span>
                        </button>
                        <!-- BİLGİ BUTONU -->
                        <button onclick="openBilgiWindow()" class="w-full flex items-center gap-3 p-3 rounded-lg bg-purple-500/5 border border-purple-500/10 hover:border-purple-500/50 hover:bg-purple-500/10 transition-all text-left">
                            <i class="fas fa-info-circle text-purple-400"></i>
                            <span class="text-xs text-white/70">Bilgi Al</span>
                        </button>
                        <!-- ŞİKAYET TALEBİ BUTONU -->
                        <button onclick="openComplaintWindow()" class="w-full flex items-center gap-3 p-3 rounded-lg bg-red-500/5 border border-red-500/10 hover:border-red-500/50 hover:bg-red-500/10 transition-all text-left">
                            <i class="fas fa-exclamation-triangle text-red-400"></i>
                            <span class="text-xs text-white/70">Şikayet Talebi</span>
                        </button>
                        
                        <!-- MOBİL İÇİN PROFİL VE ÇIKIŞ BUTONLARI - DÜZELTİLDİ: Tek bir grup -->
                        <div id="mobile-access" class="mobile-quick-access hidden">
                            <button onclick="openMyProfile()" class="w-full flex items-center gap-3 p-3 rounded-lg bg-heart/5 border border-heart/10 hover:border-heart/50 hover:bg-heart/10 transition-all text-left">
                                <i class="fas fa-id-card text-heart"></i>
                                <span class="text-xs text-white/70">Profilim</span>
                            </button>
                            <!-- Sadece ADMIN için Sistem Yönetimi butonu -->
                            <div id="mobile-admin-btn" class="hidden">
                                <button onclick="toggleWin('win-admin')" class="w-full flex items-center gap-3 p-3 rounded-lg bg-heart/5 border border-heart/10 hover:border-heart/50 hover:bg-heart/10 transition-all text-left">
                                    <i class="fas fa-terminal text-heart"></i>
                                    <span class="text-xs text-white/70">Sistem Yönetimi</span>
                                </button>
                            </div>
                            <button onclick="handleLogout()" class="w-full flex items-center gap-3 p-3 rounded-lg bg-red-500/5 border border-red-500/10 hover:border-red-500/50 hover:bg-red-500/10 transition-all text-left">
                                <i class="fas fa-power-off text-red-400"></i>
                                <span class="text-xs text-white/70">Çıkış Yap</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="panel-card flex-1">
                    <h3 class="text-xs font-bold text-white uppercase tracking-wider mb-4">Sistem İzleme</h3>
                    <div class="space-y-4">
                        <div>
                            <div class="flex justify-between text-[10px] mb-1">
                                <span class="text-heart/50">CPU</span>
                                <span id="cpu-percent" class="text-heart font-bold">--%</span>
                            </div>
                            <div class="h-2 bg-heart/10 rounded-full overflow-hidden">
                                <div id="cpu-bar" class="h-full love-gradient rounded-full transition-all" style="width: 0%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-[10px] mb-1">
                                <span class="text-heart/50">BELLEK</span>
                                <span id="mem-percent" class="text-heart font-bold">--%</span>
                            </div>
                            <div class="h-2 bg-heart/10 rounded-full overflow-hidden">
                                <div id="mem-bar" class="h-full bg-gradient-to-r from-success to-emerald-500 rounded-full transition-all" style="width: 0%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-[10px] mb-1">
                                <span class="text-heart/50">AĞ</span>
                                <span id="net-val" class="text-heart font-bold">-- KB/s</span>
                            </div>
                            <div class="h-2 bg-heart/10 rounded-full overflow-hidden">
                                <div id="net-bar" class="h-full love-gradient rounded-full transition-all" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PENCERELER -->
        
        <!-- GLOBAL CHAT -->
        <div id="win-global" class="window glass-dark">
            <div class="window-header">
                <div class="window-header-title">
                    <div class="window-header-icon bg-heart/20 text-heart"><i class="fas fa-globe"></i></div>
                    <div>
                        <h3 class="text-sm font-bold text-white uppercase tracking-wider">Global Terminal</h3>
                        <p class="text-[9px] text-heart/50">Herkese açık mesajlar</p>
                    </div>
                </div>
                <button onclick="toggleWin('win-global')" class="window-close"><i class="fas fa-times text-xs"></i></button>
            </div>
            <div id="global-chat-area" class="flex-1 overflow-y-auto p-4 space-y-3"></div>
            <div class="p-4 border-t border-heart/10 flex gap-3">
                <input id="global-input" type="text" placeholder="Mesajınızı yazın..." class="input-love flex-1 text-sm" onkeypress="if(event.key==='Enter') sendGlobalMsg()">
                <button onclick="sendGlobalMsg()" class="px-4 py-2 bg-heart/20 border border-heart/50 rounded-lg text-heart hover:bg-heart hover:text-white transition-all">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>

        <!-- ÖZEL CHAT -->
        <div id="win-chat" class="window glass-dark">
            <div class="window-header">
                <div class="window-header-title">
                    <div class="window-header-icon bg-success/20 text-success"><i class="fas fa-comments"></i></div>
                    <div>
                        <h3 id="chat-title" class="text-sm font-bold text-white uppercase tracking-wider">Özel Hat</h3>
                        <p class="text-[9px] text-success/50">Şifreli iletişim</p>
                    </div>
                </div>
                <button onclick="closeChatWindow()" class="window-close"><i class="fas fa-times text-xs"></i></button>
            </div>
            <div id="chat-area" class="flex-1 overflow-y-auto p-4 space-y-3"></div>
            
            <!-- Token Gönder Bölümü -->
            <div class="p-3 border-t border-heart/10 bg-yellow-500/5 flex items-center gap-2">
                <i class="fas fa-heart text-yellow-500 text-sm"></i>
                <input id="token-send-amount" type="number" placeholder="Miktar" class="input-love w-20 text-xs py-1 px-2" min="1">
                <button onclick="sendTokenToUser()" class="px-3 py-1.5 bg-yellow-500/20 border border-yellow-500/50 rounded-lg text-yellow-400 text-[10px] uppercase tracking-wider hover:bg-yellow-500 hover:text-white transition-all">
                    Token Gönder
                </button>
            </div>
            
            <div class="p-4 border-t border-heart/10 flex gap-3">
                <div class="file-attachment-btn" onclick="openFileAttachmentModal()" title="Dosya veya fotoğraf ekle">
                    <i class="fas fa-paperclip"></i>
                </div>
                <input id="msg-input" type="text" placeholder="Mesajınızı yazın..." class="input-love flex-1 text-sm" onkeypress="if(event.key==='Enter') sendMsg()">
                <button onclick="sendMsg()" class="px-4 py-2 bg-success/20 border border-success/50 rounded-lg text-success hover:bg-success hover:text-white transition-all">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>

        <!-- ŞOVCU CHAT -->
        <div id="win-performer-chat" class="window glass-dark">
            <div class="window-header">
                <div class="window-header-title">
                    <div class="window-header-icon bg-heart/20 text-heart"><i class="fas fa-heart"></i></div>
                    <div>
                        <h3 id="performer-chat-title" class="text-sm font-bold text-white uppercase tracking-wider">Şovcu Chat</h3>
                        <p class="text-[9px] text-heart/50">Premium görüntülü arama</p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <button onclick="showVideoCallModal()" class="w-8 h-8 rounded-lg bg-heart/20 border border-heart/50 text-heart flex items-center justify-center hover:bg-heart hover:text-white transition-all" title="Görüntülü Arama">
                        <i class="fas fa-video"></i>
                    </button>
                    <button onclick="toggleWin('win-performer-chat')" class="window-close"><i class="fas fa-times text-xs"></i></button>
                </div>
            </div>
            <div id="performer-chat-area" class="flex-1 overflow-y-auto p-4 space-y-3"></div>
            
            <!-- Token Gönder Bölümü (Şovcu Chat için) -->
            <div class="p-3 border-t border-heart/10 bg-heart/5 flex items-center gap-2">
                <i class="fas fa-heart text-yellow-500 text-sm"></i>
                <input id="performer-token-send-amount" type="number" placeholder="Miktar" class="input-love w-20 text-xs py-1 px-2" min="1">
                <button onclick="sendTokenToPerformer()" class="px-3 py-1.5 bg-yellow-500/20 border border-yellow-500/50 rounded-lg text-yellow-400 text-[10px] uppercase tracking-wider hover:bg-yellow-500 hover:text-white transition-all">
                    Token Gönder
                </button>
            </div>
            
            <div class="p-4 border-t border-heart/10 flex gap-3">
                <div class="file-attachment-btn" onclick="openFileAttachmentModal()" title="Dosya veya fotoğraf ekle">
                    <i class="fas fa-paperclip"></i>
                </div>
                <input id="performer-msg-input" type="text" placeholder="Mesajınızı yazın..." class="input-love flex-1 text-sm" onkeypress="if(event.key==='Enter') sendPerformerMsg()">
                <button onclick="sendPerformerMsg()" class="px-4 py-2 bg-heart/20 border border-heart/50 rounded-lg text-heart hover:bg-heart hover:text-white transition-all">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>

        <!-- ADMIN PANELİ -->
        <div id="win-admin" class="window glass-dark overflow-hidden">
            <div class="window-header">
                <div class="window-header-title">
                    <div class="window-header-icon bg-heart/20 text-heart"><i class="fas fa-terminal"></i></div>
                    <div>
                        <h3 class="text-sm font-bold text-white uppercase tracking-wider">Sistem Yönetimi</h3>
                        <p class="text-[9px] text-heart/50">Sadece yetkili personel</p>
                    </div>
                </div>
                <button onclick="toggleWin('win-admin')" class="window-close"><i class="fas fa-times text-xs"></i></button>
            </div>
            <div class="flex-1 overflow-y-auto p-4 space-y-4">
                <!-- Kullanıcı Ekle -->
                <div class="panel-card p-4">
                    <h4 class="text-xs font-bold text-white uppercase tracking-wider mb-3"><i class="fas fa-user-plus text-heart mr-2"></i>Yeni Birim Ekle</h4>
                    <div class="grid grid-cols-2 gap-3 mb-3">
                        <input id="new-name" placeholder="OPERATÖR KODU" class="input-love text-xs uppercase">
                        <input id="new-pass" type="password" placeholder="ŞİFRE" class="input-love text-xs">
                        <input id="new-fullname" placeholder="İSİM SOYİSİM" class="input-love text-xs">
                        <input id="new-token" type="number" placeholder="TOKEN (Varsayılan: 200)" class="input-love text-xs">
                    </div>
                    <button onclick="addUser()" class="btn-love w-full text-xs">
                        <i class="fas fa-plus mr-2"></i>Ekle
                    </button>
                </div>

                <!-- Mevcut Birimler -->
                <div class="panel-card p-4">
                    <h4 class="text-xs font-bold text-white uppercase tracking-wider mb-3"><i class="fas fa-users text-heart mr-2"></i>Kayıtlı Birimler</h4>
                    <div id="admin-user-list" class="space-y-2 max-h-48 overflow-y-auto"></div>
                </div>

                <!-- ŞOVCU YÖNETİMİ - GÜNCELLENDİ (Mavi Tik Seçeneği Eklendi) -->
                <div class="panel-card p-4" style="border-color: rgba(255, 46, 111, 0.4);">
                    <h4 class="text-xs font-bold text-heart uppercase tracking-wider mb-3"><i class="fas fa-heart mr-2"></i>Şovcu Yönetimi</h4>
                    <div class="grid grid-cols-2 gap-3 mb-3">
                        <input id="performer-name" placeholder="ŞOVCU KODU" class="input-love text-xs uppercase">
                        <input id="performer-password" type="password" placeholder="ŞİFRE" class="input-love text-xs">
                        <input id="performer-fullname" placeholder="ŞOVCU ADI" class="input-love text-xs">
                        <div class="flex items-center gap-2 col-span-2">
                            <input type="checkbox" id="performer-verified" class="w-4 h-4 rounded">
                            <label for="performer-verified" class="text-xs text-white/70 flex items-center gap-1">
                                <span class="verified-badge" style="width: 14px; height: 14px;"></span>
                                Mavi Tik (Güvenilir Şovcu)
                            </label>
                        </div>
                    </div>
                    <button onclick="addPerformer()" class="w-full btn-love text-xs">
                        <i class="fas fa-plus mr-2"></i>Şovcu Ekle
                    </button>
                    <div id="performer-list" class="mt-3 space-y-2 max-h-32 overflow-y-auto"></div>
                </div>
                
                <!-- TOKEN FİYAT YÖNETİMİ -->
                <div class="panel-card p-4" style="border-color: rgba(255, 215, 0, 0.4);">
                    <h4 class="text-xs font-bold text-yellow-400 uppercase tracking-wider mb-3"><i class="fas fa-tag mr-2"></i>Token Fiyat Yönetimi</h4>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <span class="text-xs text-white">950 Token Paketi</span>
                            <div class="flex items-center gap-2">
                                <input type="number" id="price-950" placeholder="Fiyat" class="input-love w-24 text-xs py-1 px-2" value="950">
                                <span class="text-xs text-yellow-400">TL</span>
                            </div>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-xs text-white">2.000 Token Paketi</span>
                            <div class="flex items-center gap-2">
                                <input type="number" id="price-2000" placeholder="Fiyat" class="input-love w-24 text-xs py-1 px-2" value="2000">
                                <span class="text-xs text-yellow-400">TL</span>
                            </div>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-xs text-white">10.000 Token Paketi</span>
                            <div class="flex items-center gap-2">
                                <input type="number" id="price-10000" placeholder="Fiyat" class="input-love w-24 text-xs py-1 px-2" value="10000">
                                <span class="text-xs text-yellow-400">TL</span>
                            </div>
                        </div>
                    </div>
                    <button onclick="updateTokenPrices()" class="w-full mt-3 py-2 bg-gradient-to-r from-yellow-500 to-orange-500 hover:opacity-90 text-white font-bold text-xs uppercase tracking-[0.2em] rounded-xl transition-all duration-300 flex items-center justify-center gap-3">
                        <i class="fas fa-save"></i>
                        <span>Fiyatları Güncelle</span>
                    </button>
                </div>

                <!-- TOKEN TALEPLERİ -->
                <div class="panel-card p-4" style="border-color: rgba(74, 222, 128, 0.4);">
                    <h4 class="text-xs font-bold text-success uppercase tracking-wider mb-3"><i class="fas fa-heart mr-2"></i>Token Talepleri <span id="token-request-count" class="text-[9px] text-success/50"></span></h4>
                    <div id="token-requests-list" class="space-y-2 max-h-48 overflow-y-auto"></div>
                </div>
            </div>
        </div>

        <!-- TOKEN YÜKLE PENCERESİ - GÜNCELLENDİ -->
        <div id="win-token" class="window glass-dark">
            <div class="window-header">
                <div class="window-header-title">
                    <div class="window-header-icon bg-success/20 text-success"><i class="fas fa-heart"></i></div>
                    <div>
                        <h3 class="text-sm font-bold text-white uppercase tracking-wider">Token Yükle</h3>
                        <p class="text-[9px] text-success/50">Bakiye yönetimi</p>
                    </div>
                </div>
                <button onclick="toggleWin('win-token')" class="window-close"><i class="fas fa-times text-xs"></i></button>
            </div>
            <div class="p-6 space-y-4">
                <!-- Ödeme Bilgileri -->
                <div class="bank-info-box">
                    <h4 class="text-xs font-bold text-success uppercase tracking-wider mb-3"><i class="fas fa-heart mr-2"></i>Ödeme Bilgileri</h4>
                    
                    <div class="bank-info-row">
                        <div>
                            <p class="text-[9px] text-heart/50 uppercase mb-1">Açıklama</p>
                            <p class="text-xs text-white font-bold text-center">ÖDEMELER ŞOVCUYA YAPILIR</p>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <p class="text-[10px] text-heart/70 text-center">
                            <i class="fas fa-info-circle mr-1"></i>
                            Şovcu ile iletişime geçerek ödeme detaylarını alabilirsiniz.
                        </p>
                    </div>
                </div>

                <!-- Token Paketleri -->
                <div class="space-y-3">
                    <h4 class="text-xs font-bold text-white uppercase tracking-wider"><i class="fas fa-heart text-heart mr-2"></i>Paket Seçin</h4>
                    
                    <label class="token-package-option">
                        <input type="radio" name="token-package" value="950" data-price="950">
                        <div class="package-content">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-lg bg-yellow-500/20 flex items-center justify-center">
                                    <i class="fas fa-heart text-yellow-400"></i>
                                </div>
                                <div>
                                    <p class="text-sm font-bold text-white">950 Token</p>
                                    <p class="text-[10px] text-yellow-500/50">Başlangıç paketi</p>
                                </div>
                            </div>
                            <span id="price-950-display" class="text-success font-bold">950 TL</span>
                        </div>
                    </label>
                    
                    <label class="token-package-option">
                        <input type="radio" name="token-package" value="2000" data-price="2000">
                        <div class="package-content">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-yellow-500/30 to-orange-500/30 flex items-center justify-center">
                                    <i class="fas fa-gem text-yellow-400"></i>
                                </div>
                                <div>
                                    <p class="text-sm font-bold text-white">2.000 Token</p>
                                    <p class="text-[10px] text-yellow-500/50">Standart paket</p>
                                </div>
                            </div>
                            <span id="price-2000-display" class="text-success font-bold">2.000 TL</span>
                        </div>
                    </label>
                    
                    <label class="token-package-option">
                        <input type="radio" name="token-package" value="10000" data-price="10000">
                        <div class="package-content">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-heart/40 to-love/40 flex items-center justify-center">
                                    <i class="fas fa-crown text-heart"></i>
                                </div>
                                <div>
                                    <p class="text-sm font-bold text-white">10.000 Token</p>
                                    <p class="text-[10px] text-heart/70">VIP Paket - En Avantajlı</p>
                                </div>
                            </div>
                            <span id="price-10000-display" class="text-success font-bold">10.000 TL</span>
                        </div>
                    </label>
                </div>
                
                <button onclick="requestTokenVerification()" class="w-full btn-love text-sm">
                    <i class="fas fa-check-circle mr-2"></i>
                    Ödeme Yaptım, Kontrol Et
                </button>
                
                <div class="bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-3">
                    <p class="text-[10px] text-center text-yellow-400/80">
                        <i class="fas fa-clock mr-1"></i>
                        Ortalama 1 saat içinde yükleme talebiniz kontrol edilecektir.
                    </p>
                </div>
            </div>
        </div>

        <!-- PROFİL PENCERESİ -->
        <div id="win-profile" class="window glass-dark">
            <div class="window-header">
                <div class="window-header-title">
                    <div class="window-header-icon bg-heart/20 text-heart"><i class="fas fa-id-card"></i></div>
                    <div>
                        <h3 class="text-sm font-bold text-white uppercase tracking-wider">Profil</h3>
                        <p class="text-[9px] text-heart/50">Hesap bilgileri</p>
                    </div>
                </div>
                <button onclick="toggleWin('win-profile')" class="window-close"><i class="fas fa-times text-xs"></i></button>
            </div>
            <div id="profile-content" class="p-6"></div>
        </div>

        <!-- DOSYA SİSTEMİ -->
        <div id="win-files" class="window glass-dark">
            <div id="files-password-overlay" class="file-password-overlay">
                <button onclick="toggleWin('win-files')" class="absolute top-4 right-4 w-10 h-10 rounded-lg bg-heart/10 border border-heart/30 flex items-center justify-center text-heart hover:bg-heart hover:text-white transition-all">
                    <i class="fas fa-times"></i>
                </button>
                <div class="w-20 h-20 rounded-full bg-heart/10 border-2 border-heart/30 flex items-center justify-center mb-6">
                    <i class="fas fa-heart text-4xl text-heart"></i>
                </div>
                <h3 class="text-lg font-bold tracking-widest uppercase mb-2 text-white">Güvenli Dosya Sistemi</h3>
                <p class="text-xs text-heart/50 mb-6">Erişim için şifre gerekli</p>
                <div class="flex flex-col items-center gap-4">
                    <input type="password" id="files-password" placeholder="ŞİFRE GİRİN" class="input-love w-64 text-center" onkeypress="if(event.key==='Enter') checkFilesPassword()">
                    <button onclick="checkFilesPassword()" class="btn-primary">
                        <i class="fas fa-heart mr-2"></i>Kilidi Aç
                    </button>
                </div>
                <p id="files-error" class="text-heart text-xs mt-4 hidden">Hatalı şifre!</p>
            </div>

            <div class="window-header">
                <div class="window-header-title">
                    <div class="window-header-icon bg-yellow-500/20 text-yellow-400"><i class="fas fa-folder"></i></div>
                    <div>
                        <h3 class="text-sm font-bold text-white uppercase tracking-wider">Dosya Sistemi</h3>
                        <p class="text-[9px] text-yellow-500/50">Notlarınız</p>
                    </div>
                </div>
                <button onclick="toggleWin('win-files')" class="window-close"><i class="fas fa-times text-xs"></i></button>
            </div>
            <div id="files-content" class="flex-1 overflow-y-auto p-4 space-y-2"></div>
            <div class="p-3 border-t border-heart/10 flex justify-between items-center text-xs text-heart/50">
                <span id="file-count">0 not</span>
                <span class="text-[10px]">Şifreli Depolama</span>
            </div>
        </div>

        <!-- NOT EDITORU -->
        <div id="win-note-editor" class="window glass-dark">
            <div class="window-header">
                <div class="window-header-title">
                    <div class="window-header-icon bg-heart/20 text-heart"><i class="fas fa-file-alt"></i></div>
                    <div>
                        <h3 id="note-editor-title" class="text-sm font-bold text-white uppercase tracking-wider">Yeni Not</h3>
                        <p class="text-[9px] text-heart/50">.txt dosyası</p>
                    </div>
                </div>
                <button onclick="toggleWin('win-note-editor')" class="window-close"><i class="fas fa-times text-xs"></i></button>
            </div>
            <div class="p-4 flex-1 flex flex-col gap-4">
                <input type="text" id="note-title" placeholder="Not başlığı..." class="input-love text-sm">
                <textarea id="note-content" class="input-love flex-1" placeholder="Notunuzu yazın..."></textarea>
            </div>
            <div class="p-4 border-t border-heart/10 flex gap-3">
                <button onclick="saveNote()" class="btn-primary flex-1">
                    <i class="fas fa-save mr-2"></i>Kaydet
                </button>
                <button onclick="toggleWin('win-note-editor')" class="px-6 py-3 border border-heart/30 rounded-lg text-heart/50 hover:border-heart hover:text-heart transition-all text-xs uppercase tracking-wider">
                    İptal
                </button>
            </div>
        </div>

        <!-- ŞİKAYET TALEBİ PENCERESİ -->
        <div id="win-complaint" class="window glass-dark">
            <div class="window-header">
                <div class="window-header-title">
                    <div class="window-header-icon bg-red-500/20 text-red-400"><i class="fas fa-exclamation-triangle"></i></div>
                    <div>
                        <h3 class="text-sm font-bold text-white uppercase tracking-wider">Şikayet Talebi</h3>
                        <p class="text-[9px] text-red-400/50">Sorunlarınızı bize bildirin</p>
                    </div>
                </div>
                <button onclick="toggleWin('win-complaint')" class="window-close"><i class="fas fa-times text-xs"></i></button>
            </div>
            <div class="p-6 space-y-4">
                <!-- DÜZELTİLDİ: Arka plan eklendi -->
                <div class="complaint-warning-box">
                    <p class="text-xs text-red-400 text-center mb-2">
                        <i class="fas fa-info-circle mr-1"></i>
                        Herhangi bir sorun yaşıyorsanız lütfen aşağıdaki formu doldurun.
                    </p>
                    <p class="text-[10px] text-red-400/70 text-center">
                        Sistem yöneticileri en kısa sürede size dönüş yapacaktır.
                    </p>
                </div>
                
                <div class="space-y-3">
                    <div>
                        <label class="text-[10px] text-white/70 uppercase tracking-wider block mb-1">Şikayet Başlığı</label>
                        <input type="text" id="complaint-title" placeholder="Örn: Token yükleme sorunu" class="input-love w-full text-sm">
                    </div>
                    
                    <div>
                        <label class="text-[10px] text-white/70 uppercase tracking-wider block mb-1">Şikayet Türü</label>
                        <select id="complaint-type" class="input-love w-full text-sm">
                            <option value="token">Token Sorunu</option>
                            <option value="performer">Şovcu Sorunu</option>
                            <option value="chat">Chat Sorunu</option>
                            <option value="system">Sistem Sorunu</option>
                            <option value="other">Diğer</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="text-[10px] text-white/70 uppercase tracking-wider block mb-1">Detaylı Açıklama</label>
                        <textarea id="complaint-description" rows="5" placeholder="Sorununuzu detaylı bir şekilde açıklayın..." class="input-love w-full text-sm"></textarea>
                    </div>
                    
                    <div>
                        <label class="text-[10px] text-white/70 uppercase tracking-wider block mb-1">Öncelik Durumu</label>
                        <div class="flex gap-2">
                            <label class="flex items-center gap-1">
                                <input type="radio" name="priority" value="low" checked>
                                <span class="text-xs text-white/50">Düşük</span>
                            </label>
                            <label class="flex items-center gap-1">
                                <input type="radio" name="priority" value="medium">
                                <span class="text-xs text-yellow-400/70">Orta</span>
                            </label>
                            <label class="flex items-center gap-1">
                                <input type="radio" name="priority" value="high">
                                <span class="text-xs text-red-400/70">Yüksek</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <button onclick="submitComplaint()" class="w-full py-3 bg-gradient-to-r from-red-500 to-pink-600 hover:opacity-90 text-white font-bold text-sm uppercase tracking-[0.2em] rounded-xl transition-all duration-300 shadow-lg shadow-red-500/20 hover:shadow-red-500/40 flex items-center justify-center gap-3">
                    <i class="fas fa-paper-plane"></i>
                    <span>Şikayeti Gönder</span>
                </button>
                
                <!-- DÜZELTİLDİ: Arka plan eklendi -->
                <div class="complaint-warning-box">
                    <p class="text-[10px] text-center text-heart/70">
                        <i class="fas fa-clock mr-1"></i>
                        Şikayetiniz sisteme kaydedildikten sonra en kısa sürede değerlendirilecektir.
                    </p>
                </div>
            </div>
        </div>

        <!-- ADMIN ŞİKAYET YÖNETİMİ PENCERESİ -->
        <div id="win-complaint-admin" class="window glass-dark">
            <div class="window-header">
                <div class="window-header-title">
                    <div class="window-header-icon bg-red-500/20 text-red-400"><i class="fas fa-exclamation-triangle"></i></div>
                    <div>
                        <h3 class="text-sm font-bold text-white uppercase tracking-wider">Şikayet Yönetimi</h3>
                        <p class="text-[9px] text-red-400/50">Sistem şikayetleri</p>
                    </div>
                </div>
                <button onclick="toggleWin('win-complaint-admin')" class="window-close"><i class="fas fa-times text-xs"></i></button>
            </div>
            <div class="flex-1 overflow-y-auto p-4 space-y-3">
                <div id="complaints-list" class="space-y-3">
                    <!-- Şikayetler buraya dinamik olarak yüklenecek -->
                    <p class="text-xs text-center text-white/30 py-8">Yükleniyor...</p>
                </div>
            </div>
        </div>

        <!-- SIRALAMALAR PENCERESİ -->
        <div id="win-siralama" class="window glass-dark">
            <div class="window-header">
                <div class="window-header-title">
                    <div class="window-header-icon bg-blue-500/20 text-blue-400"><i class="fas fa-trophy"></i></div>
                    <div>
                        <h3 class="text-sm font-bold text-white uppercase tracking-wider">Sıralamalar</h3>
                        <p class="text-[9px] text-blue-400/50">En çok token yükleyenler</p>
                    </div>
                </div>
                <button onclick="toggleWin('win-siralama')" class="window-close"><i class="fas fa-times text-xs"></i></button>
            </div>
            <div class="flex-1 overflow-y-auto p-6">
                <div class="text-center mb-6">
                    <div class="w-20 h-20 rounded-full bg-gradient-to-br from-yellow-500/30 to-orange-500/30 border-2 border-yellow-500/50 flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-trophy text-3xl text-yellow-400"></i>
                    </div>
                    <h4 class="text-lg font-bold text-white mb-2">Token Lider Tablosu</h4>
                    <p class="text-xs text-heart/50">Sistemdeki en aktif kullanıcılar</p>
                </div>
                
                <div id="ranking-list" class="space-y-3">
                    <!-- Sıralamalar buraya dinamik olarak yüklenecek -->
                    <p class="text-xs text-center text-white/30 py-8">Yükleniyor...</p>
                </div>
                
                <div class="mt-6 bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-4">
                    <p class="text-xs text-yellow-400 text-center">
                        <i class="fas fa-info-circle mr-1"></i>
                        Sıralama en çok token yükleyen kullanıcılara göre yapılmaktadır.
                    </p>
                </div>
            </div>
        </div>

        <!-- BİLGİ AL PENCERESİ -->
        <div id="win-bilgi" class="window glass-dark">
            <div class="window-header">
                <div class="window-header-title">
                    <div class="window-header-icon bg-purple-500/20 text-purple-400"><i class="fas fa-info-circle"></i></div>
                    <div>
                        <h3 class="text-sm font-bold text-white uppercase tracking-wider">Bilgi Al</h3>
                        <p class="text-[9px] text-purple-400/50">Sistem hakkında bilgiler</p>
                    </div>
                </div>
                <button onclick="toggleWin('win-bilgi')" class="window-close"><i class="fas fa-times text-xs"></i></button>
            </div>
            <div class="flex-1 overflow-y-auto p-6">
                <div class="text-center mb-6">
                    <div class="w-20 h-20 rounded-full bg-gradient-to-br from-purple-500/30 to-pink-500/30 border-2 border-purple-500/50 flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-shield-alt text-3xl text-purple-400"></i>
                    </div>
                    <h4 class="text-lg font-bold text-white mb-2">Güvenlik ve Sistem Bilgileri</h4>
                    <p class="text-xs text-heart/50">Dikkat edilmesi gerekenler</p>
                </div>
                
                <div class="space-y-4">
                    <div class="bg-blue-500/10 border border-blue-500/20 rounded-lg p-4">
                        <div class="flex items-center gap-3 mb-2">
                            <div class="verified-badge"></div>
                            <h5 class="text-sm font-bold text-white">Mavi Tik Onayı</h5>
                        </div>
                        <p class="text-xs text-white/70">
                            Sistemimizde sadece mavi tik alan onaylı şovcu hesaplarında teyit doğrulaması yapılmıştır. 
                            Onaylı şovculardan şov almanızı tavsiye ederiz.
                        </p>
                    </div>
                    
                    <div class="bg-heart/10 border border-heart/20 rounded-lg p-4">
                        <h5 class="text-sm font-bold text-white mb-2 flex items-center gap-2">
                            <i class="fas fa-exclamation-triangle text-heart"></i>
                            Dolandırıcılık Uyarısı
                        </h5>
                        <p class="text-xs text-white/70">
                            Eğer dolandırılma gibi mağduriyet yaşarsanız şikayet talebi oluşturunuz. 
                            Sistem yöneticileri en kısa sürede durumu inceleyecektir.
                        </p>
                    </div>
                    
                    <div class="bg-success/10 border border-success/20 rounded-lg p-4">
                        <h5 class="text-sm font-bold text-white mb-2 flex items-center gap-2">
                            <i class="fas fa-comments text-success"></i>
                            Chat Güvenliği
                        </h5>
                        <p class="text-xs text-white/70">
                            Özel chatler şifrelenmiş olarak iletilmektedir. 
                            Kişisel bilgilerinizi paylaşmaktan kaçınmayın ve sadece güvenilir şovcularla iletişim kurun.
                        </p>
                    </div>
                    
                    <div class="bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-4">
                        <h5 class="text-sm font-bold text-white mb-2 flex items-center gap-2">
                            <i class="fas fa-heart text-yellow-400"></i>
                            Token Sistemi
                        </h5>
                        <p class="text-xs text-white/70">
                            Her mesaj gönderimi için 1 token harcanır. 
                            Token yüklemeleriniz anında hesabınıza eklenir ve sıralamada yerinizi alırsınız.
                        </p>
                    </div>
                </div>
                
                <div class="mt-6 bg-gradient-to-r from-heart/20 to-love/20 border border-heart/30 rounded-lg p-4 text-center">
                    <p class="text-sm text-white font-bold mb-1">Keyifli Vakitler Dileriz!</p>
                    <p class="text-xs text-heart/70">C.N.K.Y OS Ekibi</p>
                </div>
            </div>
        </div>

        <!-- TASKBAR (Sadece desktop) -->
        <div class="absolute bottom-6 left-1/2 -translate-x-1/2 glass-dark px-8 py-4 flex gap-6 items-center border-t-2 border-heart/50 hidden md:flex">
            <div onclick="openMyProfile()" class="w-12 h-12 rounded-xl bg-heart/10 border border-heart/30 flex items-center justify-center cursor-pointer hover:bg-heart/20 hover:border-heart transition-all group" title="Profil">
                <i class="fas fa-id-card text-heart group-hover:text-white"></i>
            </div>
            <div onclick="openGlobalChat()" class="w-12 h-12 rounded-xl bg-heart/10 border border-heart/30 flex items-center justify-center cursor-pointer hover:bg-heart/20 hover:border-heart transition-all group" title="Global Chat">
                <i class="fas fa-globe text-heart group-hover:text-white"></i>
            </div>
            <div onclick="openFileManager()" class="w-12 h-12 rounded-xl bg-yellow-500/10 border border-yellow-500/30 flex items-center justify-center cursor-pointer hover:bg-yellow-500/20 hover:border-yellow-500 transition-all group" title="Dosya Sistemi">
                <i class="fas fa-folder text-yellow-400 group-hover:text-white"></i>
            </div>
            <div onclick="openRankingWindow()" class="w-12 h-12 rounded-xl bg-blue-500/10 border border-blue-500/30 flex items-center justify-center cursor-pointer hover:bg-blue-500/20 hover:border-blue-500 transition-all group" title="Sıralamalar">
                <i class="fas fa-trophy text-blue-400 group-hover:text-white"></i>
            </div>
            <div onclick="openBilgiWindow()" class="w-12 h-12 rounded-xl bg-purple-500/10 border border-purple-500/30 flex items-center justify-center cursor-pointer hover:bg-purple-500/20 hover:border-purple-500 transition-all group" title="Bilgi Al">
                <i class="fas fa-info-circle text-purple-400 group-hover:text-white"></i>
            </div>
            <div onclick="openComplaintWindow()" class="w-12 h-12 rounded-xl bg-red-500/10 border border-red-500/30 flex items-center justify-center cursor-pointer hover:bg-red-500/20 hover:border-red-500 transition-all group relative" title="Şikayet Talebi">
                <i class="fas fa-exclamation-triangle text-red-400 group-hover:text-white"></i>
            </div>
            <div id="admin-btn" onclick="toggleWin('win-admin')" class="hidden w-12 h-12 rounded-xl bg-heart/10 border border-heart/30 flex items-center justify-center cursor-pointer hover:bg-heart/20 hover:border-heart transition-all group relative" title="Yönetim">
                <i class="fas fa-terminal text-heart group-hover:text-white"></i>
                <!-- ŞİKAYET BİLDİRİM BADGE'I -->
                <span id="complaint-badge" class="complaint-badge hidden">0</span>
            </div>
            <div class="w-[1px] h-8 bg-heart/20"></div>
            <div onclick="handleLogout()" class="w-12 h-12 rounded-xl bg-heart/5 border border-heart/20 flex items-center justify-center cursor-pointer hover:bg-heart/20 hover:border-heart transition-all group" title="Çıkış">
                <i class="fas fa-power-off text-heart/50 group-hover:text-heart"></i>
            </div>
        </div>

        <!-- Developer Imzasi - Desktop -->
        <div class="developer-signature" style="z-index: 100;">
            <i class="fab fa-instagram"></i>
            <span>@cankayadeveloper</span>
        </div>
    </div>

    <script type="module">
        // JavaScript kodu güncellendi - TÜM HATALAR DÜZELTİLDİ
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getDatabase, ref, set, push, onValue, onDisconnect, remove, serverTimestamp, update, get, query, orderByChild } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDQN9nVlD0hpOzb7N-g-K1Xe-KVYLTK-5s",
            authDomain: "cnkya-os.firebaseapp.com",
            databaseURL: "https://cnkya-os-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "cnkya-os",
            storageBucket: "cnkya-os.firebasestorage.app",
            messagingSenderId: "478747260135",
            appId: "1:478747260135:web:6121c16907fd01108b5e42"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const audio = document.getElementById('os-audio');
        let currentUser = "";
        let currentUserToken = 0;
        let isPerformer = false;
        let selectedChat = "";
        let selectedPerformerChat = "";
        let notifiedUsers = new Set();
        let userMessageCounts = {};
        let filesUnlocked = false;
        let notes = [];
        let editingNoteIndex = -1;
        const TOKEN_COST_PER_MESSAGE = 1; // DEĞİŞTİRİLDİ: 1 token harcanacak
        let blockedUsers = new Set(); // Engellenen kullanıcılar
        let tokenPrices = { // Token fiyatları
            "950": 950,
            "2000": 2000,
            "10000": 10000
        };
        
        // DOSYA EKLEME DEĞİŞKENLERİ
        let selectedFile = null;
        let selectedFileType = "";
        let selectedFileName = "";
        let selectedFileSize = 0;
        
        // Müzik sesi %10 olarak ayarlandı
        if (audio) {
            audio.volume = 0.1;
        }
        
        // PROFİL RESİMLERİ CACHE - GÜNCELLENDİ
        let profilePicCache = {};
        let userStatusCache = {};

        // Kalp parçacıkları oluştur
        function createParticles() {
            const container = document.getElementById('particles');
            if (!container) return;
            container.innerHTML = '';
            for (let i = 0; i < 40; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.innerHTML = '❤️';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 15 + 's';
                particle.style.animationDuration = (Math.random() * 10 + 15) + 's';
                container.appendChild(particle);
            }
        }
        createParticles();

        // SAAT VE TARİH
        function updateDateTime() {
            const n = new Date();
            const timeStr = n.getHours().toString().padStart(2,'0')+":"+n.getMinutes().toString().padStart(2,'0')+":"+n.getSeconds().toString().padStart(2,'0');
            const days = ['Pazar', 'Pazartesi', 'Salı', 'Çarşamba', 'Perşembe', 'Cuma', 'Cumartesi'];
            const months = ['Ocak', 'Şubat', 'Mart', 'Nisan', 'Mayıs', 'Haziran', 'Temmuz', 'Ağustos', 'Eylül', 'Ekim', 'Kasım', 'Aralık'];
            const dateStr = `${days[n.getDay()]} - ${n.getDate()} ${months[n.getMonth()]} ${n.getFullYear()}`;
            
            if(document.getElementById('lock-clock')) document.getElementById('lock-clock').innerText = timeStr;
            if(document.getElementById('lock-date')) document.getElementById('lock-date').innerText = dateStr;
            if(document.getElementById('main-desktop-clock')) document.getElementById('main-desktop-clock').innerText = timeStr;
        }
        setInterval(updateDateTime, 1000);
        updateDateTime();

        // Sistem monitör
        setInterval(() => {
            const cpu = Math.floor(Math.random() * 30 + 10);
            const mem = Math.floor(Math.random() * 20 + 40);
            const net = Math.floor(Math.random() * 500 + 100);
            
            document.getElementById('cpu-val').innerText = cpu + "%";
            document.getElementById('gpu-val').innerText = Math.floor(Math.random() * 10 + 40) + "C";
            document.getElementById('cpu-percent').innerText = cpu + "%";
            document.getElementById('cpu-bar').style.width = cpu + "%";
            document.getElementById('mem-percent').innerText = mem + "%";
            document.getElementById('mem-bar').style.width = mem + "%";
            document.getElementById('net-val').innerText = net + " KB/s";
            document.getElementById('net-bar').style.width = Math.min(net / 10, 100) + "%";
        }, 3000);

        // ==================== MOBİL ÖZELLİKLER ====================
        
        // Mobil cihaz kontrolü - DÜZELTİLDİ
        function checkMobileDevice() {
            const isMobile = window.innerWidth <= 768;
            const mobileAccess = document.getElementById('mobile-access');
            const adminBtn = document.getElementById('mobile-admin-btn');
            
            if (isMobile && mobileAccess) {
                mobileAccess.classList.remove('hidden');
                
                // Admin butonunu kontrol et
                if (currentUser === "ADMIN" && adminBtn) {
                    adminBtn.classList.remove('hidden');
                } else if (adminBtn) {
                    adminBtn.classList.add('hidden');
                }
            } else if (mobileAccess) {
                mobileAccess.classList.add('hidden');
            }
        }
        
        // Sayfa yüklendiğinde ve boyut değiştiğinde kontrol et
        window.addEventListener('load', checkMobileDevice);
        window.addEventListener('resize', checkMobileDevice);
        
        // Kullanıcı giriş yaptığında mobil erişimi güncelle
        function updateMobileAccess() {
            setTimeout(checkMobileDevice, 100);
        }

        // ==================== DOSYA VE FOTOĞRAF PAYLAŞIM SİSTEMİ ====================
        
        // Dosya ekleme modalını aç
        window.openFileAttachmentModal = () => {
            if (!selectedChat && !selectedPerformerChat) {
                alert("Lütfen önce bir kullanıcı seçin!");
                return;
            }
            
            // Modalı aç
            document.getElementById('file-attachment-modal').classList.add('show');
            // Önizlemeyi temizle
            document.getElementById('file-attachment-preview').classList.remove('active');
            document.getElementById('file-attachment-preview').innerHTML = '';
            document.getElementById('file-attachment-info').classList.add('hidden');
            document.getElementById('file-send-btn').disabled = true;
            // Dosya inputunu temizle
            document.getElementById('file-attachment-input').value = '';
            selectedFile = null;
        };
        
        // Dosya ekleme modalını kapat
        window.closeFileAttachmentModal = () => {
            document.getElementById('file-attachment-modal').classList.remove('show');
            selectedFile = null;
        };
        
        // Dosya seçim işlemi
        window.handleFileSelect = (event) => {
            const file = event.target.files[0];
            if (!file) return;
            
            // Dosya boyutu kontrolü (max 5MB)
            const maxSize = 5 * 1024 * 1024; // 5MB
            if (file.size > maxSize) {
                alert("Dosya boyutu 5MB'dan büyük olamaz!");
                return;
            }
            
            // Dosya tipi kontrolü
            const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'application/pdf', 'text/plain', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
            if (!allowedTypes.includes(file.type)) {
                alert("Desteklenmeyen dosya formatı! Lütfen JPEG, PNG, GIF, PDF, TXT veya DOC dosyası seçin.");
                return;
            }
            
            selectedFile = file;
            selectedFileType = file.type;
            selectedFileName = file.name;
            selectedFileSize = file.size;
            
            // Dosya bilgilerini göster
            document.getElementById('file-name').textContent = file.name;
            document.getElementById('file-size').textContent = formatFileSize(file.size);
            document.getElementById('file-attachment-info').classList.remove('hidden');
            
            // Önizleme için
            const previewDiv = document.getElementById('file-attachment-preview');
            previewDiv.classList.add('active');
            
            if (file.type.startsWith('image/')) {
                // Resim önizlemesi
                const reader = new FileReader();
                reader.onload = (e) => {
                    previewDiv.innerHTML = `<img src="${e.target.result}" alt="Önizleme" class="w-full h-full object-contain">`;
                };
                reader.readAsDataURL(file);
            } else {
                // Diğer dosya türleri için ikon göster
                let icon = 'fa-file';
                if (file.type === 'application/pdf') icon = 'fa-file-pdf';
                else if (file.type === 'text/plain') icon = 'fa-file-alt';
                else if (file.type.includes('word')) icon = 'fa-file-word';
                
                previewDiv.innerHTML = `
                    <div class="w-full h-full flex items-center justify-center">
                        <div class="text-center">
                            <i class="fas ${icon} text-6xl text-heart/60 mb-3"></i>
                            <p class="text-sm text-white">${file.name}</p>
                        </div>
                    </div>`;
            }
            
            // Gönder butonunu aktif et
            document.getElementById('file-send-btn').disabled = false;
        };
        
        // Dosya boyutunu formatlama
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' bytes';
            else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
            else return (bytes / 1048576).toFixed(1) + ' MB';
        }
        
        // DOSYA GÖNDERME İŞLEMİ - TAMAMEN DÜZELTİLDİ: Hem şovcu hem normal kullanıcı için
        window.sendFileAttachment = async () => {
            if (!selectedFile) {
                alert("Lütfen önce bir dosya seçin!");
                return;
            }
            
            if (!selectedChat && !selectedPerformerChat) {
                alert("Lütfen önce bir kullanıcı seçin!");
                return;
            }
            
            // Token kontrol
            const canSend = await consumeToken();
            if (!canSend) {
                closeFileAttachmentModal();
                return;
            }
            
            try {
                // Dosyayı base64'e çevir
                const reader = new FileReader();
                reader.onload = async (e) => {
                    const base64File = e.target.result;
                    
                    // Firebase'e kaydet
                    const fileData = {
                        sender: currentUser,
                        fileName: selectedFileName,
                        fileType: selectedFileType,
                        fileSize: selectedFileSize,
                        fileData: base64File,
                        time: new Date().toLocaleTimeString('tr-TR', {hour: '2-digit', minute: '2-digit'}),
                        date: new Date().toLocaleString('tr-TR'),
                        type: 'file'
                    };
                    
                    let chatPath;
                    
                    // DOĞRU CHAT YOLUNU BELİRLE
                    if (isPerformer && selectedChat) {
                        // Şovcu normal kullanıcıya dosya gönderiyor
                        chatPath = 'performerChats/' + createPerformerChatId(selectedChat, currentUser);
                    } else if (isPerformer && selectedPerformerChat) {
                        // Şovcu başka şovcuya dosya gönderiyor
                        chatPath = 'performerChats/' + createPerformerChatId(selectedPerformerChat, currentUser);
                    } else if (selectedPerformerChat) {
                        // Normal kullanıcı şovcuya dosya gönderiyor
                        chatPath = 'performerChats/' + createPerformerChatId(currentUser, selectedPerformerChat);
                    } else if (selectedChat) {
                        // Normal kullanıcılar arası
                        chatPath = 'chats/' + [currentUser, selectedChat].sort().join("_");
                    }
                    
                    if (!chatPath) {
                        alert("Chat yolu belirlenemedi!");
                        return;
                    }
                    
                    await push(ref(db, chatPath), fileData);
                    
                    // Modalı kapat
                    closeFileAttachmentModal();
                    
                    alert("Dosya başarıyla gönderildi!");
                };
                
                reader.onerror = () => {
                    alert("Dosya okunurken bir hata oluştu!");
                };
                
                reader.readAsDataURL(selectedFile);
                
            } catch (error) {
                console.error("Dosya gönderme hatası:", error);
                alert("Dosya gönderilirken bir hata oluştu!");
                closeFileAttachmentModal();
            }
        };
        
        // Dosya mesajlarını görüntüleme
        function renderFileMessage(fileData, isMe) {
            let fileIcon = 'fa-file';
            let fileColor = 'text-heart';
            
            if (fileData.fileType.startsWith('image/')) {
                fileIcon = 'fa-image';
                fileColor = 'text-pink-400';
            } else if (fileData.fileType === 'application/pdf') {
                fileIcon = 'fa-file-pdf';
                fileColor = 'text-red-400';
            } else if (fileData.fileType === 'text/plain') {
                fileIcon = 'fa-file-alt';
                fileColor = 'text-blue-400';
            } else if (fileData.fileType.includes('word')) {
                fileIcon = 'fa-file-word';
                fileColor = 'text-blue-500';
            }
            
            // Dosya indirme URL'si oluştur
            const downloadUrl = `data:${fileData.fileType};base64,${fileData.fileData.split(',')[1]}`;
            
            let fileContent = '';
            
            if (fileData.fileType.startsWith('image/')) {
                // Resim gösterimi
                fileContent = `
                    <div class="msg-file">
                        <img src="${fileData.fileData}" alt="${fileData.fileName}" onclick="previewImage('${fileData.fileData}', '${fileData.fileName}')" style="cursor: pointer;">
                        <div class="msg-file-info">
                            <span>${fileData.fileName}</span>
                            <a href="${downloadUrl}" download="${fileData.fileName}" class="msg-file-download">
                                <i class="fas fa-download"></i>
                            </a>
                        </div>
                    </div>`;
            } else {
                // Diğer dosya türleri
                fileContent = `
                    <div class="msg-file" style="background: rgba(255, 46, 111, 0.1);">
                        <div style="padding: 15px; text-align: center;">
                            <i class="fas ${fileIcon} ${fileColor} text-3xl mb-2"></i>
                            <p class="text-xs text-white font-bold truncate">${fileData.fileName}</p>
                            <p class="text-[10px] text-heart/50 mt-1">${formatFileSize(fileData.fileSize)}</p>
                        </div>
                        <div class="msg-file-info">
                            <span class="text-[9px]">${fileData.fileName}</span>
                            <a href="${downloadUrl}" download="${fileData.fileName}" class="msg-file-download">
                                <i class="fas fa-download"></i>
                            </a>
                        </div>
                    </div>`;
            }
            
            return `
                <div class="msg-container ${isMe ? 'me' : 'them'}">
                    ${!isMe ? `<span class="msg-sender">${fileData.sender}</span>` : ''}
                    ${fileContent}
                    <span class="msg-time">${fileData.time}</span>
                </div>`;
        }
        
        // Resim önizleme fonksiyonu
        window.previewImage = (imageData, fileName) => {
            const previewModal = `
                <div id="image-preview-modal" style="position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:10003; display:flex; align-items:center; justify-content:center;">
                    <div style="max-width:90%; max-height:90%; position:relative;">
                        <button onclick="document.getElementById('image-preview-modal').remove()" style="position:absolute; top:-40px; right:0; background:#ff2e6f; color:white; border:none; border-radius:50%; width:30px; height:30px; cursor:pointer;">
                            <i class="fas fa-times"></i>
                        </button>
                        <img src="${imageData}" alt="${fileName}" style="max-width:100%; max-height:80vh; border-radius:10px;">
                        <p style="color:white; text-align:center; margin-top:10px;">${fileName}</p>
                    </div>
                </div>`;
            
            document.body.insertAdjacentHTML('beforeend', previewModal);
        };
        
        // ==================== DOSYA VE FOTOĞRAF PAYLAŞIM SİSTEMİ SONU ====================

        // ==================== ŞİKAYET SİSTEMİ ====================
        
        // Şikayet penceresini aç
        window.openComplaintWindow = () => {
            // Eğer kullanıcı admin ise admin şikayet panelini aç
            if (currentUser === "ADMIN") {
                toggleWin('win-complaint-admin');
                loadComplaintsForAdmin();
            } else {
                // Normal kullanıcılar için şikayet gönderme penceresi
                toggleWin('win-complaint');
            }
        };
        
        // Şikayet gönderme fonksiyonu
        window.submitComplaint = async () => {
            const title = document.getElementById('complaint-title').value.trim();
            const type = document.getElementById('complaint-type').value;
            const description = document.getElementById('complaint-description').value.trim();
            const priority = document.querySelector('input[name="priority"]:checked').value;
            
            if (!title || !description) {
                alert("Lütfen başlık ve açıklama girin!");
                return;
            }
            
            if (description.length < 10) {
                alert("Lütfen daha detaylı bir açıklama yazın!");
                return;
            }
            
            try {
                const complaintData = {
                    userId: currentUser,
                    userName: currentUser,
                    title: title,
                    type: type,
                    description: description,
                    priority: priority,
                    status: 'pending',
                    date: new Date().toLocaleString('tr-TR'),
                    timestamp: Date.now()
                };
                
                // Firebase'e kaydet
                const complaintRef = push(ref(db, 'complaints'));
                await set(complaintRef, complaintData);
                
                // Formu temizle
                document.getElementById('complaint-title').value = '';
                document.getElementById('complaint-description').value = '';
                
                alert("Şikayetiniz başarıyla gönderildi! En kısa sürede değerlendirilecektir.");
                toggleWin('win-complaint');
                
            } catch (error) {
                console.error("Şikayet gönderme hatası:", error);
                alert("Şikayet gönderilirken bir hata oluştu!");
            }
        };
        
        // Admin için şikayetleri yükle
        function loadComplaintsForAdmin() {
            const complaintsRef = ref(db, 'complaints');
            onValue(complaintsRef, (snapshot) => {
                const list = document.getElementById('complaints-list');
                if (!list) return;
                
                const data = snapshot.val();
                if (!data) {
                    list.innerHTML = '<p class="text-xs text-center text-white/30 py-8">Henüz şikayet bulunmuyor</p>';
                    return;
                }
                
                // Şikayetleri tarihe göre sırala (yeni önce)
                const complaints = Object.entries(data);
                complaints.sort((a, b) => b[1].timestamp - a[1].timestamp);
                
                let html = '';
                complaints.forEach(([key, complaint]) => {
                    // Öncelik rengi
                    let priorityColor = 'text-white/50';
                    if (complaint.priority === 'medium') priorityColor = 'text-yellow-400';
                    if (complaint.priority === 'high') priorityColor = 'text-red-400';
                    
                    // Durum rengi
                    let statusClass = 'complaint-status pending';
                    if (complaint.status === 'solved') statusClass = 'complaint-status solved';
                    if (complaint.status === 'reviewing') statusClass = 'complaint-status reviewing';
                    
                    // Tür etiketi
                    let typeLabel = 'Diğer';
                    if (complaint.type === 'token') typeLabel = 'Token';
                    if (complaint.type === 'performer') typeLabel = 'Şovcu';
                    if (complaint.type === 'chat') typeLabel = 'Chat';
                    if (complaint.type === 'system') typeLabel = 'Sistem';
                    
                    html += `
                    <div class="complaint-item">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <h4 class="text-xs font-bold text-white">${complaint.title}</h4>
                                <div class="flex items-center gap-2 mt-1">
                                    <span class="text-[9px] ${priorityColor}">
                                        <i class="fas fa-flag mr-1"></i>${complaint.priority === 'low' ? 'Düşük' : complaint.priority === 'medium' ? 'Orta' : 'Yüksek'}
                                    </span>
                                    <span class="text-[9px] text-heart/70">${typeLabel}</span>
                                    <span class="text-[9px] text-white/50">${complaint.userName}</span>
                                </div>
                            </div>
                            <div>
                                <span class="${statusClass}">${complaint.status === 'pending' ? 'Bekliyor' : complaint.status === 'solved' ? 'Çözüldü' : 'İnceleniyor'}</span>
                            </div>
                        </div>
                        <p class="text-xs text-white/70 mb-3">${complaint.description}</p>
                        <div class="flex justify-between items-center text-[9px] text-white/50">
                            <span>${complaint.date}</span>
                            <span>ID: ${key.substring(0, 8)}</span>
                        </div>
                        ${complaint.status === 'pending' ? `
                        <div class="complaint-actions">
                            <button onclick="updateComplaintStatus('${key}', 'reviewing')" class="px-3 py-1 bg-blue-500/20 text-blue-400 text-[10px] rounded hover:bg-blue-500/30 transition-colors">
                                <i class="fas fa-eye mr-1"></i>İncele
                            </button>
                            <button onclick="updateComplaintStatus('${key}', 'solved')" class="px-3 py-1 bg-green-500/20 text-green-400 text-[10px] rounded hover:bg-green-500/30 transition-colors">
                                <i class="fas fa-check mr-1"></i>Çözüldü
                            </button>
                            <button onclick="deleteComplaint('${key}')" class="px-3 py-1 bg-red-500/20 text-red-400 text-[10px] rounded hover:bg-red-500/30 transition-colors">
                                <i class="fas fa-trash mr-1"></i>Sil
                            </button>
                        </div>` : ''}
                    </div>`;
                });
                
                list.innerHTML = html;
            });
        }
        
        // Şikayet durumunu güncelle
        window.updateComplaintStatus = async (complaintId, newStatus) => {
            try {
                await update(ref(db, 'complaints/' + complaintId), { 
                    status: newStatus,
                    reviewedBy: currentUser,
                    reviewedAt: new Date().toLocaleString('tr-TR')
                });
                alert(`Şikayet durumu "${newStatus === 'solved' ? 'Çözüldü' : 'İnceleniyor'}" olarak güncellendi.`);
            } catch (error) {
                console.error("Şikayet durumu güncelleme hatası:", error);
                alert("Durum güncellenirken bir hata oluştu!");
            }
        };
        
        // Şikayeti sil
        window.deleteComplaint = async (complaintId) => {
            if (!confirm("Bu şikayeti silmek istediğinize emin misiniz?")) return;
            
            try {
                await remove(ref(db, 'complaints/' + complaintId));
                alert("Şikayet silindi.");
            } catch (error) {
                console.error("Şikayet silme hatası:", error);
                alert("Şikayet silinirken bir hata oluştu!");
            }
        };
        
        // Admin için bekleyen şikayet sayısını takip et
        function trackPendingComplaints() {
            if (currentUser !== "ADMIN") return;
            
            const complaintsRef = ref(db, 'complaints');
            onValue(complaintsRef, (snapshot) => {
                const data = snapshot.val();
                let pendingCount = 0;
                
                if (data) {
                    Object.values(data).forEach(complaint => {
                        if (complaint.status === 'pending') {
                            pendingCount++;
                        }
                    });
                }
                
                const badge = document.getElementById('complaint-badge');
                if (badge) {
                    if (pendingCount > 0) {
                        badge.textContent = pendingCount;
                        badge.classList.remove('hidden');
                    } else {
                        badge.classList.add('hidden');
                    }
                }
            });
        }
        
        // ==================== ŞİKAYET SİSTEMİ SONU ====================

        // ==================== ENGELLE SİSTEMİ ====================
        
        // Kullanıcı engelle
        window.blockUser = async (username) => {
            if (!confirm(`${username} kullanıcısını engellemek istediğinize emin misiniz?\n\nEngellediğiniz kullanıcı size mesaj gönderemeyecek.`)) {
                return;
            }
            
            try {
                // Engelleme listesine ekle
                const blockRef = ref(db, `blockedUsers/${currentUser}/${username}`);
                await set(blockRef, {
                    blockedAt: new Date().toLocaleString('tr-TR'),
                    blockedBy: currentUser
                });
                
                blockedUsers.add(username);
                
                // Kullanıcı kartını güncelle
                const card = document.getElementById(`user-card-${username}`);
                if (card) {
                    card.classList.add('blocked');
                    const blockBtn = card.querySelector('.block-btn');
                    if (blockBtn) {
                        blockBtn.classList.add('blocked');
                        blockBtn.innerHTML = '<i class="fas fa-ban"></i>';
                    }
                }
                
                alert(`${username} kullanıcısı engellendi. Artık size mesaj gönderemeyecek.`);
                
            } catch (error) {
                console.error("Engelleme hatası:", error);
                alert("Kullanıcı engellenirken bir hata oluştu!");
            }
        };
        
        // Kullanıcı engelini kaldır
        window.unblockUser = async (username) => {
            try {
                // Engelleme listesinden kaldır
                const blockRef = ref(db, `blockedUsers/${currentUser}/${username}`);
                await remove(blockRef);
                
                blockedUsers.delete(username);
                
                // Kullanıcı kartını güncelle
                const card = document.getElementById(`user-card-${username}`);
                if (card) {
                    card.classList.remove('blocked');
                    const blockBtn = card.querySelector('.block-btn');
                    if (blockBtn) {
                        blockBtn.classList.remove('blocked');
                        blockBtn.innerHTML = '<i class="fas fa-ban"></i>';
                    }
                }
                
                alert(`${username} kullanıcısının engeli kaldırıldı.`);
                
            } catch (error) {
                console.error("Engel kaldırma hatası:", error);
                alert("Engel kaldırılırken bir hata oluştu!");
            }
        };
        
        // Engellenen kullanıcıları yükle
        function loadBlockedUsers() {
            if (!currentUser) return;
            
            const blockedRef = ref(db, `blockedUsers/${currentUser}`);
            onValue(blockedRef, (snapshot) => {
                blockedUsers.clear();
                const data = snapshot.val();
                
                if (data) {
                    Object.keys(data).forEach(username => {
                        blockedUsers.add(username);
                    });
                }
            });
        }
        
        // Mesaj göndermeden önce engelleme kontrolü
        async function checkIfBlocked(sender, receiver) {
            try {
                // Gönderenin alıcıyı engelleyip engellemediğini kontrol et
                const senderBlockRef = ref(db, `blockedUsers/${sender}/${receiver}`);
                const senderSnap = await get(senderBlockRef);
                
                // Alıcının göndereniyi engelleyip engellemediğini kontrol et
                const receiverBlockRef = ref(db, `blockedUsers/${receiver}/${sender}`);
                const receiverSnap = await get(receiverBlockRef);
                
                return senderSnap.exists() || receiverSnap.exists();
            } catch (error) {
                console.error("Engelleme kontrol hatası:", error);
                return false;
            }
        }
        
        // ==================== ENGELLE SİSTEMİ SONU ====================

        // ==================== SIRALAMA SİSTEMİ ====================
        
        // Sıralama penceresini aç
        window.openRankingWindow = () => {
            toggleWin('win-siralama');
            loadRankings();
        };
        
        // Sıralamaları yükle
        async function loadRankings() {
            try {
                // Tüm kullanıcıları al
                const usersRef = ref(db, 'users');
                const snapshot = await get(usersRef);
                const data = snapshot.val();
                
                if (!data) {
                    document.getElementById('ranking-list').innerHTML = '<p class="text-xs text-center text-white/30 py-8">Henüz kayıtlı kullanıcı yok</p>';
                    return;
                }
                
                // Kullanıcıları token miktarına göre sırala
                const users = Object.entries(data)
                    .filter(([key, user]) => key !== "ADMIN") // Admin'i hariç tut
                    .map(([key, user]) => ({
                        username: key,
                        fullname: user.fullname || key,
                        token: user.token || 0,
                        isPerformer: user.isPerformer || false
                    }))
                    .sort((a, b) => b.token - a.token); // Token'a göre azalan sırala
                
                let html = '';
                users.forEach((user, index) => {
                    const rankNumber = index + 1;
                    let rankClass = 'ranking-other';
                    let rankIcon = '';
                    
                    if (rankNumber === 1) {
                        rankClass = 'ranking-1';
                        rankIcon = '<i class="fas fa-crown mr-1"></i>';
                    } else if (rankNumber === 2) {
                        rankClass = 'ranking-2';
                        rankIcon = '<i class="fas fa-medal mr-1"></i>';
                    } else if (rankNumber === 3) {
                        rankClass = 'ranking-3';
                        rankIcon = '<i class="fas fa-medal mr-1"></i>';
                    }
                    
                    html += `
                    <div class="ranking-card">
                        <div class="ranking-number ${rankClass}">
                            ${rankNumber}
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-sm font-bold text-white">${user.username}</span>
                                ${user.isPerformer ? '<span class="verified-badge" title="Şovcu"></span>' : ''}
                            </div>
                            <p class="text-xs text-heart/50">${user.fullname}</p>
                        </div>
                        <div class="text-right">
                            <div class="flex items-center gap-1 justify-end">
                                <i class="fas fa-heart text-yellow-400 text-sm"></i>
                                <span class="text-lg font-bold text-yellow-400">${user.token}</span>
                            </div>
                            <p class="text-[9px] text-heart/50">Token</p>
                        </div>
                    </div>`;
                });
                
                document.getElementById('ranking-list').innerHTML = html || '<p class="text-xs text-center text-white/30 py-8">Henüz kayıtlı kullanıcı yok</p>';
                
            } catch (error) {
                console.error("Sıralama yükleme hatası:", error);
                document.getElementById('ranking-list').innerHTML = '<p class="text-xs text-center text-red-400/70 py-8">Sıralamalar yüklenirken bir hata oluştu</p>';
            }
        }
        
        // ==================== SIRALAMA SİSTEMİ SONU ====================

        // ==================== BİLGİ AL PENCERESİ ====================
        
        window.openBilgiWindow = () => {
            toggleWin('win-bilgi');
        };
        
        // ==================== BİLGİ AL PENCERESİ SONU ====================

        // ==================== TOKEN FİYAT YÖNETİMİ ====================
        
        // Token fiyatlarını yükle
        function loadTokenPrices() {
            const pricesRef = ref(db, 'tokenPrices');
            onValue(pricesRef, (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    tokenPrices = data;
                    
                    // Admin panelindeki fiyatları güncelle
                    if (document.getElementById('price-950')) {
                        document.getElementById('price-950').value = tokenPrices["950"] || 950;
                    }
                    if (document.getElementById('price-2000')) {
                        document.getElementById('price-2000').value = tokenPrices["2000"] || 2000;
                    }
                    if (document.getElementById('price-10000')) {
                        document.getElementById('price-10000').value = tokenPrices["10000"] || 10000;
                    }
                    
                    // Kullanıcı panelindeki fiyatları güncelle
                    updateTokenPriceDisplays();
                }
            });
        }
        
        // Token fiyat görüntülerini güncelle
        function updateTokenPriceDisplays() {
            if (document.getElementById('price-950-display')) {
                document.getElementById('price-950-display').textContent = tokenPrices["950"] + " TL";
            }
            if (document.getElementById('price-2000-display')) {
                document.getElementById('price-2000-display').textContent = tokenPrices["2000"] + " TL";
            }
            if (document.getElementById('price-10000-display')) {
                document.getElementById('price-10000-display').textContent = tokenPrices["10000"] + " TL";
            }
            
            // Token paket seçeneklerini güncelle
            const package950 = document.querySelector('input[value="950"]');
            if (package950) {
                package950.setAttribute('data-price', tokenPrices["950"]);
            }
            
            const package2000 = document.querySelector('input[value="2000"]');
            if (package2000) {
                package2000.setAttribute('data-price', tokenPrices["2000"]);
            }
            
            const package10000 = document.querySelector('input[value="10000"]');
            if (package10000) {
                package10000.setAttribute('data-price', tokenPrices["10000"]);
            }
        }
        
        // Token fiyatlarını güncelle
        window.updateTokenPrices = async () => {
            if (currentUser !== "ADMIN") {
                alert("Bu işlem için admin yetkisi gereklidir!");
                return;
            }
            
            const price950 = parseInt(document.getElementById('price-950').value);
            const price2000 = parseInt(document.getElementById('price-2000').value);
            const price10000 = parseInt(document.getElementById('price-10000').value);
            
            if (isNaN(price950) || isNaN(price2000) || isNaN(price10000)) {
                alert("Lütfen geçerli fiyatlar girin!");
                return;
            }
            
            if (price950 <= 0 || price2000 <= 0 || price10000 <= 0) {
                alert("Fiyatlar 0'dan büyük olmalıdır!");
                return;
            }
            
            try {
                const newPrices = {
                    "950": price950,
                    "2000": price2000,
                    "10000": price10000
                };
                
                await set(ref(db, 'tokenPrices'), newPrices);
                tokenPrices = newPrices;
                
                alert("Token fiyatları başarıyla güncellendi!");
                updateTokenPriceDisplays();
                
            } catch (error) {
                console.error("Token fiyat güncelleme hatası:", error);
                alert("Fiyatlar güncellenirken bir hata oluştu!");
            }
        };
        
        // ==================== TOKEN FİYAT YÖNETİMİ SONU ====================

        // TOKEN SİSTEMİ
        function updateTokenDisplay(token) {
            currentUserToken = token;
            const display = document.getElementById('user-token-display');
            if (display) {
                display.innerText = token;
                // Animasyon efekti
                display.parentElement.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    display.parentElement.style.transform = 'scale(1)';
                }, 200);
            }
        }

        async function consumeToken() {
            if (currentUser === "ADMIN" || isPerformer) return true; // Admin ve şovcular sınırsız token
            
            if (currentUserToken < TOKEN_COST_PER_MESSAGE) {
                // Yetersiz token uyarısı
                const tokenDisplay = document.getElementById('user-token-display').parentElement;
                tokenDisplay.classList.add('insufficient-token');
                setTimeout(() => tokenDisplay.classList.remove('insufficient-token'), 500);
                alert(`Yetersiz token! Mesaj göndermek için ${TOKEN_COST_PER_MESSAGE} token gerekli.`);
                return false;
            }
            
            const newToken = currentUserToken - TOKEN_COST_PER_MESSAGE;
            await update(ref(db, 'users/' + currentUser), { token: newToken });
            updateTokenDisplay(newToken);
            return true;
        }

        function listenToUserToken() {
            onValue(ref(db, 'users/' + currentUser + '/token'), (snap) => {
                const token = snap.val();
                if (token !== null) {
                    updateTokenDisplay(token);
                }
            });
        }
        
        function listenToPerformerToken() {
            onValue(ref(db, 'performers/' + currentUser + '/token'), (snap) => {
                const token = snap.val();
                if (token !== null) {
                    updateTokenDisplay(token);
                }
            });
        }

        // BİLDİRİM SESİ
        function playNotificationSound() {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.type = 'sine';
            osc.frequency.setValueAtTime(880, audioCtx.currentTime);
            osc.frequency.setValueAtTime(1100, audioCtx.currentTime + 0.1);
            osc.frequency.setValueAtTime(880, audioCtx.currentTime + 0.2);
            gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.4);
            osc.start(audioCtx.currentTime);
            osc.stop(audioCtx.currentTime + 0.4);
        }
        
        window.showToast = (sender, message) => {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            playNotificationSound();
            
            const toast = document.getElementById('notification-toast');
            document.getElementById('toast-sender').innerText = sender + ' biriminden';
            document.getElementById('toast-preview').innerText = message || 'Yeni mesaj';
            
            toast.classList.add('show');
            
            clearTimeout(window.toastTimeout);
            window.toastTimeout = setTimeout(() => toast.classList.remove('show'), 8000);
        };

        window.closeToast = () => {
            document.getElementById('notification-toast').classList.remove('show');
        };

        // VIDEO CALL MODAL
        window.showVideoCallModal = () => {
            document.getElementById('video-call-modal').classList.add('show');
        };
        
        window.closeVideoCallModal = () => {
            document.getElementById('video-call-modal').classList.remove('show');
        };

        // GELİŞMİŞ TRANSITION ANİMASYONLARI
        function createTransitionHearts() {
            const overlay = document.getElementById('transition-overlay');
            if (!overlay) return;
            
            // Mevcut kalpleri temizle
            const existingHearts = overlay.querySelectorAll('.transition-heart');
            existingHearts.forEach(heart => heart.remove());
            
            // Yeni kalpler ekle
            for (let i = 0; i < 12; i++) {
                const heart = document.createElement('div');
                heart.className = 'transition-heart';
                heart.innerHTML = '❤️';
                heart.style.left = Math.random() * 100 + '%';
                heart.style.top = Math.random() * 100 + '%';
                heart.style.animationDelay = Math.random() * 2 + 's';
                heart.style.fontSize = (Math.random() * 10 + 15) + 'px';
                overlay.appendChild(heart);
            }
        }

        function runTransition(text, callback, isLogout = false) {
            const overlay = document.getElementById('transition-overlay');
            const transitionText = document.getElementById('transition-text');
            
            if (!overlay || !transitionText) return;
            
            transitionText.innerText = text;
            overlay.style.display = 'flex';
            
            // Kalp animasyonlarını başlat
            createTransitionHearts();
            
            setTimeout(() => {
                overlay.style.opacity = 1;
            }, 10);
            
            setTimeout(() => {
                callback();
                if (isLogout) {
                    // Çıkış animasyonu için özel efekt
                    setTimeout(() => {
                        overlay.style.opacity = 0;
                        setTimeout(() => {
                            overlay.style.display = 'none';
                            // Çıkış sonrası sayfayı yenile
                            setTimeout(() => {
                                location.reload();
                            }, 300);
                        }, 500);
                    }, 500);
                } else {
                    overlay.style.opacity = 0;
                    setTimeout(() => {
                        overlay.style.display = 'none';
                    }, 500);
                }
            }, 1500);
        }

        // PENCERE AÇMA
        window.openGlobalChat = () => document.getElementById('win-global').classList.add('active');
        window.openFileManager = () => document.getElementById('win-files').classList.add('active');

        // ==================== PROFİL FOTOĞRAF YÜKLEME SİSTEMİ GÜNCELLENDİ ====================
        window.uploadProfilePhoto = async (input) => {
            const file = input.files[0];
            if (!file) return;
            
            // Dosya boyutu kontrolü (max 2MB)
            if (file.size > 2 * 1024 * 1024) {
                alert("Dosya boyutu 2MB'dan büyük olamaz!");
                return;
            }
            
            // Dosya tipi kontrolü
            if (!file.type.match('image.*')) {
                alert("Sadece resim dosyaları yükleyebilirsiniz!");
                return;
            }
            
            // Spinner göster
            const profileContainer = document.querySelector('.profile-photo-container');
            const spinner = document.createElement('div');
            spinner.className = 'upload-spinner active';
            spinner.innerHTML = '<i class="fas fa-spinner text-2xl text-heart"></i>';
            profileContainer.appendChild(spinner);
            
            try {
                // Base64'e çevir
                const reader = new FileReader();
                reader.onload = async (e) => {
                    const base64Image = e.target.result;
                    
                    // Firebase'e kaydet
                    const userPath = isPerformer ? 'performers/' + currentUser : 'users/' + currentUser;
                    await update(ref(db, userPath), { profilePic: base64Image });
                    
                    // Cache'e ekle
                    profilePicCache[currentUser] = base64Image;
                    
                    // Spinner'ı kaldır
                    spinner.remove();
                    
                    // Profil fotoğrafını güncelle
                    const profileImg = document.querySelector('.profile-photo');
                    if (profileImg) {
                        profileImg.src = base64Image;
                    } else {
                        // Eğer img yoksa, oluştur
                        const avatarDiv = document.querySelector('.user-avatar, .performer-avatar');
                        if (avatarDiv) {
                            avatarDiv.innerHTML = `<img src="${base64Image}" alt="${currentUser}" class="w-full h-full object-cover rounded-lg">`;
                        }
                    }
                    
                    alert("Profil fotoğrafı başarıyla güncellendi!");
                };
                
                reader.onerror = () => {
                    spinner.remove();
                    alert("Dosya okunurken bir hata oluştu!");
                };
                
                reader.readAsDataURL(file);
                
            } catch (error) {
                console.error("Profil fotoğrafı yükleme hatası:", error);
                spinner.remove();
                alert("Profil fotoğrafı yüklenirken bir hata oluştu!");
            }
        };

        // ==================== ÇEVRİMDIŞI SİSTEMİ GÜNCELLENDİ ====================
        let lastActivityTime = Date.now();
        let isAfk = false;
        let activityCheckInterval;
        let visibilityCheckInterval;
        const AFK_TIMEOUT = 5 * 60 * 1000; // 5 dakika
        const OFFLINE_TIMEOUT = 30 * 1000; // 30 saniye
        
        // Sayfa görünürlüğünü takip et
        function trackVisibility() {
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    // Sayfa arkaplanda, çevrimdışı olarak işaretle
                    setTimeout(() => {
                        if (document.hidden && currentUser) {
                            setUserOffline();
                        }
                    }, OFFLINE_TIMEOUT);
                } else {
                    // Sayfa görünür hale geldi, online olarak işaretle
                    if (currentUser) {
                        setUserOnline();
                        lastActivityTime = Date.now();
                        isAfk = false;
                    }
                }
            });
        }
        
        // Kullanıcı aktivitesini takip et
        function trackUserActivity() {
            const activityEvents = ['mousemove', 'keydown', 'click', 'scroll', 'touchstart', 'mousedown'];
            
            // Mevcut event listener'ları temizle
            activityEvents.forEach(event => {
                document.removeEventListener(event, handleUserActivity);
                document.addEventListener(event, handleUserActivity);
            });
            
            // AFK kontrol interval'ini başlat
            if (activityCheckInterval) clearInterval(activityCheckInterval);
            activityCheckInterval = setInterval(checkAfkStatus, 30000); // 30 saniyede bir kontrol et
            
            // Görünürlük kontrolünü başlat
            trackVisibility();
        }
        
        function handleUserActivity() {
            lastActivityTime = Date.now();
            if (isAfk) {
                setUserOnline();
                isAfk = false;
            }
        }
        
        function checkAfkStatus() {
            const now = Date.now();
            if (!isAfk && (now - lastActivityTime) > AFK_TIMEOUT) {
                setUserAfk();
                isAfk = true;
            }
        }
        
        // Kullanıcıyı online olarak ayarla
        async function setUserOnline() {
            if (!currentUser) return;
            
            const statusPath = isPerformer ? 'performerStatus/' + currentUser : 'status/' + currentUser;
            try {
                await update(ref(db, statusPath), { 
                    status: "online", 
                    time: serverTimestamp(),
                    lastActive: new Date().toLocaleString('tr-TR'),
                    lastOnline: Date.now()
                });
            } catch (error) {
                console.error("Online durumu ayarlama hatası:", error);
            }
        }
        
        // Kullanıcıyı AFK olarak ayarla
        async function setUserAfk() {
            if (!currentUser) return;
            
            const statusPath = isPerformer ? 'performerStatus/' + currentUser : 'status/' + currentUser;
            try {
                await update(ref(db, statusPath), { 
                    status: "afk", 
                    time: serverTimestamp(),
                    lastActive: new Date().toLocaleString('tr-TR')
                });
            } catch (error) {
                console.error("AFK durumu ayarlama hatası:", error);
            }
        }
        
        // Kullanıcıyı çevrimdışı olarak ayarla
        async function setUserOffline() {
            if (!currentUser) return;
            
            const statusPath = isPerformer ? 'performerStatus/' + currentUser : 'status/' + currentUser;
            try {
                await update(ref(db, statusPath), { 
                    status: "offline", 
                    time: serverTimestamp(),
                    lastActive: new Date().toLocaleString('tr-TR')
                });
            } catch (error) {
                console.error("Çevrimdışı durumu ayarlama hatası:", error);
            }
        }
        
        // Çıkış yapıldığında çevrimdışı olarak işaretle
        window.handleLogout = () => {
            if (activityCheckInterval) clearInterval(activityCheckInterval);
            if (visibilityCheckInterval) clearInterval(visibilityCheckInterval);
            
            if (currentUser) {
                const statusPath = isPerformer ? 'performerStatus/' + currentUser : 'status/' + currentUser;
                setUserOffline();
            }
            
            runTransition("ÇIKIŞ YAPILIYOR...", () => {
                audio.pause();
                audio.currentTime = 0;
                document.getElementById('desktop').classList.add('hidden');
                document.getElementById('lock-screen').style.display = "flex";
                currentUser = "";
                isPerformer = false;
                blockedUsers.clear();
                profilePicCache = {};
                userStatusCache = {};
            }, true);
        };

        // LOGIN - DÜZELTİLDİ (ADMIN/6666 VARSAYILAN GİRİŞ)
        window.handleLogin = () => {
            const user = document.getElementById('login-user').value.toUpperCase();
            const pass = document.getElementById('login-pass').value;
            if(!user || !pass) return;

            // ADMIN için özel kontrol (Firebase'de kayıt olmasa bile giriş yapabilir)
            if (user === "ADMIN" && pass === "6666") {
                runTransition("YÖNETİCİ GİRİŞİ YAPILIYOR...", () => {
                    audio.play().catch(()=>{});
                    document.getElementById('lock-screen').style.display = "none";
                    document.getElementById('desktop').classList.remove('hidden');
                    currentUser = "ADMIN";
                    document.getElementById('top-user-label').innerText = "Birim: ADMIN";
                    document.getElementById('admin-btn').classList.remove('hidden');
                    updateTokenDisplay(999999); // Admin için sınırsız
                    
                    // ADMIN kullanıcısını Firebase'e ekle (yoksa)
                    set(ref(db, 'users/ADMIN'), { pass: "6666", fullname: "Sistem Yöneticisi", isAdmin: true, token: 999999 });
                    
                    // Online durumu ayarla
                    setUserOnline();
                    trackUserActivity();
                    
                    initOS();
                    listenNotifications();
                    listenToAllProfilePics();
                    listenToPerformerMessages(); // Şovcu mesajlarını dinle
                    trackPendingComplaints(); // Şikayetleri takip et
                    loadTokenPrices(); // Token fiyatlarını yükle
                    loadBlockedUsers(); // Engellenen kullanıcıları yükle
                    updateMobileAccess(); // Mobil erişimi güncelle
                    checkMobileDevice(); // Mobil kontrol
                });
                return;
            }

            onValue(ref(db, 'users/' + user), (s) => {
                const data = s.val();
                if(data && data.pass === pass) {
                    runTransition("SİSTEM YÜKLENİYOR...", () => {
                        audio.play().catch(()=>{});
                        document.getElementById('lock-screen').style.display = "none";
                        document.getElementById('desktop').classList.remove('hidden');
                        currentUser = user;
                        document.getElementById('top-user-label').innerText = "Birim: " + user;
                        if(user === "ADMIN") {
                            document.getElementById('admin-btn').classList.remove('hidden');
                            updateTokenDisplay(999999); // Admin için sınırsız
                            trackPendingComplaints(); // Şikayetleri takip et
                            loadTokenPrices(); // Token fiyatlarını yükle
                        } else {
                            updateTokenDisplay(data?.token || 0);
                        }
                        
                        // Online durumu ayarla
                        setUserOnline();
                        trackUserActivity();
                        
                        initOS();
                        listenNotifications();
                        listenToAllProfilePics();
                        listenToPerformerMessages(); // Şovcu mesajlarını dinle
                        if(user !== "ADMIN") listenToUserToken();
                        loadBlockedUsers(); // Engellenen kullanıcıları yükle
                        loadTokenPrices(); // Token fiyatlarını yükle
                        updateMobileAccess(); // Mobil erişimi güncelle
                        checkMobileDevice(); // Mobil kontrol
                    });
                } else { alert("ERİŞİM ENGELLENDİ"); }
            }, {onlyOnce: true});
        };

        // ==================== BİLDİRİM SİSTEMİ GÜNCELLENDİ ====================
        const unreadMessages = new Set();
        let lastSeenMessageIds = {};
        const readChats = new Set();
        const seenMessageIds = JSON.parse(localStorage.getItem('seenMessageIds') || '{}');
        
        function listenNotifications() {
            onValue(ref(db, 'chats'), (snap) => {
                if (!snap.exists()) return;
                
                snap.forEach((chatRoom) => {
                    const roomName = chatRoom.key;
                    
                    if (roomName.includes(currentUser) && roomName !== "Global") {
                        const messages = chatRoom.val();
                        if (!messages) return;
                        
                        const parts = roomName.split("_");
                        const otherUser = parts[0] === currentUser ? parts[1] : parts[0];
                        
                        let unreadCount = 0;
                        Object.entries(messages).forEach(([msgKey, msg]) => {
                            if (msg.sender !== currentUser) {
                                // HATA 4 DÜZELTİLDİ: Eski bildirimlerin gelmemesi için kontrol
                                if (!seenMessageIds[msgKey] && lastSeenMessageIds[roomName] !== msgKey) {
                                    unreadCount++;
                                    
                                    // Eğer bu mesaj henüz bildirim gösterilmediyse
                                    if (!notifiedUsers.has(`${otherUser}_${msgKey}`)) {
                                        // HATA 4 DÜZELTİLDİ: Sadece yeni mesajlar için bildirim göster
                                        const messageTimestamp = msg.timestamp || Date.now();
                                        const tenMinutesAgo = Date.now() - (10 * 60 * 1000);
                                        
                                        if (messageTimestamp > tenMinutesAgo) {
                                            showToast(msg.sender, msg.text);
                                        }
                                        notifiedUsers.add(`${otherUser}_${msgKey}`);
                                        seenMessageIds[msgKey] = true;
                                    }
                                }
                            }
                        });
                        
                        // localStorage'a kaydet
                        localStorage.setItem('seenMessageIds', JSON.stringify(seenMessageIds));
                        
                        userMessageCounts[otherUser] = unreadCount;
                        
                        // Kullanıcı kartını güncelle
                        updateUserCardNotification(otherUser, unreadCount);
                        
                        if (unreadCount > 0) {
                            unreadMessages.add(otherUser);
                        } else {
                            unreadMessages.delete(otherUser);
                        }
                    }
                });
            });
            
            // Şovcu mesajları için de bildirim dinle
            onValue(ref(db, 'performerChats'), (snap) => {
                if (!snap.exists()) return;
                
                snap.forEach((chatRoom) => {
                    const roomName = chatRoom.key;
                    
                    if (roomName.includes(currentUser)) {
                        const messages = chatRoom.val();
                        if (!messages) return;
                        
                        const parts = roomName.split('_');
                        const otherUser = parts[1] === currentUser ? parts[2] : parts[1];
                        
                        let unreadCount = 0;
                        Object.entries(messages).forEach(([msgKey, msg]) => {
                            if (msg.sender !== currentUser) {
                                if (!seenMessageIds[msgKey] && lastSeenMessageIds[roomName] !== msgKey) {
                                    unreadCount++;
                                    
                                    if (!notifiedUsers.has(`${otherUser}_${msgKey}`)) {
                                        // HATA 4 DÜZELTİLDİ: Sadece yeni mesajlar için bildirim göster
                                        const messageTimestamp = msg.timestamp || Date.now();
                                        const tenMinutesAgo = Date.now() - (10 * 60 * 1000);
                                        
                                        if (messageTimestamp > tenMinutesAgo) {
                                            showToast(msg.sender, msg.text);
                                        }
                                        notifiedUsers.add(`${otherUser}_${msgKey}`);
                                        seenMessageIds[msgKey] = true;
                                    }
                                }
                            }
                        });
                        
                        // localStorage'a kaydet
                        localStorage.setItem('seenMessageIds', JSON.stringify(seenMessageIds));
                        
                        userMessageCounts[otherUser] = unreadCount;
                        updateUserCardNotification(otherUser, unreadCount);
                    }
                });
            });
        }
        
        function updateUserCardNotification(user, count) {
            const card = document.getElementById(`user-card-${user}`);
            const performerCard = document.getElementById(`performer-card-${user}`);
            
            const updateCard = (cardElement) => {
                if (!cardElement) return;
                
                if (count > 0) {
                    cardElement.classList.add('has-unread-messages');
                    
                    // Bildirim göstergesini ekle/güncelle
                    let indicator = cardElement.querySelector('.unread-message-indicator');
                    if (!indicator) {
                        indicator = document.createElement('div');
                        indicator.className = 'unread-message-indicator';
                        cardElement.appendChild(indicator);
                    }
                    indicator.textContent = count > 9 ? '9+' : count;
                    
                    // Yanıp sönen kalp ekle
                    const userName = cardElement.querySelector('.user-name');
                    if (userName && !userName.querySelector('.blink-heart')) {
                        const blinkHeart = document.createElement('div');
                        blinkHeart.className = 'blink-heart';
                        blinkHeart.innerHTML = '<i class="fas fa-heart"></i>';
                        userName.appendChild(blinkHeart);
                    }
                } else {
                    cardElement.classList.remove('has-unread-messages');
                    
                    // Bildirim göstergesini kaldır
                    const indicator = cardElement.querySelector('.unread-message-indicator');
                    if (indicator) indicator.remove();
                    
                    // Yanıp sönen kalbi kaldır
                    const blinkHeart = cardElement.querySelector('.blink-heart');
                    if (blinkHeart) blinkHeart.remove();
                }
            };
            
            updateCard(card);
            updateCard(performerCard);
        }
        
        // Chat açıldığında okundu olarak işaretle
        window.startPrivateChat = (user) => {
            if(user === currentUser && !isPerformer) return;
            
            // Engellenen kullanıcı kontrolü
            if (blockedUsers.has(user)) {
                alert("Bu kullanıcıyı engellediniz. Mesaj gönderemezsiniz.");
                return;
            }
            
            selectedChat = user;
            
            // Bildirimleri temizle
            clearUserNotification(user);
            
            document.getElementById('chat-title').innerText = user + " ile Özel Hat";
            document.getElementById('win-chat').classList.add('active');
            loadPrivate();
        };
        
        function clearUserNotification(user) {
            const roomName = [currentUser, user].sort().join("_");
            const performerRoomName = `performer_${[currentUser, user].sort().join('_')}`;
            
            readChats.add(roomName);
            readChats.add(performerRoomName);
            
            // Son görülen mesaj ID'sini güncelle
            const chatsRef = ref(db, `chats/${roomName}`);
            onValue(chatsRef, (snap) => {
                if (snap.exists()) {
                    const messages = snap.val();
                    const msgKeys = Object.keys(messages);
                    if (msgKeys.length > 0) {
                        lastSeenMessageIds[roomName] = msgKeys[msgKeys.length - 1];
                    }
                }
            }, {onlyOnce: true});
            
            // Bildirimleri sıfırla
            userMessageCounts[user] = 0;
            updateUserCardNotification(user, 0);
            unreadMessages.delete(user);
        }

        function initOS() {
            // Kullanıcı veya şovcu durumuna göre status kaydet
            const statusPath = isPerformer ? 'performerStatus/' + currentUser : 'status/' + currentUser;
            set(ref(db, statusPath), { 
                status: "online", 
                time: serverTimestamp(),
                lastActive: new Date().toLocaleString('tr-TR'),
                lastOnline: Date.now()
            });
            
            // Çevrimdışı olma durumunda bile veri silme - SADECE ÇIKIŞ YAPILDIĞINDA SİL
            // onDisconnect(ref(db, statusPath)).remove(); // BU SATIR KALDIRILDI

            // ==================== HATA 1 DÜZELTİLDİ: Aktif kullanıcıları sadece users veritabanında olanları göster ====================
            onValue(ref(db, 'users'), (usersSnap) => {
                const list = document.getElementById('active-user-list');
                if (!list) return;
                
                const usersData = usersSnap.val() || {};
                const userList = Object.keys(usersData);
                
                // Status verilerini al
                onValue(ref(db, 'status'), (statusSnap) => {
                    const statusData = statusSnap.val() || {};
                    
                    list.innerHTML = "";
                    let onlineCount = 0;
                    
                    // Sadece users veritabanında olan kullanıcıları göster
                    userList.forEach(userName => {
                        if (userName === currentUser && !isPerformer) return; // Kendini gösterme
                        
                        const userData = usersData[userName];
                        const statusInfo = statusData[userName] || { status: "offline" };
                        
                        const isOnline = statusInfo.status === "online";
                        const isAfk = statusInfo.status === "afk";
                        const isOffline = statusInfo.status === "offline";
                        
                        if(isOnline || isAfk) onlineCount++;
                        
                        const isNotified = notifiedUsers.has(userName);
                        const msgCount = userMessageCounts[userName] || 0;
                        const isAdmin = userName === "ADMIN";
                        const isSelf = userName === currentUser && !isPerformer;
                        const isBlocked = blockedUsers.has(userName);
                        
                        // Durumu cache'e kaydet
                        userStatusCache[userName] = statusInfo.status;
                        
                        // Avatar HTML oluştur (profil resmi varsa göster)
                        const avatarContent = createAvatarHTML(userName, isAdmin, false);
                        
                        // Durum göstergesi
                        let statusText = "";
                        let statusClass = "";
                        let statusIcon = "";
                        
                        if (isOnline) {
                            statusText = "Çevrimiçi";
                            statusClass = "text-success";
                            statusIcon = "fa-circle";
                        } else if (isAfk) {
                            statusText = "AFK";
                            statusClass = "text-yellow-400";
                            statusIcon = "fa-clock";
                        } else {
                            statusText = "Çevrimdışı";
                            statusClass = "text-red-400";
                            statusIcon = "fa-circle";
                        }
                        
                        // Engelle butonu
                        const blockButton = !isSelf && !isAdmin ? 
                            `<div class="block-btn ${isBlocked ? 'blocked' : ''}" onclick="${isBlocked ? 'unblockUser' : 'blockUser'}('${userName}')" title="${isBlocked ? 'Engeli Kaldır' : 'Engelle'}">
                                <i class="fas fa-ban"></i>
                            </div>` : '';
                        
                        list.innerHTML += `
                            <div id="user-card-${userName}" onclick="${isBlocked ? '' : `startPrivateChat('${userName}')`}" 
                                 class="user-card ${isBlocked ? 'blocked' : ''} ${isOffline ? 'opacity-40' : ''} ${isNotified ? 'has-notification notification-glow' : ''} ${isSelf ? 'opacity-50 pointer-events-none' : ''}">
                                ${blockButton}
                                <div class="user-avatar ${isAdmin ? 'border-yellow-500 text-yellow-500' : ''} ${isAfk ? 'border-yellow-500' : ''} ${isOffline ? 'border-red-500' : ''}" style="${isAdmin ? 'background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 165, 0, 0.2));' : ''}">
                                    ${avatarContent}
                                </div>
                                <div class="user-info">
                                    <p class="user-name flex items-center gap-2">
                                        ${userName}
                                        ${isAdmin ? '<span class="text-[8px] text-yellow-500 bg-yellow-500/20 px-1.5 py-0.5 rounded">ADMIN</span>' : ''}
                                        ${isSelf ? '<span class="text-[8px] text-heart/50">(Sen)</span>' : ''}
                                        ${isBlocked ? '<span class="text-[8px] text-red-400 bg-red-400/20 px-1.5 py-0.5 rounded">ENGELLİ</span>' : ''}
                                        ${isOffline ? '<span class="text-[8px] text-red-400 bg-red-400/20 px-1.5 py-0.5 rounded">ÇEVRİMDIŞI</span>' : ''}
                                    </p>
                                    <p class="user-status ${statusClass}"><i class="fas ${statusIcon} text-[6px] mr-1"></i>${statusText}</p>
                                </div>
                                ${msgCount > 0 ? `<div class="unread-message-indicator">${msgCount > 9 ? '9+' : msgCount}</div>` : ''}
                            </div>`;
                    });
                    
                    document.getElementById('online-count').innerText = onlineCount + ' çevrimiçi';
                });
            });

            // ==================== HATA 1 DÜZELTİLDİ: Aktif Şovcuları dinle - Sadece performers veritabanında olanları göster ====================
            onValue(ref(db, 'performers'), (performersSnap) => {
                const list = document.getElementById('active-performer-list');
                if (!list) return;
                
                const performersData = performersSnap.val() || {};
                const performerList = Object.keys(performersData);
                
                // Status verilerini al
                onValue(ref(db, 'performerStatus'), (statusSnap) => {
                    const statusData = statusSnap.val() || {};
                    
                    list.innerHTML = "";
                    let performerOnlineCount = 0;
                    
                    performerList.forEach(performerName => {
                        if (performerName === currentUser && isPerformer) return; // Kendini gösterme
                        
                        const performerData = performersData[performerName];
                        const statusInfo = statusData[performerName] || { status: "offline" };
                        
                        const isOnline = statusInfo.status === "online";
                        const isAfk = statusInfo.status === "afk";
                        const isOffline = statusInfo.status === "offline";
                        
                        if(isOnline || isAfk) performerOnlineCount++;
                        
                        const displayName = performerData.fullname || performerName;
                        const isVerified = performerData.verified || false;
                        const isSelf = performerName === currentUser && isPerformer;
                        
                        // Profil resmini cache'e ekle
                        if (performerData.profilePic) {
                            profilePicCache[performerName] = performerData.profilePic;
                        }
                        
                        const avatarContent = createAvatarHTML(performerName, false, true);
                        
                        // Mavi tik göstergesi
                        const verifiedBadge = isVerified ? '<span class="verified-badge" title="Onaylanmış Şovcu"></span>' : '';
                        
                        // Durum göstergesi
                        let statusText = "";
                        let statusClass = "";
                        let statusIcon = "";
                        
                        if (isOffline) {
                            statusText = "Çevrimdışı";
                            statusClass = "text-red-400";
                            statusIcon = "fa-circle";
                        } else if (isAfk) {
                            statusText = "AFK";
                            statusClass = "text-yellow-400";
                            statusIcon = "fa-clock";
                        } else {
                            statusText = "Çevrimiçi";
                            statusClass = "text-heart";
                            statusIcon = "fa-heart";
                        }
                        
                        list.innerHTML += `
                            <div id="performer-card-${performerName}" onclick="${isOffline ? '' : `startPerformerChat('${performerName}')`}" 
                                 class="performer-card ${isSelf ? 'opacity-50 pointer-events-none' : ''} ${isOffline ? 'opacity-40' : ''}">
                                <div class="performer-avatar ${isAfk ? 'border-yellow-500' : ''} ${isOffline ? 'border-red-500' : ''}">
                                    ${avatarContent}
                                </div>
                                <div class="user-info">
                                    <p class="user-name flex items-center gap-2 text-heart">
                                        ${displayName}
                                        ${verifiedBadge}
                                        ${isSelf ? '<span class="text-[8px] text-heart/50">(Sen)</span>' : ''}
                                        ${isOffline ? '<span class="text-[8px] text-red-400 bg-red-400/20 px-1.5 py-0.5 rounded">ÇEVRİMDIŞI</span>' : ''}
                                    </p>
                                    <p class="text-[9px] ${statusClass}"><i class="fas ${statusIcon} text-[6px] mr-1"></i>${statusText}</p>
                                </div>
                                ${userMessageCounts[performerName] > 0 ? `<div class="unread-message-indicator">${userMessageCounts[performerName] > 9 ? '9+' : userMessageCounts[performerName]}</div>` : ''}
                            </div>`;
                    });
                    
                    document.getElementById('performer-online-count').innerText = performerOnlineCount + ' çevrimiçi';
                });
            });

            // Global Chat - PROFİL RESİMLERİ VE DOSYA MESAJLARI İLE
            onValue(ref(db, 'chats/Global'), (snap) => {
                const area = document.getElementById('global-chat-area');
                area.innerHTML = "";
                snap.forEach(c => {
                    const m = c.val();
                    const isMe = m.sender === currentUser;
                    const time = m.time || new Date().toLocaleTimeString('tr-TR', {hour: '2-digit', minute: '2-digit'});
                    const senderPic = profilePicCache[m.sender];
                    
                    const avatarHTML = senderPic 
                        ? `<img src="${senderPic}" alt="${m.sender}" class="msg-sender-avatar">`
                        : '';
                    
                    // Dosya mesajı mı kontrol et
                    if (m.type === 'file') {
                        area.innerHTML += renderFileMessage(m, isMe);
                    } else {
                        // Normal mesaj
                        area.innerHTML += `
                            <div class="msg-container ${isMe ? 'me' : 'them'}">
                                ${!isMe ? `<span class="msg-sender">${avatarHTML}${m.sender}</span>` : ''}
                                <div class="msg-bubble ${isMe ? 'me' : 'them'}">${m.text}</div>
                                <span class="msg-time">${time}</span>
                            </div>`;
                    }
                });
                area.scrollTop = area.scrollHeight;
            });

            onValue(ref(db, 'users'), (snap) => {
                const alist = document.getElementById('admin-user-list');
                alist.innerHTML = "";
                snap.forEach(c => {
                    const userData = c.val();
                    const userToken = userData.token || 0;
                    const userPic = userData.profilePic;
                    
                    const avatarContent = userPic 
                        ? `<img src="${userPic}" alt="${c.key}" class="w-full h-full object-cover rounded-lg">`
                        : c.key.charAt(0);
                    
                    alist.innerHTML += `
                        <div class="flex justify-between items-center p-3 rounded-lg bg-heart/5 border border-heart/10">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 rounded-lg bg-heart/10 flex items-center justify-center text-sm font-bold text-heart overflow-hidden">${avatarContent}</div>
                                <div>
                                    <span class="text-xs font-bold text-white uppercase block">${c.key}</span>
                                    <span class="text-[9px] text-yellow-500"><i class="fas fa-heart mr-1"></i>${userToken} Token</span>
                                </div>
                            </div>
                            <div class="flex items-center gap-2">
                                <button onclick="addTokenToUser('${c.key}')" class="w-8 h-8 rounded-lg bg-yellow-500/10 flex items-center justify-center text-yellow-500 hover:bg-yellow-500 hover:text-white transition-all" title="Token Ekle">
                                    <i class="fas fa-plus text-xs"></i>
                                </button>
                                <button onclick="deleteUser('${c.key}')" class="w-8 h-8 rounded-lg bg-heart/10 flex items-center justify-center text-heart hover:bg-heart hover:text-white transition-all">
                                    <i class="fas fa-trash text-xs"></i>
                                </button>
                            </div>
                        </div>`;
                });
            });
        }

        // Avatar HTML oluşturma fonksiyonu - GÜNCELLENDİ
        function createAvatarHTML(username, isAdmin = false, isPerformerUser = false) {
            const pic = profilePicCache[username];
            if (pic) {
                return `<img src="${pic}" alt="${username}" class="w-full h-full object-cover rounded-lg">`;
            } else if (isPerformerUser) {
                return '<i class="fas fa-heart text-[14px]"></i>';
            } else if (isAdmin) {
                return '<i class="fas fa-crown text-[14px]"></i>';
            } else {
                return username.charAt(0);
            }
        }

        // Tüm profil resimlerini dinle - GÜNCELLENDİ
        function listenToAllProfilePics() {
            // Kullanıcıların profil resimlerini dinle
            onValue(ref(db, 'users'), (snap) => {
                const data = snap.val();
                if (!data) return;
                
                Object.keys(data).forEach(username => {
                    if (data[username].profilePic) {
                        profilePicCache[username] = data[username].profilePic;
                    }
                });
                
                // Kullanıcı listesini güncelle
                updateUserListAvatars();
            });
            
            // Şovcuların profil resimlerini dinle
            onValue(ref(db, 'performers'), (snap) => {
                const data = snap.val();
                if (!data) return;
                
                Object.keys(data).forEach(username => {
                    if (data[username].profilePic) {
                        profilePicCache[username] = data[username].profilePic;
                    }
                });
                
                // Şovcu listesini güncelle
                updatePerformerListAvatars();
            });
        }
        
        function updateUserListAvatars() {
            const userCards = document.querySelectorAll('.user-card');
            userCards.forEach(card => {
                const username = card.id.replace('user-card-', '');
                const avatarDiv = card.querySelector('.user-avatar');
                if (avatarDiv && profilePicCache[username]) {
                    const isAdmin = card.querySelector('.text-yellow-500.bg-yellow-500\\/20');
                    const isPerformerCard = card.classList.contains('performer-card');
                    avatarDiv.innerHTML = createAvatarHTML(username, !!isAdmin, isPerformerCard);
                }
            });
        }
        
        function updatePerformerListAvatars() {
            const performerCards = document.querySelectorAll('.performer-card');
            performerCards.forEach(card => {
                const username = card.id.replace('performer-card-', '');
                const avatarDiv = card.querySelector('.performer-avatar');
                if (avatarDiv && profilePicCache[username]) {
                    avatarDiv.innerHTML = createAvatarHTML(username, false, true);
                }
            });
        }
        
        window.sendGlobalMsg = async () => {
            const i = document.getElementById('global-input');
            if(!i.value) return;
            
            // Token kontrol
            const canSend = await consumeToken();
            if (!canSend) return;
            
            const time = new Date().toLocaleTimeString('tr-TR', {hour: '2-digit', minute: '2-digit'});
            push(ref(db, 'chats/Global'), { 
                sender: currentUser, 
                text: i.value, 
                time: time,
                timestamp: Date.now() // HATA 4 DÜZELTİLDİ: Zaman damgası eklendi
            });
            i.value = "";
        };

        function loadPrivate() {
            // Şovcu ise performerChats kullan, değilse normal chats
            let chatPath;
            if (isPerformer) {
                // Şovcu normal kullanıcıyla konuşuyor
                chatPath = 'performerChats/' + createPerformerChatId(selectedChat, currentUser);
            } else {
                chatPath = 'chats/' + [currentUser, selectedChat].sort().join("_");
            }
            
            onValue(ref(db, chatPath), (snap) => {
                const area = document.getElementById('chat-area');
                area.innerHTML = "";
                snap.forEach(c => {
                    const m = c.val();
                    const isMe = m.sender === currentUser;
                    const time = m.time || new Date().toLocaleTimeString('tr-TR', {hour: '2-digit', minute: '2-digit'});
                    const isTokenTransfer = m.type === 'token_transfer';
                    const isFile = m.type === 'file';
                    const senderPic = profilePicCache[m.sender];
                    
                    const avatarHTML = senderPic 
                        ? `<img src="${senderPic}" alt="${m.sender}" class="msg-sender-avatar">`
                        : '';
                    
                    if (isFile) {
                        // Dosya mesajı
                        area.innerHTML += renderFileMessage(m, isMe);
                    } else {
                        // Normal veya token mesajı
                        area.innerHTML += `
                            <div class="msg-container ${isMe ? 'me' : 'them'}">
                                ${!isMe ? `<span class="msg-sender">${avatarHTML}${m.sender}</span>` : ''}
                                <div class="msg-bubble ${isMe ? 'me' : 'them'} ${isTokenTransfer ? 'token-transfer' : ''}">
                                    ${isTokenTransfer ? '<i class="fas fa-heart text-yellow-400 mr-2"></i>' : ''}
                                    ${m.text}
                                </div>
                                <span class="msg-time">${time}</span>
                            </div>`;
                    }
                });
                area.scrollTop = area.scrollHeight;
            });
        }

        window.sendMsg = async () => {
            const i = document.getElementById('msg-input');
            if(!i.value) return;
            
            // Engelleme kontrolü
            if (blockedUsers.has(selectedChat)) {
                alert("Bu kullanıcıyı engellediniz. Mesaj gönderemezsiniz.");
                return;
            }
            
            // Karşılıklı engelleme kontrolü
            const isBlocked = await checkIfBlocked(currentUser, selectedChat);
            if (isBlocked) {
                alert("Bu kullanıcıya mesaj gönderemezsiniz. Kullanıcı sizi engellemiş olabilir.");
                return;
            }
            
            // Token kontrol
            const canSend = await consumeToken();
            if (!canSend) return;
            
            // Şovcu ise performerChats kullan
            let chatPath;
            if (isPerformer) {
                // Şovcu normal kullanıcıya mesaj gönderiyor
                chatPath = 'performerChats/' + createPerformerChatId(selectedChat, currentUser);
            } else {
                chatPath = 'chats/' + [currentUser, selectedChat].sort().join("_");
            }
            
            const time = new Date().toLocaleTimeString('tr-TR', {hour: '2-digit', minute: '2-digit'});
            push(ref(db, chatPath), { 
                sender: currentUser, 
                text: i.value, 
                time: time,
                timestamp: Date.now() // HATA 4 DÜZELTİLDİ: Zaman damgası eklendi
            });
            i.value = "";
        };

        // KULLANICIYA TOKEN GÖNDERME
        window.sendTokenToUser = async () => {
            const amountInput = document.getElementById('token-send-amount');
            const amount = parseInt(amountInput.value);
            
            if (!amount || amount <= 0) {
                alert("Geçerli bir miktar girin!");
                return;
            }
            
            if (currentUser === "ADMIN") {
                // Admin sınırsız gönderebilir
            } else if (!isPerformer && currentUserToken < amount) {
                alert(`Yetersiz token! Mevcut bakiyeniz: ${currentUserToken}`);
                return;
            }
            
            if (!selectedChat) {
                alert("Lütfen önce bir kullanıcı seçin!");
                return;
            }
            
            // Engelleme kontrolü
            if (blockedUsers.has(selectedChat)) {
                alert("Bu kullanıcıyı engellediniz. Token gönderemezsiniz.");
                return;
            }
            
            if (!confirm(`${selectedChat} kullanıcısına ${amount} token göndermek istediğinize emin misiniz?`)) {
                return;
            }
            
            try {
                // Alıcının token bilgisini al
                const receiverRef = ref(db, 'users/' + selectedChat);
                const receiverSnap = await get(receiverRef);
                const receiverData = receiverSnap.val();
                const receiverToken = receiverData?.token || 0;
                
                // Alıcıya token ekle
                await update(receiverRef, { token: receiverToken + amount });
                
                // Gönderenden token düş (admin veya şovcu değilse)
                if (currentUser !== "ADMIN" && !isPerformer) {
                    await update(ref(db, 'users/' + currentUser), { token: currentUserToken - amount });
                }
                
                // Chat'e mesaj ekle - Şovcu ise performerChats kullan
                let chatPath;
                if (isPerformer) {
                    // Şovcu token gönderiyor
                    chatPath = 'performerChats/' + createPerformerChatId(selectedChat, currentUser);
                } else {
                    chatPath = 'chats/' + [currentUser, selectedChat].sort().join("_");
                }
                
                const time = new Date().toLocaleTimeString('tr-TR', {hour: '2-digit', minute: '2-digit'});
                push(ref(db, chatPath), {
                    sender: currentUser,
                    text: `${amount} Token gönderdi!`,
                    time: time,
                    type: 'token_transfer',
                    timestamp: Date.now()
                });
                
                amountInput.value = '';
                alert(`${selectedChat} kullanıcısına ${amount} token gönderildi!`);
                
            } catch (error) {
                console.error("Token gönderim hatası:", error);
                alert("Token gönderimi sırasında bir hata oluştu!");
            }
        };

        // ŞOVCU CHAT - HATA 2 VE 3 DÜZELTİLDİ: Chat ID oluşturma mantığı
        window.startPerformerChat = (performerCode) => {
            if(performerCode === currentUser && isPerformer) return;
            selectedPerformerChat = performerCode;
            
            // Şovcu bilgilerini al
            onValue(ref(db, 'performers/' + performerCode), (snap) => {
                const data = snap.val();
                const displayName = data?.fullname || performerCode;
                document.getElementById('performer-chat-title').innerText = displayName + " ile Chat";
            }, {onlyOnce: true});
            
            // Bildirimleri temizle
            clearPerformerNotification(performerCode);
            
            document.getElementById('win-performer-chat').classList.add('active');
            loadPerformerChat();
        };
        
        function clearPerformerNotification(performerCode) {
            const roomName = createPerformerChatId(currentUser, performerCode);
            
            readChats.add(roomName);
            
            // Son görülen mesaj ID'sini güncelle
            const chatsRef = ref(db, `performerChats/${roomName}`);
            onValue(chatsRef, (snap) => {
                if (snap.exists()) {
                    const messages = snap.val();
                    const msgKeys = Object.keys(messages);
                    if (msgKeys.length > 0) {
                        lastSeenMessageIds[roomName] = msgKeys[msgKeys.length - 1];
                    }
                }
            }, {onlyOnce: true});
            
            // Bildirimleri sıfırla
            userMessageCounts[performerCode] = 0;
            updateUserCardNotification(performerCode, 0);
        }

        // HATA 2 DÜZELTİLDİ: Şovcu mesajlarını doğru yükleme
        function loadPerformerChat() {
            // DOĞRU ChatID oluştur
            const chatId = createPerformerChatId(currentUser, selectedPerformerChat);
                
            onValue(ref(db, 'performerChats/' + chatId), (snap) => {
                const area = document.getElementById('performer-chat-area');
                area.innerHTML = "";
                snap.forEach(c => {
                    const m = c.val();
                    const isMe = m.sender === currentUser;
                    const time = m.time || new Date().toLocaleTimeString('tr-TR', {hour: '2-digit', minute: '2-digit'});
                    const isTokenTransfer = m.type === 'token_transfer';
                    const isFile = m.type === 'file';
                    const senderPic = profilePicCache[m.sender];
                    
                    const avatarHTML = senderPic 
                        ? `<img src="${senderPic}" alt="${m.sender}" class="msg-sender-avatar">`
                        : '';
                    
                    if (isFile) {
                        // Dosya mesajı
                        area.innerHTML += renderFileMessage(m, isMe);
                    } else {
                        // Normal veya token mesajı
                        area.innerHTML += `
                            <div class="msg-container ${isMe ? 'me' : 'them'}">
                                ${!isMe ? `<span class="msg-sender">${avatarHTML}${m.sender}</span>` : ''}
                                <div class="msg-bubble ${isMe ? 'me' : 'them'} ${isTokenTransfer ? 'token-transfer' : ''}">
                                    ${isTokenTransfer ? '<i class="fas fa-heart text-yellow-400 mr-2"></i>' : ''}
                                    ${m.text}
                                </div>
                                <span class="msg-time">${time}</span>
                            </div>`;
                    }
                });
                area.scrollTop = area.scrollHeight;
            });
        }

        // ŞOVCU MESAJ GÖNDERME - HATA 3 DÜZELTİLDİ
        window.sendPerformerMsg = async () => {
            const i = document.getElementById('performer-msg-input');
            if(!i.value) return;
            
            // Token kontrol (şovcular için gerekli değil ama kontrol edelim)
            const canSend = await consumeToken();
            if (!canSend) return;
            
            // DOĞRU ChatID oluştur
            const chatId = createPerformerChatId(currentUser, selectedPerformerChat);
            
            const time = new Date().toLocaleTimeString('tr-TR', {hour: '2-digit', minute: '2-digit'});
            push(ref(db, 'performerChats/' + chatId), { 
                sender: currentUser, 
                text: i.value, 
                time: time,
                timestamp: Date.now() // HATA 4 DÜZELTİLDİ: Zaman damgası eklendi
            });
            i.value = "";
        };

        // Şovcuya token gönder
        window.sendTokenToPerformer = async () => {
            const amountInput = document.getElementById('performer-token-send-amount');
            const amount = parseInt(amountInput.value);
            
            if (!amount || amount <= 0) {
                alert("Geçerli bir miktar girin!");
                return;
            }
            
            if (currentUser === "ADMIN" || isPerformer) {
                // Admin ve şovcular sınırsız gönderebilir
            } else if (currentUserToken < amount) {
                alert(`Yetersiz token! Mevcut bakiyeniz: ${currentUserToken}`);
                return;
            }
            
            if (!selectedPerformerChat) {
                alert("Lütfen önce bir şovcu seçin!");
                return;
            }
            
            if (!confirm(`${selectedPerformerChat} şovcusuna ${amount} token göndermek istediğinize emin misiniz?`)) {
                return;
            }
            
            try {
                // Şovcunun token bilgisini al
                const performerRef = ref(db, 'performers/' + selectedPerformerChat);
                const performerSnap = await get(performerRef);
                const performerData = performerSnap.val();
                const performerToken = performerData?.token || 0;
                
                // Şovcuya token ekle
                await update(performerRef, { token: performerToken + amount });
                
                // Gönderenden token düş (admin veya şovcu değilse)
                if (currentUser !== "ADMIN" && !isPerformer) {
                    await update(ref(db, 'users/' + currentUser), { token: currentUserToken - amount });
                }
                
                // Chat'e mesaj ekle
                const chatId = createPerformerChatId(currentUser, selectedPerformerChat);
                    
                const time = new Date().toLocaleTimeString('tr-TR', {hour: '2-digit', minute: '2-digit'});
                push(ref(db, 'performerChats/' + chatId), {
                    sender: currentUser,
                    text: `${amount} Token gönderdi!`,
                    time: time,
                    type: 'token_transfer',
                    timestamp: Date.now()
                });
                
                amountInput.value = '';
                alert(`${selectedPerformerChat} şovcusuna ${amount} token gönderildi!`);
                
            } catch (error) {
                console.error("Token gönderim hatası:", error);
                alert("Token gönderimi sırasında bir hata oluştu!");
            }
        };

        // PROFİL
        window.openMyProfile = () => {
            if (isPerformer) {
                // Şovcu profili
                onValue(ref(db, 'performers/' + currentUser), (s) => {
                    const d = s.val() || {};
                    const userToken = d.token || 0;
                    const profilePic = d.profilePic || profilePicCache[currentUser];
                    const isVerified = d.verified || false;
                    
                    document.getElementById('profile-content').innerHTML = `
                        <div class="text-center mb-6">
                            <div class="profile-photo-container">
                                ${profilePic 
                                    ? `<img src="${profilePic}" alt="Profil" class="profile-photo" style="border-color: #ff2e6f;">`
                                    : `<div class="w-24 h-24 rounded-full bg-gradient-to-br from-heart/20 to-love/20 border-2 border-heart/50 flex items-center justify-center">
                                        <i class="fas fa-heart text-4xl text-heart"></i>
                                       </div>`
                                }
                                <label class="profile-photo-upload" title="Profil Resmi Değiştir" style="background: linear-gradient(135deg, #ff2e6f, #ff6b9d);">
                                    <i class="fas fa-camera text-white text-xs"></i>
                                    <input type="file" accept="image/*" onchange="uploadProfilePhoto(this)">
                                </label>
                            </div>
                            <h2 class="text-xl font-bold text-heart tracking-widest mt-4">${currentUser}</h2>
                            <div class="flex items-center justify-center gap-1 mt-1">
                                ${isVerified ? '<span class="verified-badge"></span>' : ''}
                                <p class="text-xs text-heart/50">${isVerified ? 'Onaylı Premium Şovcu' : 'Premium Şovcu'}</p>
                            </div>
                        </div>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center p-3 rounded-lg bg-heart/5 border border-heart/10">
                                <span class="text-[10px] text-heart/50 uppercase">Şovcu Kodu</span>
                                <span class="text-xs text-white font-bold">${currentUser}</span>
                            </div>
                            <div class="flex justify-between items-center p-3 rounded-lg bg-heart/5 border border-heart/10">
                                <span class="text-[10px] text-heart/50 uppercase">Şovcu Adı</span>
                                <span class="text-xs text-white font-bold">${d.fullname || 'BELİRTİLMEDİ'}</span>
                            </div>
                            <div class="flex justify-between items-center p-3 rounded-lg bg-yellow-500/5 border border-yellow-500/10">
                                <span class="text-[10px] text-yellow-500/50 uppercase"><i class="fas fa-heart mr-1"></i>Kazanılan Token</span>
                                <span class="text-xs text-yellow-400 font-bold">${userToken}</span>
                            </div>
                            <div class="flex justify-between items-center p-3 rounded-lg bg-success/5 border border-success/10">
                                <span class="text-[10px] text-success/50 uppercase">Durum</span>
                                <span class="text-xs text-success font-bold"><i class="fas fa-circle text-[6px] mr-1"></i>AKTİF</span>
                            </div>
                        </div>`;
                    toggleWin('win-profile');
                }, {onlyOnce: true});
            } else {
                // Normal kullanıcı profili
                onValue(ref(db, 'users/' + currentUser), (s) => {
                    const d = s.val() || {};
                    const userToken = d.token || 0;
                    const profilePic = d.profilePic || profilePicCache[currentUser];
                    
                    document.getElementById('profile-content').innerHTML = `
                        <div class="text-center mb-6">
                            <div class="profile-photo-container">
                                ${profilePic 
                                    ? `<img src="${profilePic}" alt="Profil" class="profile-photo">`
                                    : `<div class="w-24 h-24 rounded-full bg-gradient-to-br from-heart/20 to-love/20 border-2 border-heart/50 flex items-center justify-center">
                                        <i class="fas fa-user-shield text-4xl text-heart"></i>
                                       </div>`
                                }
                                <label class="profile-photo-upload" title="Profil Resmi Değiştir">
                                    <i class="fas fa-camera text-white text-xs"></i>
                                    <input type="file" accept="image/*" onchange="uploadProfilePhoto(this)">
                                </label>
                            </div>
                            <h2 class="text-xl font-bold text-white tracking-widest mt-4">${currentUser}</h2>
                            <p class="text-xs text-heart/50 mt-1">${currentUser === "ADMIN" ? "Sistem Yöneticisi" : "Operatör"}</p>
                        </div>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center p-3 rounded-lg bg-heart/5 border border-heart/10">
                                <span class="text-[10px] text-heart/50 uppercase">Kod Adı</span>
                                <span class="text-xs text-white font-bold">${currentUser}</span>
                            </div>
                            <div class="flex justify-between items-center p-3 rounded-lg bg-heart/5 border border-heart/10">
                                <span class="text-[10px] text-heart/50 uppercase">Yetki</span>
                                <span class="text-xs text-white font-bold">${currentUser === "ADMIN" ? "YÖNETİCİ" : "OPERATÖR"}</span>
                            </div>
                            <div class="flex justify-between items-center p-3 rounded-lg bg-heart/5 border border-heart/10">
                                <span class="text-[10px] text-heart/50 uppercase">Kayıtlı İsim</span>
                                <span class="text-xs text-white font-bold">${d.fullname || 'BELİRTİLMEDİ'}</span>
                            </div>
                            <div class="flex justify-between items-center p-3 rounded-lg bg-yellow-500/5 border border-yellow-500/10">
                                <span class="text-[10px] text-yellow-500/50 uppercase"><i class="fas fa-heart mr-1"></i>Token</span>
                                <span class="text-xs text-yellow-400 font-bold">${userToken}</span>
                            </div>
                            <div class="flex justify-between items-center p-3 rounded-lg bg-success/5 border border-success/10">
                                <span class="text-[10px] text-success/50 uppercase">Durum</span>
                                <span class="text-xs text-success font-bold"><i class="fas fa-circle text-[6px] mr-1"></i>ÇEVRİMİÇİ</span>
                            </div>
                        </div>`;
                    toggleWin('win-profile');
                }, {onlyOnce: true});
            }
        };

        window.addUser = () => {
            const n = document.getElementById('new-name').value.toUpperCase();
            const p = document.getElementById('new-pass').value;
            const f = document.getElementById('new-fullname').value;
            const t = parseInt(document.getElementById('new-token').value) || 200; // DEĞİŞTİRİLDİ: 200 token başlangıç
            if(!n || !p) return;
            set(ref(db, 'users/' + n), { pass: p, fullname: f, token: t });
            document.getElementById('new-name').value = '';
            document.getElementById('new-pass').value = '';
            document.getElementById('new-fullname').value = '';
            document.getElementById('new-token').value = '';
            alert("BİRİM EKLENDİ - Başlangıç Token: " + t);
        };

        window.addTokenToUser = async (username) => {
            const amount = prompt(`${username} kullanıcısına eklenecek token miktarını girin:`, "100");
            if (amount === null) return;
            
            const tokenAmount = parseInt(amount);
            if (isNaN(tokenAmount) || tokenAmount <= 0) {
                alert("Geçerli bir miktar girin!");
                return;
            }
            
            const userRef = ref(db, 'users/' + username);
            const snap = await get(userRef);
            const userData = snap.val();
            const currentToken = userData?.token || 0;
            const newToken = currentToken + tokenAmount;
            
            await update(userRef, { token: newToken });
            alert(`${username} kullanıcısına ${tokenAmount} token eklendi. Yeni bakiye: ${newToken}`);
        };

        window.deleteUser = (n) => { 
            if(confirm("BİRİM SİLİNSİN Mİ?")) {
                remove(ref(db, 'users/' + n));
                // HATA 1 DÜZELTİLDİ: Kullanıcı silindiğinde status da silinsin
                remove(ref(db, 'status/' + n));
            }
        };

        // Şovcuya token ekle
        window.addTokenToPerformer = async (performerCode) => {
            const amount = prompt(`${performerCode} şovcusuna eklenecek token miktarını girin:`, "100");
            if (amount === null) return;
            
            const tokenAmount = parseInt(amount);
            if (isNaN(tokenAmount) || tokenAmount <= 0) {
                alert("Geçerli bir miktar girin!");
                return;
            }
            
            const performerRef = ref(db, 'performers/' + performerCode);
            const snap = await get(performerRef);
            const performerData = snap.val();
            const currentToken = performerData?.token || 0;
            const newToken = currentToken + tokenAmount;
            
            await update(performerRef, { token: newToken });
            alert(`${performerCode} şovcusuna ${tokenAmount} token eklendi. Yeni bakiye: ${newToken}`);
        };

        // ŞOVCU YÖNETİMİ - GÜNCELLENDİ (Mavi Tik Özelliği Eklendi)
        window.addPerformer = async () => {
            const code = document.getElementById('performer-name').value.toUpperCase().trim();
            const password = document.getElementById('performer-password').value;
            const fullname = document.getElementById('performer-fullname').value.trim();
            const verified = document.getElementById('performer-verified').checked;
            
            if (!code || !password || !fullname) {
                alert("Şovcu kodu, şifre ve isim gerekli!");
                return;
            }
            
            // Mevcut şovcuyu kontrol et
            const existingSnap = await get(ref(db, 'performers/' + code));
            if (existingSnap.exists()) {
                alert("Bu şovcu kodu zaten kayıtlı!");
                return;
            }
            
            const performerData = {
                pass: password,
                fullname: fullname,
                isPerformer: true,
                verified: verified, // Mavi tik durumu
                token: 0,
                createdAt: new Date().toLocaleString('tr-TR')
            };
            
            await set(ref(db, 'performers/' + code), performerData);
            
            // Formu temizle
            document.getElementById('performer-name').value = '';
            document.getElementById('performer-password').value = '';
            document.getElementById('performer-fullname').value = '';
            document.getElementById('performer-verified').checked = false;
            
            alert(`Şovcu başarıyla eklendi!\n\nŞovcu Kodu: ${code}\nŞovcu Adı: ${fullname}\nMavi Tik: ${verified ? 'EVET' : 'HAYIR'}`);
        };
        
        window.deletePerformer = (code) => {
            if(confirm(code + " şovcusu silinsin mi?")) {
                remove(ref(db, 'performers/' + code));
                // HATA 1 DÜZELTİLDİ: Şovcu silindiğinde status da silinsin
                remove(ref(db, 'performerStatus/' + code));
            }
        };
        
        // Şovcuları listele
        const loadPerformers = () => {
            onValue(ref(db, 'performers'), (snap) => {
                const list = document.getElementById('performer-list');
                if (!list) return;
                
                const data = snap.val();
                if (!data) {
                    list.innerHTML = '<p class="text-[10px] text-heart/30 text-center py-2">Henüz şovcu eklenmedi</p>';
                    return;
                }
                
                const performers = Object.entries(data);
                list.innerHTML = performers.map(([code, perf]) => {
                    const perfPic = perf.profilePic;
                    const isVerified = perf.verified || false;
                    const avatarContent = perfPic 
                        ? `<img src="${perfPic}" alt="${code}" class="w-full h-full object-cover rounded-lg">`
                        : '<i class="fas fa-heart text-[8px]"></i>';
                    
                    const verifiedBadge = isVerified ? '<span class="verified-badge" style="width:12px;height:12px;" title="Onaylanmış Şovcu"></span>' : '';
                    
                    return `
                    <div class="flex justify-between items-center p-2 rounded-lg bg-heart/5 border border-heart/10">
                        <div class="flex items-center gap-2">
                            <div class="w-7 h-7 rounded-lg bg-heart/20 flex items-center justify-center text-[10px] font-bold text-heart overflow-hidden">
                                ${avatarContent}
                            </div>
                            <div>
                                <span class="text-[10px] font-bold text-white uppercase flex items-center gap-1">${code} ${verifiedBadge}</span>
                                <span class="text-[8px] text-heart">${perf.fullname}</span>
                                <span class="text-[8px] text-yellow-500" id="perf-token-${code}"><i class="fas fa-heart mr-1"></i>${perf.token || 0} Token</span>
                            </div>
                        </div>
                        <div class="flex items-center gap-1">
                            <button onclick="addTokenToPerformer('${code}')" class="w-6 h-6 rounded bg-yellow-500/10 flex items-center justify-center text-yellow-500 hover:bg-yellow-500 hover:text-white transition-all" title="Token Ekle">
                                <i class="fas fa-plus text-[8px]"></i>
                            </button>
                            <button onclick="deletePerformer('${code}')" class="w-6 h-6 rounded bg-heart/10 flex items-center justify-center text-heart hover:bg-heart hover:text-white transition-all">
                                <i class="fas fa-trash text-[8px]"></i>
                            </button>
                        </div>
                    </div>
                `}).join('');
            });
        };
        
        // Sayfa yüklendiğinde şovcuları yükle
        loadPerformers();

        // Token talep sistemi - GÜNCELLENDİ
        window.requestTokenVerification = async () => {
            if (!currentUser) {
                alert("Lütfen önce giriş yapın!");
                return;
            }
            
            const selectedPackage = document.querySelector('input[name="token-package"]:checked');
            if (!selectedPackage) {
                alert("Lütfen bir paket seçin!");
                return;
            }
            
            const tokenAmount = parseInt(selectedPackage.value);
            const price = tokenPrices[tokenAmount] || selectedPackage.getAttribute('data-price');
            
            // Kullanıcı bilgilerini al
            const userSnap = await get(ref(db, 'users/' + currentUser));
            const userData = userSnap.val();
            const userFullname = userData?.fullname || currentUser;
            
            const requestData = {
                username: currentUser,
                fullname: userFullname,
                tokenAmount: tokenAmount,
                price: price + " TL",
                date: new Date().toLocaleString('tr-TR'),
                status: 'pending'
            };
            
            // Firebase'e kaydet - paymentRequests altına
            const requestRef = ref(db, 'paymentRequests/' + currentUser + '_' + Date.now());
            await set(requestRef, requestData);
            
            alert(`Token yükleme talebiniz alindi!\n\nPaket: ${tokenAmount} Token\nTutar: ${price} TL\n\nOrtalama 1 saat içinde talebiniz kontrol edilecektir.`);
            toggleWin('win-token');
        };

        // Admin için token taleplerini dinle - GÜNCELLENDİ (paymentRequests)
        const loadTokenRequests = () => {
            const requestsRef = ref(db, 'paymentRequests');
            onValue(requestsRef, (snapshot) => {
                const list = document.getElementById('token-requests-list');
                const countEl = document.getElementById('token-request-count');
                if (!list) return;
                
                const data = snapshot.val();
                if (!data) {
                    list.innerHTML = '<p class="text-[10px] text-heart/30 text-center py-4">Bekleyen talep yok</p>';
                    if (countEl) countEl.textContent = '0 talep';
                    return;
                }
                
                const requests = Object.entries(data).filter(([_, v]) => v.status === 'pending');
                if (countEl) countEl.textContent = requests.length + ' talep';
                
                if (requests.length === 0) {
                    list.innerHTML = '<p class="text-[10px] text-heart/30 text-center py-4">Bekleyen talep yok</p>';
                    return;
                }
                
                list.innerHTML = requests.map(([key, req]) => `
                    <div class="bg-slate-800/50 rounded-lg p-3 border border-success/20">
                        <div class="flex items-center justify-between mb-2">
                            <div>
                                <span class="text-xs font-bold text-white">${req.username}</span>
                                <span class="text-[9px] text-heart/50 block">${req.fullname || ''}</span>
                            </div>
                            <span class="text-[9px] text-heart/40">${req.date}</span>
                        </div>
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-[10px] text-yellow-400"><i class="fas fa-heart mr-1"></i>${req.tokenAmount} Token</span>
                            <span class="text-[10px] text-success">${req.price}</span>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="approveTokenRequest('${key}', '${req.username}', ${req.tokenAmount})" class="flex-1 py-1.5 bg-success/20 text-success text-[10px] rounded hover:bg-success/30 transition-colors">
                                <i class="fas fa-check mr-1"></i>Onayla
                            </button>
                            <button onclick="rejectTokenRequest('${key}')" class="flex-1 py-1.5 bg-heart/20 text-heart text-[10px] rounded hover:bg-heart/30 transition-colors">
                                <i class="fas fa-times mr-1"></i>Reddet
                            </button>
                        </div>
                    </div>
                `).join('');
            });
        };

        window.approveTokenRequest = async (requestKey, username, tokenAmount) => {
            if (!confirm(`${username} kullanıcısına ${tokenAmount} token yüklensin mi?`)) return;
            
            // Kullanıcının mevcut tokenini al ve güncelle
            const userRef = ref(db, 'users/' + username);
            const snap = await get(userRef);
            const userData = snap.val();
            const currentToken = userData?.token || 0;
            const newToken = currentToken + tokenAmount;
            
            await update(userRef, { token: newToken });
            
            // Talebi sil
            await remove(ref(db, 'paymentRequests/' + requestKey));
            
            alert(`${username} kullanıcısına ${tokenAmount} token yüklendi!`);
        };

        window.rejectTokenRequest = async (requestKey) => {
            if (!confirm("Bu talep reddedilsin mi?")) return;
            await remove(ref(db, 'paymentRequests/' + requestKey));
            alert("Talep reddedildi.");
        };

        // Sayfa yüklendiğinde token taleplerini dinle
        loadTokenRequests();

        // Auth Tab Değiştirme
        window.showAuthTab = (tab) => {
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            const performerForm = document.getElementById('performer-form');
            const tabLogin = document.getElementById('tab-login');
            const tabRegister = document.getElementById('tab-register');
            const tabPerformer = document.getElementById('tab-performer');
            
            // Hepsini gizle ve active'i kaldır
            loginForm.classList.add('hidden');
            registerForm.classList.add('hidden');
            performerForm.classList.add('hidden');
            tabLogin.classList.remove('active');
            tabRegister.classList.remove('active');
            tabPerformer.classList.remove('active');
            
            if (tab === 'login') {
                loginForm.classList.remove('hidden');
                tabLogin.classList.add('active');
            } else if (tab === 'register') {
                registerForm.classList.remove('hidden');
                tabRegister.classList.add('active');
            } else if (tab === 'performer') {
                performerForm.classList.remove('hidden');
                tabPerformer.classList.add('active');
            }
        };

        // Şovcu Giriş Fonksiyonu
        window.handlePerformerLogin = () => {
            const user = document.getElementById('performer-user').value.toUpperCase();
            const pass = document.getElementById('performer-pass').value;
            if(!user || !pass) return;

            onValue(ref(db, 'performers/' + user), (s) => {
                const data = s.val();
                if(data && data.pass === pass) {
                    runTransition("ŞOVCU GİRİŞİ YAPILIYOR...", () => {
                        audio.play().catch(()=>{});
                        document.getElementById('lock-screen').style.display = "none";
                        document.getElementById('desktop').classList.remove('hidden');
                        currentUser = user;
                        isPerformer = true;
                        document.getElementById('top-user-label').innerText = "Şovcu: " + user;
                        updateTokenDisplay(data.token || 0); // Şovcunun kendi tokeni
                        
                        // Online durumu ayarla
                        setUserOnline();
                        trackUserActivity();
                        
                        initOS();
                        listenNotifications();
                        listenToAllProfilePics();
                        listenToPerformerToken(); // Şovcu token değişikliklerini dinle
                        listenToPerformerMessages(); // Şovcu mesajlarını dinle
                        loadBlockedUsers(); // Engellenen kullanıcıları yükle
                        loadTokenPrices(); // Token fiyatlarını yükle
                        updateMobileAccess(); // Mobil erişimi güncelle
                        checkMobileDevice(); // Mobil kontrol
                    });
                } else { 
                    alert("ŞOVCU ERİŞİMİ ENGELLENDİ - Geçersiz bilgiler veya hesabınız admin tarafından oluşturulmamış."); 
                }
            }, {onlyOnce: true});
        };

        // Kayıt Ol Fonksiyonu - DİREKT KAYIT (Admin onaysız)
        window.handleRegister = async () => {
            const username = document.getElementById('reg-user').value.trim().toUpperCase();
            const fullname = document.getElementById('reg-fullname').value.trim();
            const password = document.getElementById('reg-pass').value;
            
            if (!username || !password || !fullname) {
                alert("Kullanıcı adı, isim soyisim ve şifre gerekli!");
                return;
            }
            
            if (username.length < 3) {
                alert("Kullanıcı adı en az 3 karakter olmalı!");
                return;
            }
            
            if (password.length < 4) {
                alert("Şifre en az 4 karakter olmalı!");
                return;
            }

            // Mevcut kullanıcıları kontrol et
            const usersSnap = await get(ref(db, 'users'));
            const users = usersSnap.val() || {};
            
            if (users[username]) {
                alert("Bu kullanıcı adı zaten kayıtlı!");
                return;
            }
            
            // Kullanıcıyı direkt ekle (200 token ile) - DEĞİŞTİRİLDİ: 200 token
            const userData = {
                pass: password,
                fullname: fullname,
                isAdmin: false,
                isPerformer: false,
                token: 200
            };
            
            await set(ref(db, 'users/' + username), userData);
            
            alert("Kaydınız başarıyla tamamlandı!\n\nKullanıcı Adı: " + username + "\nİsim Soyisim: " + fullname + "\nBaşlangıç Token: 200\n\nŞimdi giriş yapabilirsiniz.");
            
            // Formu temizle ve giriş ekranına dön
            document.getElementById('reg-user').value = '';
            document.getElementById('reg-fullname').value = '';
            document.getElementById('reg-pass').value = '';
            
            // Otomatik olarak login formuna bilgileri doldur
            document.getElementById('login-user').value = username;
            document.getElementById('login-pass').value = password;
            
            showAuthTab('login');
        };

        // DOSYA SİSTEMİ
        window.checkFilesPassword = () => {
            const password = document.getElementById('files-password').value;
            // Basit şifre kontrolü - gerçek uygulamada daha güvenli olmalı
            if (password === currentUser.toLowerCase() || password === "1234" || currentUser === "ADMIN") {
                filesUnlocked = true;
                document.getElementById('files-password-overlay').style.display = 'none';
                loadNotes();
            } else {
                document.getElementById('files-error').classList.remove('hidden');
                setTimeout(() => {
                    document.getElementById('files-error').classList.add('hidden');
                }, 2000);
            }
        };

        function loadNotes() {
            onValue(ref(db, 'notes/' + currentUser), (snap) => {
                notes = [];
                snap.forEach(c => {
                    notes.push({ key: c.key, ...c.val() });
                });
                renderNotes();
            });
        }

        function renderNotes() {
            const content = document.getElementById('files-content');
            content.innerHTML = '';
            
            // Yeni not ekle butonu
            content.innerHTML += `
                <div onclick="openNewNote()" class="file-item">
                    <div class="file-icon add"><i class="fas fa-plus"></i></div>
                    <div class="flex-1">
                        <p class="text-sm font-bold text-success">Yeni Not Oluştur</p>
                        <p class="text-[10px] text-heart/50">.txt dosyası</p>
                    </div>
                </div>`;
            
            notes.forEach((note, index) => {
                content.innerHTML += `
                    <div class="file-item" onclick="openNote(${index})">
                        <div class="file-icon txt"><i class="fas fa-file-alt"></i></div>
                        <div class="flex-1">
                            <p class="text-sm font-bold text-white">${note.title || 'İsimsiz Not'}</p>
                            <p class="text-[10px] text-heart/50">${note.date || 'Tarih yok'}</p>
                        </div>
                        <button onclick="event.stopPropagation(); deleteNote('${note.key}')" class="w-8 h-8 rounded-lg bg-heart/10 flex items-center justify-center text-heart hover:bg-heart hover:text-white transition-all">
                            <i class="fas fa-trash text-xs"></i>
                        </button>
                    </div>`;
            });
            
            document.getElementById('file-count').innerText = notes.length + ' not';
        }

        window.openNewNote = () => {
            editingNoteIndex = -1;
            document.getElementById('note-editor-title').innerText = 'Yeni Not';
            document.getElementById('note-title').value = '';
            document.getElementById('note-content').value = '';
            toggleWin('win-note-editor');
        };

        window.openNote = (index) => {
            editingNoteIndex = index;
            const note = notes[index];
            document.getElementById('note-editor-title').innerText = 'Not Düzenle';
            document.getElementById('note-title').value = note.title || '';
            document.getElementById('note-content').value = note.content || '';
            toggleWin('win-note-editor');
        };

        window.saveNote = async () => {
            const title = document.getElementById('note-title').value.trim();
            const content = document.getElementById('note-content').value.trim();
            
            if (!title && !content) {
                alert("Başlık veya içerik gerekli!");
                return;
            }
            
            const noteData = {
                title: title || 'İsimsiz Not',
                content: content,
                date: new Date().toLocaleString('tr-TR')
            };
            
            if (editingNoteIndex >= 0) {
                // Mevcut notu güncelle
                await update(ref(db, 'notes/' + currentUser + '/' + notes[editingNoteIndex].key), noteData);
            } else {
                // Yeni not ekle
                await push(ref(db, 'notes/' + currentUser), noteData);
            }
            
            toggleWin('win-note-editor');
        };
        
        window.deleteNote = async (noteKey) => {
            if (!confirm("Bu notu silmek istediğinize emin misiniz?")) return;
            await remove(ref(db, 'notes/' + currentUser + '/' + noteKey));
        };

        window.closeChatWindow = () => {
            selectedChat = "";
            document.getElementById('win-chat').classList.remove('active');
        };

        window.toggleWin = (id) => {
            const win = document.getElementById(id);
            if (win.classList.contains('active')) {
                win.classList.remove('active');
                // Eğer chat penceresi kapatılıyorsa seçili chat'i temizle
                if (id === 'win-chat') selectedChat = "";
                if (id === 'win-performer-chat') selectedPerformerChat = "";
            } else {
                // Diğer pencereleri kapat
                document.querySelectorAll('.window.active').forEach(w => w.classList.remove('active'));
                win.classList.add('active');
            }
        };

        // ŞOVCU MESAJLARINI DİNLEME - HATA 2 DÜZELTİLDİ
        function listenToPerformerMessages() {
            // Şovcu girişi yapıldıysa, şovcunun mesajlarını dinle
            if (isPerformer) {
                const performerChatsRef = ref(db, 'performerChats');
                onValue(performerChatsRef, (snap) => {
                    if (!snap.exists()) return;
                    
                    snap.forEach((chatRoom) => {
                        const roomName = chatRoom.key;
                        
                        // Eğer bu sohbet odası şovcuyu içeriyorsa
                        if (roomName.includes(currentUser)) {
                            const messages = chatRoom.val();
                            if (!messages) return;
                            
                            // Mesaj sayısını güncelle
                            Object.entries(messages).forEach(([msgKey, msg]) => {
                                if (msg.sender !== currentUser && !seenMessageIds[msgKey]) {
                                    const parts = roomName.split('_');
                                    const otherUser = parts[1] === currentUser ? parts[2] : parts[1];
                                    
                                    if (!userMessageCounts[otherUser]) {
                                        userMessageCounts[otherUser] = 0;
                                    }
                                    userMessageCounts[otherUser]++;
                                    
                                    updateUserCardNotification(otherUser, userMessageCounts[otherUser]);
                                }
                            });
                        }
                    });
                });
            }
        }

        // CHAT ID OLUŞTURMA - HATA 2 VE 3 DÜZELTİLDİ
        function createPerformerChatId(user1, user2) {
            // Sıralı ID oluştur: performer_kullanici1_kullanici2
            const users = [user1, user2].sort();
            return `performer_${users[0]}_${users[1]}`;
        }

        // YARDIMCI FONKSİYONLAR
        function getRandomColor() {
            const colors = ['#ff2e6f', '#ff6b9d', '#ff9ec5', '#ffd700', '#4ade80', '#007bff'];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // Sayfa yüklendiğinde localStorage'dan bildirim verilerini yükle
        window.addEventListener('load', () => {
            const savedSeenIds = localStorage.getItem('seenMessageIds');
            if (savedSeenIds) {
                Object.assign(seenMessageIds, JSON.parse(savedSeenIds));
            }
        });
    </script>
</body>
</html>
